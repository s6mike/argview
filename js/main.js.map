{"version":3,"file":"main.js","mappings":"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","sources":["webpack://@s6mike/mapjs/webpack/runtime/chunk loaded","webpack://@s6mike/mapjs/./config/config-mapjs.yaml","webpack://@s6mike/mapjs/./src/core/clipboard.js","webpack://@s6mike/mapjs/./src/core/content/apply-idea-attributes-to-node-theme.js","webpack://@s6mike/mapjs/./src/core/content/auto-themed-idea-utils.js","webpack://@s6mike/mapjs/./src/core/content/calc-idea-level.js","webpack://@s6mike/mapjs/./src/core/content/content-upgrade.js","webpack://@s6mike/mapjs/./src/core/content/content.js","webpack://@s6mike/mapjs/./src/core/content/format-note-to-html.js","webpack://@s6mike/mapjs/./src/core/content/formatted-node-title.js","webpack://@s6mike/mapjs/./src/core/content/is-empty-group.js","webpack://@s6mike/mapjs/./src/core/content/sorted-sub-ideas.js","webpack://@s6mike/mapjs/./src/core/content/traverse.js","webpack://@s6mike/mapjs/./src/core/deep-assign.js","webpack://@s6mike/mapjs/./src/core/is-object-object.js","webpack://@s6mike/mapjs/./src/core/layout/calculate-layout.js","webpack://@s6mike/mapjs/./src/core/layout/extract-connectors.js","webpack://@s6mike/mapjs/./src/core/layout/extract-links.js","webpack://@s6mike/mapjs/./src/core/layout/layout-geometry.js","webpack://@s6mike/mapjs/./src/core/layout/layout-model.js","webpack://@s6mike/mapjs/./src/core/layout/multi-root-layout.js","webpack://@s6mike/mapjs/./src/core/layout/node-attribute-utils.js","webpack://@s6mike/mapjs/./src/core/layout/node-to-box.js","webpack://@s6mike/mapjs/./src/core/layout/standard/calculate-standard-layout.js","webpack://@s6mike/mapjs/./src/core/layout/standard/outline.js","webpack://@s6mike/mapjs/./src/core/layout/standard/tree.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/align-group.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/calculate-top-down-layout.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/combine-vertical-subtrees.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/compacted-group-width.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/sort-nodes-by-left-position.js","webpack://@s6mike/mapjs/./src/core/layout/top-down/vertical-subtree-collection.js","webpack://@s6mike/mapjs/./src/core/map-model.js","webpack://@s6mike/mapjs/./src/core/theme/calc-child-position.js","webpack://@s6mike/mapjs/./src/core/theme/color-parser.js","webpack://@s6mike/mapjs/./src/core/theme/color-to-rgb.js","webpack://@s6mike/mapjs/./src/core/theme/connector.js","webpack://@s6mike/mapjs/./src/core/theme/default-theme.js","webpack://@s6mike/mapjs/./src/core/theme/foreground-style.js","webpack://@s6mike/mapjs/./src/core/theme/line-strokes.js","webpack://@s6mike/mapjs/./src/core/theme/line-styles.js","webpack://@s6mike/mapjs/./src/core/theme/line-types.js","webpack://@s6mike/mapjs/./src/core/theme/link.js","webpack://@s6mike/mapjs/./src/core/theme/node-connection-point-x.js","webpack://@s6mike/mapjs/./src/core/theme/theme-attribute-utils.js","webpack://@s6mike/mapjs/./src/core/theme/theme-fallback-values.js","webpack://@s6mike/mapjs/./src/core/theme/theme-processor.js","webpack://@s6mike/mapjs/./src/core/theme/theme-to-dictionary.js","webpack://@s6mike/mapjs/./src/core/theme/theme.js","webpack://@s6mike/mapjs/./src/core/util/calc-max-width.js","webpack://@s6mike/mapjs/./src/core/util/clean-dom-id.js","webpack://@s6mike/mapjs/./src/core/util/connector-key.js","webpack://@s6mike/mapjs/./src/core/util/convert-position-to-transform.js","webpack://@s6mike/mapjs/./src/core/util/deep-freeze.js","webpack://@s6mike/mapjs/./src/core/util/link-key.js","webpack://@s6mike/mapjs/./src/core/util/mapjs-utilities.js","webpack://@s6mike/mapjs/./src/core/util/node-key.js","webpack://@s6mike/mapjs/./src/core/util/object-utils.js","webpack://@s6mike/mapjs/./src/core/util/observable.js","webpack://@s6mike/mapjs/./src/core/util/url-helper.js","webpack://@s6mike/mapjs/./src/browser/build-connection.js","webpack://@s6mike/mapjs/./src/browser/calc-label-center-point.js","webpack://@s6mike/mapjs/./src/browser/create-connector.js","webpack://@s6mike/mapjs/./src/browser/create-link.js","webpack://@s6mike/mapjs/./src/browser/create-node.js","webpack://@s6mike/mapjs/./src/browser/create-reorder-bounds.js","webpack://@s6mike/mapjs/./src/browser/create-svg.js","webpack://@s6mike/mapjs/./src/browser/dom-map-controller.js","webpack://@s6mike/mapjs/./src/browser/dom-map-widget.js","webpack://@s6mike/mapjs/./src/browser/edit-node.js","webpack://@s6mike/mapjs/./src/browser/find-line.js","webpack://@s6mike/mapjs/./src/browser/get-box.js","webpack://@s6mike/mapjs/./src/browser/get-data-box.js","webpack://@s6mike/mapjs/./src/browser/get-data-uri-and-dimensions.js","webpack://@s6mike/mapjs/./src/browser/hammer-draggable.js","webpack://@s6mike/mapjs/./src/browser/image-drop-widget.js","webpack://@s6mike/mapjs/./src/browser/image-insert-controller.js","webpack://@s6mike/mapjs/./src/browser/inner-text.js","webpack://@s6mike/mapjs/./src/browser/link-edit-widget.js","webpack://@s6mike/mapjs/./src/browser/map-toolbar-widget.js","webpack://@s6mike/mapjs/./src/browser/node-cache-mark.js","webpack://@s6mike/mapjs/./src/browser/node-resize-widget.js","webpack://@s6mike/mapjs/./src/browser/node-with-id.js","webpack://@s6mike/mapjs/./src/browser/place-caret-at-end.js","webpack://@s6mike/mapjs/./src/browser/queue-fade-out.js","webpack://@s6mike/mapjs/./src/browser/select-all.js","webpack://@s6mike/mapjs/./src/browser/set-theme-class-list.js","webpack://@s6mike/mapjs/./src/browser/update-connector-text.js","webpack://@s6mike/mapjs/./src/browser/update-connector.js","webpack://@s6mike/mapjs/./src/browser/update-link.js","webpack://@s6mike/mapjs/./src/browser/update-node-content.js","webpack://@s6mike/mapjs/./src/browser/update-reorder-bounds.js","webpack://@s6mike/mapjs/./src/browser/update-stage.js","webpack://@s6mike/mapjs/./src/npm-main.js","webpack://@s6mike/mapjs/./src/start.js","webpack://@s6mike/mapjs/./src/theme.js","webpack://@s6mike/mapjs/webpack/bootstrap","webpack://@s6mike/mapjs/webpack/runtime/define property getters","webpack://@s6mike/mapjs/webpack/runtime/hasOwnProperty shorthand","webpack://@s6mike/mapjs/webpack/runtime/make namespace object","webpack://@s6mike/mapjs/webpack/runtime/jsonp chunk loading","webpack://@s6mike/mapjs/webpack/startup"],"sourcesContent":["var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","export default {argmap_collection:{tag:'article','class':'argmap-collection'},argmap_grouping:{tag:'article','class':'argmap',parent:'argmap_collection'},mapjs_instance:{tag:'div','class':'mapjs-app',parent:'mapjs_grouping'},mapjs_map:{id:'${mapjs_map.id-prefix}${MAP_INSTANCE_ID}','id-prefix':'container-',tag:'div','class':'mapjs-container',parent:'mapjs_app'},mapjs_src_data:{tag:'script','class':'argmap-json',src:'${path-json-source}',parent:'mapjs_map'},mapjs_control:{id:'${mapjs_control.id-prefix}${MAP_INSTANCE_ID}','id-prefix':'menubar-mapjs-',tag:'div','class':'menubar-mapjs',role:'menubar',parent:'mapjs_instance'},toolbar_main:{tag:'div','class':'toolbar-mapjs-main',role:'toolbar',aria_label:'Edit nodes',parent:'mapjs_control'},toolbar_edit_links:{id:'${toolbar_edit_links.id-prefix}${MAP_INSTANCE_ID}','id-prefix':'toolbar-edit-links-',tag:'div','class':'toolbar-mapjs-edit-links',role:'toolbar',aria_label:'Edit links',parent:'mapjs_control'},toolbar_fileButton:{'class':'readFile'},node:{'class':'mapjs-node'},connector:{'class':'mapjs-connector'}};","/*global module */\nmodule.exports = function MemoryClipboard() {\n  'use strict';\n  const self = this,\n    clone = function (something) {\n      if (!something) {\n        return undefined;\n      }\n      return JSON.parse(JSON.stringify(something));\n    };\n  let contents;\n  self.get = function () {\n    return clone(contents);\n  };\n  self.put = function (c) {\n    contents = clone(c);\n  };\n};\n","/*global module, require*/\n\nconst foregroundStyle = require('../theme/foreground-style');\nmodule.exports = function applyIdeaAttributesToNodeTheme(idea, nodeTheme) {\n  'use strict';\n  if (!nodeTheme || !idea || !idea.attr || !idea.attr.style) {\n    return nodeTheme;\n  }\n  const isColorSetByUser = () => {\n      const setByUser = idea.attr && idea.attr.style && idea.attr.style.background;\n      if (setByUser === 'false' || setByUser === 'transparent') {\n        return false;\n      }\n      return setByUser;\n\n    },\n    fontMultiplier = idea.attr.style.fontMultiplier,\n    textAlign = idea.attr.style.textAlign,\n    colorSetByUser = isColorSetByUser(),\n    colorText = nodeTheme.borderType !== 'surround';\n\n  if (colorSetByUser) {\n    if (colorText) {\n      nodeTheme.text.color = colorSetByUser;\n    } else {\n      nodeTheme.text.color = nodeTheme.text[foregroundStyle(colorSetByUser)];\n      nodeTheme.backgroundColor = colorSetByUser;\n    }\n  }\n\n  if (textAlign) {\n    nodeTheme.text = Object.assign({}, nodeTheme.text, { alignment: textAlign });\n  }\n\n  if ((nodeTheme && nodeTheme.hasFontMultiplier)) {\n    return nodeTheme;\n  }\n\n  if (!nodeTheme.font || !fontMultiplier || Math.abs(fontMultiplier) <= 0.01 || Math.abs(fontMultiplier - 1) <= 0.01) {\n    return nodeTheme;\n  }\n  if (nodeTheme.font.size) {\n    nodeTheme.font.size = nodeTheme.font.size * fontMultiplier;\n  }\n\n  if (nodeTheme.font.lineSpacing) {\n    nodeTheme.font.lineSpacing = nodeTheme.font.lineSpacing * fontMultiplier;\n  }\n\n  if (nodeTheme.font.sizePx) {\n    nodeTheme.font.sizePx = nodeTheme.font.sizePx * fontMultiplier;\n  }\n  if (nodeTheme.font.lineSpacingPx) {\n    nodeTheme.font.lineSpacingPx = nodeTheme.font.lineSpacingPx * fontMultiplier;\n  }\n  nodeTheme.hasFontMultiplier = true;\n\n\n  return nodeTheme;\n};\n","/*global module, require*/\nconst calcIdeaLevel = require('./calc-idea-level'),\n  _ = require('underscore'),\n  traverse = require('./traverse'),\n  addSubIdea = (activeContent, themeObj, parentId, ideaTitle, optionalNewId, optionalIdeaAttr) => {\n    'use strict';\n    if (!themeObj) {\n      return activeContent.addSubIdea(parentId, ideaTitle, optionalNewId, optionalIdeaAttr);\n    }\n    const parentLevel = calcIdeaLevel(activeContent, parentId),\n      parentIdea = parentId && activeContent.findSubIdeaById(parentId),\n      numberOfSiblings = (parentIdea && parentIdea.ideas && Object.keys(parentIdea.ideas).length) || 0,\n      attrs = themeObj.getPersistedAttributes(optionalIdeaAttr, parentLevel + 1, numberOfSiblings).attr,\n      attrsToSave = (!_.isEmpty(attrs) && attrs) || undefined;\n    return activeContent.addSubIdea(parentId, ideaTitle, optionalNewId, attrsToSave);\n  },\n  recalcAutoNodeAttrs = (activeContent, themeObj, idea, level, numberOfSiblings) => {\n    'use strict';\n    const updatedAttr = (idea && themeObj.getPersistedAttributes(idea.attr, level, numberOfSiblings)) || {};\n\n    updatedAttr.removed.forEach((key) => activeContent.updateAttr(idea.id, key, false));\n    Object.keys(updatedAttr.attr).forEach((key) => {\n      activeContent.updateAttr(idea.id, key, updatedAttr.attr[key]);\n    });\n  },\n  recalcIdeasAutoNodeAttrs = (activeContent, themeObj, idea, level, numberOfSiblings) => {\n    'use strict';\n    Logger.debug('recalcIdeasAutoNodeAttrs idea.id', idea.id, 'level', level, 'numberOfSiblings', numberOfSiblings); //eslint-disable-line\n    if (level > 0) {\n      recalcAutoNodeAttrs(activeContent, themeObj, idea, level, numberOfSiblings);\n    }\n    if (idea.ideas) {\n      let siblingIndex = 0;\n      Object.keys(idea.ideas).forEach((childIdeaKey) => {\n        recalcIdeasAutoNodeAttrs(activeContent, themeObj, idea.ideas[childIdeaKey], level + 1, siblingIndex);\n        siblingIndex += 1;\n      });\n    }\n  },\n  changeParent = (activeContent, themeObj, ideaId, newParentId) => {\n    'use strict';\n    if (!themeObj) {\n      return activeContent.changeParent(ideaId, newParentId);\n    }\n    let result;\n    const newParent = activeContent.findSubIdeaById(newParentId),\n      numberOfSiblings = (newParent && newParent.ideas && Object.keys(newParent.ideas).length) || 0,\n      parentLevel = calcIdeaLevel(activeContent, newParentId);\n\n    activeContent.batch(() => {\n      activeContent.changeParent(ideaId, newParentId);\n      const idea = activeContent.findSubIdeaById(ideaId);\n      recalcAutoNodeAttrs(activeContent, themeObj, idea, parentLevel + 1, numberOfSiblings);\n      let childSiblings = 0;\n      if (idea.ideas) {\n        Object.keys(idea.ideas).forEach((childIdeaKey) => {\n          recalcAutoNodeAttrs(activeContent, themeObj, idea.ideas[childIdeaKey], parentLevel + 2, childSiblings);\n          childSiblings += 1;\n        });\n      }\n    });\n    return result;\n  },\n  pasteMultiple = (activeContent, themeObj, parentId, contents) => {\n    'use strict';\n    if (!themeObj) {\n      return activeContent.pasteMultiple(parentId, contents);\n    }\n    const level = calcIdeaLevel(activeContent, parentId),\n      parent = (parentId && activeContent.findSubIdeaById(parentId)) || activeContent,\n      existingSiblings = (parent.ideas && Object.keys(parent.ideas).length) || 0;\n\n    contents.forEach((idea) => {\n      traverse(idea, (subIdea) => themeObj.cleanPersistedAttributes(subIdea.attr));\n    });\n    let pastedIds = false, siblings = existingSiblings;\n    activeContent.batch(() => {\n      pastedIds = activeContent.pasteMultiple(parentId, contents);\n      if (pastedIds && pastedIds.length) {\n        pastedIds.forEach((pastedId) => {\n          const idea = activeContent.findSubIdeaById(pastedId);\n          recalcIdeasAutoNodeAttrs(activeContent, themeObj, idea, level + 1, siblings);\n          siblings += 1;\n        });\n      }\n      return pastedIds;\n    });\n    return pastedIds;\n\n  },\n  insertIntermediateMultiple = (activeContent, themeObj, inFrontOfIdeaIds, ideaOptions) => {\n    'use strict';\n    if (!themeObj) {\n      return activeContent.insertIntermediateMultiple(inFrontOfIdeaIds, ideaOptions);\n    }\n\n    const ideaOptionsSafe = _.extend({}, ideaOptions),\n      inFrontOfIdeaId = themeObj && inFrontOfIdeaIds && inFrontOfIdeaIds[0],\n      inFrontOfIdea = inFrontOfIdeaId && activeContent.findSubIdeaById(inFrontOfIdeaId),\n      level = inFrontOfIdeaId && calcIdeaLevel(activeContent, inFrontOfIdeaId),\n      insertAttr = (inFrontOfIdea && inFrontOfIdea.attr) || {},\n      siblingIds = activeContent.sameSideSiblingIds(inFrontOfIdeaId),\n      numberOfSiblings = (siblingIds && siblingIds.length) || 0,\n      attrs = themeObj.getPersistedAttributes(insertAttr, level, numberOfSiblings).attr;\n\n    ideaOptionsSafe.attr = _.extend({}, ideaOptionsSafe.attr, attrs);\n    let result;\n    activeContent.batch(() => {\n      result = activeContent.insertIntermediateMultiple(inFrontOfIdeaIds, ideaOptionsSafe);\n      let siblings = 0;\n      inFrontOfIdeaIds.forEach((movedIdeaId) => {\n        const movedIdea = activeContent.findSubIdeaById(movedIdeaId);\n        recalcAutoNodeAttrs(activeContent, themeObj, movedIdea, level + 1, siblings);\n        siblings += 1;\n      });\n    });\n    return result;\n\n  };\n\nmodule.exports = {\n  addSubIdea: addSubIdea,\n  changeParent: changeParent,\n  insertIntermediateMultiple: insertIntermediateMultiple,\n  pasteMultiple: pasteMultiple,\n  recalcIdeasAutoNodeAttrs: recalcIdeasAutoNodeAttrs\n};\n","/*global module, require*/\nconst _ = require('underscore');\n\nmodule.exports = function calcIdeaLevel(contentIdea, nodeId, currentLevel) {\n  'use strict';\n  if (!contentIdea) {\n    throw 'invalid-args';\n  }\n  if (contentIdea.id == nodeId) { //eslint-disable-line eqeqeq\n    return currentLevel || 0;\n  }\n  if (!nodeId) {\n    return;\n  }\n  currentLevel = currentLevel || 1;\n\n  const directChild = _.find(contentIdea.ideas, function (idea) {\n    return idea.id == nodeId; //eslint-disable-line eqeqeq\n  });\n  if (directChild) {\n    return currentLevel;\n  }\n\n  return _.reduce(contentIdea.ideas, function (result, idea) {\n    return result || calcIdeaLevel(idea, nodeId, currentLevel + 1);\n  }, undefined);\n};\n","/*global module, require */\nconst _ = require('underscore');\nmodule.exports = function contentUpgrade(content) {\n  'use strict';\n  const upgradeV2 = function () {\n      const doUpgrade = function (idea) {\n        let collapsed;\n        if (idea.style) {\n          idea.attr = {};\n          collapsed = idea.style.collapsed;\n          delete idea.style.collapsed;\n          idea.attr.style = idea.style;\n          if (collapsed) {\n            idea.attr.collapsed = collapsed;\n          }\n          delete idea.style;\n        }\n        if (idea.ideas) {\n          _.each(idea.ideas, doUpgrade);\n        }\n      };\n      if (content.formatVersion && content.formatVersion >= 2) {\n        return;\n      }\n      doUpgrade(content);\n      content.formatVersion = 2;\n    },\n    upgradeV3 = function () {\n      const doUpgrade = function () {\n        const rootAttrKeys = ['theme', 'themeOverrides', 'measurements-config', 'storyboards', 'progress-statuses'],\n          oldRootAttr = (content && content.attr) || {},\n          newRootAttr = _.pick(oldRootAttr, rootAttrKeys),\n          newRootNodeAttr = _.omit(oldRootAttr, rootAttrKeys),\n          firstLevel = (content && content.ideas),\n          newRoot = {\n            id: content.id,\n            title: content.title,\n            attr: newRootNodeAttr\n          };\n        if (firstLevel) {\n          newRoot.ideas = firstLevel;\n        }\n        content.id = 'root';\n        content.ideas = {\n          1: newRoot\n        };\n        delete content.title;\n        content.attr = newRootAttr;\n      };\n      if (content.formatVersion && content.formatVersion >= 3) {\n        return;\n      }\n      doUpgrade();\n      content.formatVersion = 3;\n    };\n\n  upgradeV2();\n  upgradeV3();\n  return content;\n};\n","/*jshint loopfunc:true */\n/*global module, require, logMyErrors, Logger */\nconst _ = require('underscore'),\n  observable = require('../util/observable'),\n  contentUpgrade = require('./content-upgrade');\nmodule.exports = function content(contentAggregate, initialSessionId) {\n  'use strict';\n  let cachedId,\n    sessionKey = initialSessionId,\n    configuration = {},\n    isRedoInProgress = false;\n\n  // New function to handle max call stack size exceeded errors\n  const handleRangeError = function (e, calling_function_name) {\n      if (e instanceof RangeError) { // Uncaught RangeError RangeError: Maximum call stack size exceeded\n        Logger.dir(`Caught RangeError in ${calling_function_name}, returning false: ${e}`);\n        return false;\n      } else {\n        Logger.error(e); // Can't find logMyErrors(), so putting this in too.\n        logMyErrors(e); // pass exception object to error handler\n        return true;\n      }\n    },\n    invalidateIdCache = function () {\n      cachedId = undefined;\n    },\n    maxId = function maxId(idea) {\n      idea = idea || contentAggregate;\n      if (!idea.ideas) {\n        return parseInt(idea.id, 10) || 0;\n      }\n      return _.reduce(\n        idea.ideas,\n        function (result, subidea) {\n          return Math.max(result, maxId(subidea));\n        },\n        parseInt(idea.id, 10) || 0\n      );\n    },\n    nextId = function nextId(originSession) {\n      originSession = originSession || sessionKey;\n      if (!cachedId) {\n        cachedId = maxId();\n      }\n      cachedId += 1;\n      if (originSession) {\n        return cachedId + '.' + originSession;\n      }\n      return cachedId;\n    },\n    init = function (contentIdea, originSession) {\n      const initOfRoot = contentIdea.id === contentAggregate.id;\n      if (!contentIdea.id) {\n        contentIdea.id = nextId(originSession);\n      } else {\n        invalidateIdCache();\n      }\n      if (contentIdea.ideas) {\n        _.each(contentIdea.ideas, function (value, key) {\n          if (!initOfRoot && value.attr && value.attr.group && _.isEmpty(value.ideas)) {\n            delete contentIdea.ideas[key];\n          } else {\n            contentIdea.ideas[parseFloat(key)] = init(value, originSession);\n          }\n        });\n      }\n      if (!contentIdea.title) {\n        contentIdea.title = '';\n      }\n      contentIdea.containsDirectChild = contentIdea.findChildRankById = function (childIdeaId) {\n        // Added because it looks like max call stack size exceed thrown here too.\n        //   TODO: Can I focus try on more specific line, like the anon function inside reduce?\n        try {\n          return parseFloat(\n            _.reduce(\n              contentIdea.ideas,\n              function (res, value, key) {\n                // In case value is undefined:\n                return value && value.id == childIdeaId ? key : res; //eslint-disable-line eqeqeq\n              },\n              undefined\n            )\n          );\n        } catch (e) {\n          return handleRangeError(e, 'findChildRankById');\n        }\n      };\n      contentIdea.findSubIdeaById = function (childIdeaId) {\n        const myChild = _.find(contentIdea.ideas, function (idea) {\n          // return idea.id == childIdeaId; //eslint-disable-line eqeqeq\n          return idea && idea.id == childIdeaId; //eslint-disable-line eqeqeq\n        });\n        return myChild || _.reduce(contentIdea.ideas, function (result, idea) {\n          // If idea is undefined, returns undefined\n          return result || (idea ? idea.findSubIdeaById(childIdeaId) : undefined);\n        }, undefined);\n      };\n      contentIdea.isEmptyGroup = function () {\n        return !contentAggregate.isRootNode(contentIdea.id) && contentIdea.attr && contentIdea.attr.group && _.isEmpty(contentIdea.ideas);\n      };\n\n      // Deletes empty group without breaking undo/redo\n      contentIdea.deleteIfEmptyGroup = function (originSession) {\n        // eslint-disable-next-line no-use-before-define\n        contentIdea.isEmptyGroup() ? commandProcessors.removeSubIdea(originSession, contentIdea.id) : null;\n      };\n\n      contentIdea.find = function (predicate) {\n        const current = predicate(contentIdea) ? [_.pick(contentIdea, 'id', 'title')] : [];\n        if (_.size(contentIdea.ideas) === 0) {\n          return current;\n        }\n        return _.reduce(contentIdea.ideas, function (result, idea) {\n          return _.union(result, idea.find(predicate));\n        }, current);\n      };\n      contentIdea.getAttr = function (name) {\n        if (contentIdea.attr && contentIdea.attr[name]) {\n          return _.clone(contentIdea.attr[name]);\n        }\n        return false;\n      };\n      contentIdea.sortedSubIdeas = function () {\n        const result = [],\n          childKeys = contentIdea.ideas && _.groupBy(_.map(_.keys(contentIdea.ideas), parseFloat), function (key) {\n            return key > 0;\n          }),\n          sortedChildKeys = childKeys && _.sortBy(childKeys[true], Math.abs).concat(_.sortBy(childKeys[false], Math.abs)); //eslint-disable-line dot-notation\n\n        if (!contentIdea.ideas) {\n          return [];\n        }\n\n        _.each(sortedChildKeys, function (key) {\n          result.push(contentIdea.ideas[key]);\n        });\n        return result;\n      };\n      contentIdea.traverse = function (iterator, postOrder) {\n        if (!postOrder && contentIdea !== contentAggregate) {\n          iterator(contentIdea);\n        }\n        _.each(contentIdea.sortedSubIdeas(), function (subIdea) {\n          subIdea.traverse(iterator, postOrder);\n        });\n        if (postOrder && contentIdea !== contentAggregate) {\n          iterator(contentIdea);\n        }\n      };\n      return contentIdea;\n    },\n    maxKey = function (kvMap, sign) {\n      let currentKeys = [];\n      sign = sign || 1;\n      if (_.size(kvMap) === 0) {\n        return 0;\n      }\n      currentKeys = _.keys(kvMap);\n      currentKeys.push(0); /* ensure at least 0 is there for negative ranks */\n      return _.max(_.map(currentKeys, parseFloat), function (x) {\n        return x * sign;\n      });\n    },\n    isRootNode = function (id) {\n      // Often throws max call stack size exceeded errors, so testing try catch:\n      try {\n        return !!_.find(contentAggregate.ideas, function (idea) {\n          return idea.id === id;\n        });\n      } catch (e) {\n        // New function to handle max call stack size exceeded errors.\n        return handleRangeError(e, 'isRootNode');\n      }\n    },\n    nextChildRank = function (parentIdea) {\n      let newRank = 0, counts = 0, childRankSign = 1;\n      if (isRootNode(parentIdea.id)) {\n        counts = _.countBy(parentIdea.ideas, function (v, k) {\n          return k < 0;\n        });\n        if ((counts['true'] || 0) < counts['false']) { //eslint-disable-line dot-notation\n          childRankSign = -1;\n        }\n      }\n      newRank = maxKey(parentIdea.ideas, childRankSign) + childRankSign;\n      return newRank;\n    },\n    appendSubIdea = function (parentIdea, subIdea) {\n      let rank = 0;\n      parentIdea.ideas = parentIdea.ideas || {};\n      rank = nextChildRank(parentIdea);\n      parentIdea.ideas[rank] = subIdea;\n      return rank;\n    },\n    findIdeaById = function (ideaId) {\n      return contentAggregate.id == ideaId ? contentAggregate : contentAggregate.findSubIdeaById(ideaId); //eslint-disable-line eqeqeq\n    },\n    sameSideSiblingRanks = function (parentIdea, ideaRank) {\n      return _.reject((_.map(_.keys(parentIdea.ideas), parseFloat)), function (k) {\n        return k * ideaRank < 0;\n      });\n    },\n    sign = function (number) {\n      /* intentionally not returning 0 case, to help with split sorting into 2 groups */\n      return number < 0 ? -1 : 1;\n    },\n    eventStacks = {},\n    redoStacks = {},\n\n    batches = {},\n    // Adds undo and redo stacks to idea, in case I want to access this for debugging etc:\n    // contentAggregate.eventStacks = eventStacks;\n    // contentAggregate.redoStacks = redoStacks;\n\n    notifyChange = function (method, args, originSession) {\n      if (originSession) {\n        contentAggregate.dispatchEvent('changed', method, args, originSession);\n      } else {\n        contentAggregate.dispatchEvent('changed', method, args);\n      }\n    },\n    logChange = function (method, args, undofunc, originSession) {\n      const event = { eventMethod: method, eventArgs: args, undoFunction: undofunc };\n      if (batches[originSession]) {\n        batches[originSession].push(event);\n        return;\n      }\n      if (!eventStacks[originSession]) {\n        eventStacks[originSession] = [];\n      }\n      eventStacks[originSession].push(event);\n\n      if (isRedoInProgress) {\n        contentAggregate.dispatchEvent('changed', 'redo', undefined, originSession);\n      } else {\n        notifyChange(method, args, originSession);\n        redoStacks[originSession] = [];\n      }\n    },\n    appendChange = function (method, args, undofunc, originSession) {\n      const executeOutsideBatch = function () {\n        const prev = eventStacks[originSession].pop();\n        if (prev.eventMethod === 'batch') {\n          eventStacks[originSession].push({\n            eventMethod: 'batch',\n            eventArgs: prev.eventArgs.concat([[method].concat(args)]),\n            undoFunction: function () {\n              undofunc();\n              prev.undoFunction();\n            }\n          });\n        } else {\n          eventStacks[originSession].push({\n            eventMethod: 'batch',\n            eventArgs: [[prev.eventMethod].concat(prev.eventArgs)].concat([[method].concat(args)]),\n            undoFunction: function () {\n              undofunc();\n              prev.undoFunction();\n            }\n          });\n        }\n        if (isRedoInProgress) {\n          contentAggregate.dispatchEvent('changed', 'redo', undefined, originSession);\n        } else {\n          notifyChange(method, args, originSession);\n          redoStacks[originSession] = [];\n        }\n      };\n\n      if (method === 'batch' || batches[originSession] || !eventStacks || !eventStacks[originSession] || eventStacks[originSession].length === 0) {\n        logChange(method, args, undofunc, originSession);\n        return;\n      } else {\n        executeOutsideBatch();\n      }\n    },\n    reorderChild = function (parentIdea, newRank, oldRank) {\n      const undoFunction = function () {\n        if (parentIdea.ideas[oldRank] || !parentIdea.ideas[newRank]) {\n          return false;\n        }\n        parentIdea.ideas[oldRank] = parentIdea.ideas[newRank];\n        delete parentIdea.ideas[newRank];\n      };\n      parentIdea.ideas[newRank] = parentIdea.ideas[oldRank];\n      delete parentIdea.ideas[oldRank];\n      return undoFunction;\n    },\n    sessionFromId = function (id) {\n      const dotIndex = String(id).indexOf('.');\n      return dotIndex > 0 && id.substr(dotIndex + 1);\n    },\n    commandProcessors = {},\n\n    uniqueResourcePostfix = '/xxxxxxxx-yxxx-yxxx-yxxx-xxxxxxxxxxxx/'.replace(/[xy]/g, function (c) {\n      const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n      return v.toString(16);\n    }) + (sessionKey || ''),\n    updateAttr = function (object, attrName, attrValue) {\n      const oldAttr = object && _.extend({}, object.attr);\n      if (!object) {\n        return false;\n      }\n      object.attr = _.extend({}, object.attr);\n      if (!attrValue || attrValue === 'false' || (_.isObject(attrValue) && _.isEmpty(attrValue))) {\n        if (!object.attr[attrName]) {\n          return false;\n        }\n        delete object.attr[attrName];\n      } else {\n        if (_.isEqual(object.attr[attrName], attrValue)) {\n          return false;\n        }\n        object.attr[attrName] = JSON.parse(JSON.stringify(attrValue));\n      }\n      if (_.size(object.attr) === 0) {\n        delete object.attr;\n      }\n      return function () {\n        object.attr = oldAttr;\n      };\n    },\n    findLinkBetween = function (ideaIdFrom, ideaIdTo) {\n      return _.find(\n        contentAggregate.links,\n        function (link) {\n          return (link.ideaIdFrom === ideaIdFrom && link.ideaIdTo === ideaIdTo) || (link.ideaIdFrom === ideaIdTo && link.ideaIdTo === ideaIdFrom);\n        });\n    },\n    isLinkValid = function (ideaIdFrom, ideaIdTo) {\n      const ideaFrom = findIdeaById(ideaIdFrom),\n        ideaTo = findIdeaById(ideaIdTo),\n        isParentChild = ideaFrom && ideaTo && (\n          _.find(ideaFrom.ideas, function (node) {\n            return node.id === ideaIdTo;\n          }) ||\n          _.find(ideaTo.ideas, function (node) {\n            return node.id === ideaIdFrom;\n          })\n        );\n\n      if (ideaIdFrom === ideaIdTo) {\n        return false;\n      }\n      if (!ideaFrom) {\n        return false;\n      }\n      if (!ideaTo) {\n        return false;\n      }\n      if (isParentChild) {\n        return false;\n      }\n      return true;\n    },\n    findLinkDirectional = function (ideaIdFrom, ideaIdTo) {\n      return _.find(\n        contentAggregate.links,\n        function (link) {\n          return link.ideaIdFrom == ideaIdFrom && link.ideaIdTo == ideaIdTo; //eslint-disable-line eqeqeq\n        }\n      );\n    };\n\n\n  contentAggregate.setConfiguration = function (config) {\n    configuration = config || {};\n  };\n  contentAggregate.getSessionKey = function () {\n    return sessionKey;\n  };\n  contentAggregate.setSessionKey = function (newSessionKey) {\n    if (contentAggregate.isBatchActive()) {\n      throw 'batch-is-active';\n    }\n    sessionKey = newSessionKey;\n  };\n  contentAggregate.nextSiblingId = function (subIdeaId) {\n    const parentIdea = contentAggregate.findParent(subIdeaId),\n      currentRank = parentIdea && parentIdea.findChildRankById(subIdeaId),\n      candidateSiblingRanks = currentRank && sameSideSiblingRanks(parentIdea, currentRank),\n      siblingsAfter = candidateSiblingRanks && _.reject(candidateSiblingRanks, function (k) {\n        return Math.abs(k) <= Math.abs(currentRank);\n      });\n\n    if (!parentIdea) {\n      return false;\n    }\n\n    if (siblingsAfter.length === 0) {\n      return false;\n    }\n    return parentIdea.ideas[_.min(siblingsAfter, Math.abs)].id;\n  };\n  contentAggregate.sameSideSiblingIds = function (subIdeaId) {\n    // ISSUE: idea.sameSideSiblingIds(nodeId) can return deleted grouping (e.g. green, supporting) node, which means node is undefined in next line:\n\n    // This line was throwing error on root node, so re-applied fix from commit 'allow insertIntermediate to add parent(s) to root nodes' (`98059f9ff83a681d13ab764f4b03068766211d2d`):\n    // const parentIdea = contentAggregate.findParent(subIdeaId),\n    let parentIdea;\n    if (contentAggregate.isRootNode(subIdeaId)) {\n      parentIdea = contentAggregate;\n    } else {\n      parentIdea = contentAggregate.findParent(subIdeaId);\n    }\n    const currentRank = parentIdea.findChildRankById(subIdeaId);\n    return _.without(_.map(_.pick(parentIdea.ideas, sameSideSiblingRanks(parentIdea, currentRank)), function (i) {\n      return i.id;\n    }), subIdeaId);\n  };\n  contentAggregate.getAttrById = function (ideaId, attrName) {\n    const idea = findIdeaById(ideaId);\n    return idea && idea.getAttr(attrName);\n  };\n  contentAggregate.previousSiblingId = function (subIdeaId) {\n    const parentIdea = contentAggregate.findParent(subIdeaId),\n      currentRank = parentIdea && parentIdea.findChildRankById(subIdeaId),\n      candidateSiblingRanks = currentRank && sameSideSiblingRanks(parentIdea, currentRank),\n      siblingsBefore = candidateSiblingRanks && _.reject(candidateSiblingRanks, function (k) {\n        return Math.abs(k) >= Math.abs(currentRank);\n      });\n\n    if (!parentIdea) {\n      return false;\n    }\n\n    if (siblingsBefore.length === 0) {\n      return false;\n    }\n    return parentIdea.ideas[_.max(siblingsBefore, Math.abs)].id;\n  };\n  contentAggregate.clone = function (subIdeaId) {\n    const toClone = (subIdeaId && subIdeaId != contentAggregate.id && contentAggregate.findSubIdeaById(subIdeaId)) || contentAggregate; //eslint-disable-line eqeqeq\n    return JSON.parse(JSON.stringify(toClone));\n  };\n  contentAggregate.cloneMultiple = function (subIdeaIdArray) {\n    return _.map(subIdeaIdArray, contentAggregate.clone);\n  };\n  contentAggregate.calculatePath = function (ideaId, currentPath, potentialParent) {\n    if (contentAggregate.isRootNode(ideaId)) {\n      return [];\n    }\n    currentPath = currentPath || [contentAggregate];\n    potentialParent = potentialParent || contentAggregate;\n    if (potentialParent.containsDirectChild(ideaId)) {\n      return currentPath;\n    }\n    return _.reduce(\n      potentialParent.ideas,\n      function (result, child) {\n        return result || contentAggregate.calculatePath(ideaId, [child].concat(currentPath), child);\n      },\n      false\n    );\n  };\n  contentAggregate.getSubTreeIds = function (rootIdeaId) {\n    const result = [],\n      collectIds = function (idea) {\n        if (_.isEmpty(idea.ideas)) {\n          return [];\n        }\n        _.each(idea.sortedSubIdeas(), function (child) {\n          collectIds(child);\n          result.push(child.id);\n        });\n      };\n    collectIds(contentAggregate.findSubIdeaById(rootIdeaId) || contentAggregate);\n    return result;\n  };\n  // TODO: ISSUE: findParent can throw RangeError: Maximum call stack size exceeded if subIdeaId not found\n  contentAggregate.findParent = function (subIdeaId, parentIdea) {\n    parentIdea = parentIdea || contentAggregate;\n    if (contentAggregate.isRootNode(subIdeaId)) {\n      return false;\n    }\n    const child_rank = parentIdea.containsDirectChild(subIdeaId);\n    // Fix: child having rank 0 was being treated as false.\n    // eslint-disable-next-line eqeqeq\n    if (child_rank !== false && !isNaN(child_rank) && child_rank != null) { // != null means also false for undefined\n      return parentIdea;\n    }\n    return _.reduce(\n      parentIdea.ideas,\n      function (result, child) {\n        return result || contentAggregate.findParent(subIdeaId, child);\n      },\n      false\n    );\n  };\n\n  /**** aggregate command processing methods ****/\n  contentAggregate.isBatchActive = function (originSession) {\n    const activeSession = originSession || sessionKey;\n    return !!batches[activeSession];\n  };\n  contentAggregate.startBatch = function (originSession) {\n    const activeSession = originSession || sessionKey;\n    contentAggregate.endBatch(originSession);\n    batches[activeSession] = [];\n  };\n  contentAggregate.discardBatch = function (originSession) {\n    const activeSession = originSession || sessionKey;\n    batches[activeSession] = undefined;\n  };\n  contentAggregate.endBatch = function (originSession) {\n    const activeSession = originSession || sessionKey,\n      inBatch = batches[activeSession],\n      performBatchOperations = function () {\n        const batchArgs = _.map(inBatch, function (event) {\n            return [event.eventMethod].concat(event.eventArgs);\n          }),\n          batchUndoFunctions = _.sortBy(\n            _.map(inBatch, function (event) {\n              return event.undoFunction;\n            }),\n            function (f, idx) {\n              return -1 * idx;\n            }\n          ),\n          undo = function () {\n            _.each(batchUndoFunctions, function (eventUndo) {\n              eventUndo();\n            });\n          };\n        logChange('batch', batchArgs, undo, activeSession);\n      };\n\n    batches[activeSession] = undefined;\n    if (_.isEmpty(inBatch)) {\n      return;\n    }\n    if (_.size(inBatch) === 1) {\n      logChange(inBatch[0].eventMethod, inBatch[0].eventArgs, inBatch[0].undoFunction, activeSession);\n    } else {\n      performBatchOperations();\n    }\n  };\n  contentAggregate.execCommand = function (cmd, args, originSession) {\n    if (!commandProcessors[cmd]) {\n      return false;\n    }\n    return commandProcessors[cmd].apply(contentAggregate, [originSession || sessionKey].concat(_.toArray(args)));\n  };\n\n  contentAggregate.batch = function (batchOp) {\n    const hasActiveBatch = contentAggregate.isBatchActive();\n    let results;\n    if (!hasActiveBatch) {\n      contentAggregate.startBatch();\n    }\n    try {\n      results = batchOp();\n    } catch (e) {\n      if (!hasActiveBatch) {\n        contentAggregate.discardBatch();\n      }\n      throw e;\n    }\n    if (!hasActiveBatch) {\n      contentAggregate.endBatch();\n    }\n    return results;\n  };\n\n  commandProcessors.batch = function (originSession) {\n    contentAggregate.startBatch(originSession);\n    try {\n      _.each(_.toArray(arguments).slice(1), function (event) {\n        contentAggregate.execCommand(event[0], event.slice(1), originSession);\n      });\n    } finally {\n      contentAggregate.endBatch(originSession);\n    }\n  };\n  contentAggregate.pasteMultiple = function (parentIdeaId, jsonArrayToPaste) {\n    return contentAggregate.batch(function () {\n      return _.map(jsonArrayToPaste, function (json) {\n        return contentAggregate.paste(parentIdeaId, json);\n      });\n    });\n  };\n\n  contentAggregate.paste = function (/*parentIdeaId, jsonToPaste, initialId*/) {\n    return contentAggregate.execCommand('paste', arguments);\n  };\n  commandProcessors.paste = function (originSession, parentIdeaId, jsonToPaste, initialId) {\n    const pasteParent = (parentIdeaId == contentAggregate.id) ? contentAggregate : contentAggregate.findSubIdeaById(parentIdeaId), //eslint-disable-line eqeqeq\n      cleanUp = function (json) {\n        const result = _.omit(json, 'ideas', 'id', 'attr');\n        let index = 1, childKeys, sortedChildKeys;\n        result.attr = _.omit(json.attr, configuration.nonClonedAttributes);\n        if (_.isEmpty(result.attr)) {\n          delete result.attr;\n        }\n        if (json.ideas) {\n          childKeys = _.groupBy(_.map(_.keys(json.ideas), parseFloat), function (key) {\n            return key > 0;\n          });\n          sortedChildKeys = _.sortBy(childKeys[true], Math.abs).concat(_.sortBy(childKeys[false], Math.abs)); //eslint-disable-line dot-notation\n          result.ideas = {};\n          _.each(sortedChildKeys, function (key) {\n            result.ideas[index++] = cleanUp(json.ideas[key]); // eslint-disable-line no-plusplus\n          });\n        }\n        return result;\n      };\n\n    let newIdea = undefined, newRank = 0;\n\n    if (initialId) {\n      cachedId = parseInt(initialId, 10) - 1;\n    }\n    newIdea = jsonToPaste && (jsonToPaste.title || jsonToPaste.attr) && init(cleanUp(jsonToPaste), sessionFromId(initialId));\n    if (!pasteParent || !newIdea) {\n      return false;\n    }\n    newRank = appendSubIdea(pasteParent, newIdea);\n    if (initialId) {\n      invalidateIdCache();\n    }\n    updateAttr(newIdea, 'position');\n    logChange('paste', [parentIdeaId, jsonToPaste, newIdea.id], function () {\n      delete pasteParent.ideas[newRank];\n    }, originSession);\n    return newIdea.id;\n  };\n  contentAggregate.flip = function (/*ideaId*/) {\n    return contentAggregate.execCommand('flip', arguments);\n  };\n  commandProcessors.flip = function (originSession, ideaId) {\n    const parentIdea = contentAggregate.findParent(ideaId),\n      currentRank = parentIdea && contentAggregate.isRootNode(parentIdea.id) && parentIdea.findChildRankById(ideaId),\n      performFlip = function () {\n        const maxRank = maxKey(parentIdea.ideas, -1 * sign(currentRank)),\n          newRank = maxRank - 10 * sign(currentRank),\n          undoFunction = reorderChild(parentIdea, newRank, currentRank);\n        logChange('flip', [ideaId], undoFunction, originSession);\n      };\n    if (!currentRank) {\n      return false;\n    }\n    performFlip();\n    return true;\n  };\n  contentAggregate.initialiseTitle = function (/*ideaId, title*/) {\n    return contentAggregate.execCommand('initialiseTitle', arguments);\n  };\n  commandProcessors.initialiseTitle = function (originSession, ideaId, title) {\n    const idea = findIdeaById(ideaId),\n      originalTitle = idea && idea.title;\n\n    if (!idea) {\n      return false;\n    }\n\n    if (originalTitle === title) {\n      return false;\n    }\n    idea.title = title;\n    appendChange('initialiseTitle', [ideaId, title], function () {\n      idea.title = originalTitle;\n    }, originSession);\n    return true;\n  };\n  contentAggregate.updateTitle = function (/*ideaId, title*/) {\n    return contentAggregate.execCommand('updateTitle', arguments);\n  };\n  commandProcessors.updateTitle = function (originSession, ideaId, title) {\n    const idea = findIdeaById(ideaId),\n      originalTitle = idea && idea.title;\n    if (!idea) {\n      return false;\n    }\n    if (originalTitle === title) {\n      return false;\n    }\n    idea.title = title;\n    logChange('updateTitle', [ideaId, title], function () {\n      idea.title = originalTitle;\n    }, originSession);\n    return true;\n  };\n\n  contentAggregate.addSubIdea = function (/*parentId, ideaTitle, optionalNewId, optionalAttr*/) {\n    return contentAggregate.execCommand('addSubIdea', arguments);\n  };\n  commandProcessors.addSubIdea = function (originSession, parentId, ideaTitle, optionalNewId, optionalAttr) {\n    const parent = findIdeaById(parentId),\n      createIdeaParams = () => {\n        const params = {\n          title: ideaTitle,\n          id: optionalNewId\n        };\n        if (optionalAttr) {\n          params.attr = optionalAttr;\n        }\n        return params;\n      },\n      performAdd = function () {\n        const idea = init(createIdeaParams()),\n          newRank = appendSubIdea(parent, idea);\n        logChange('addSubIdea', [parentId, ideaTitle, idea.id, optionalAttr], function () {\n          delete parent.ideas[newRank];\n        }, originSession);\n        return idea.id;\n      };\n    if (!parent) {\n      return false;\n    }\n    if (optionalNewId && findIdeaById(optionalNewId)) {\n      return false;\n    }\n    return performAdd();\n  };\n  contentAggregate.removeMultiple = function (subIdeaIdArray) {\n    let results = false;\n    contentAggregate.startBatch();\n    results = _.map(subIdeaIdArray, contentAggregate.removeSubIdea);\n    contentAggregate.endBatch();\n    return results;\n  };\n\n  contentAggregate.removeSubIdea = function (/*subIdeaId*/) {\n    return contentAggregate.execCommand('removeSubIdea', arguments);\n  };\n  commandProcessors.removeSubIdea = function (originSession, subIdeaId) {\n    // Due to fix I added, possible to now try to remove idea which has already been removed.\n    // So checking for that first, by checking for parent now instead of later on.\n    // Declaring here so it's function scope and can be used in performRemove\n    let parent;\n    try {\n      parent = contentAggregate.findParent(subIdeaId) || contentAggregate;\n    } catch (e) {\n      // New function to handle max call stack size exceeded errors\n      return handleRangeError(e, 'removeSubIdea');\n    }\n\n    const canRemove = function () {\n        return !contentAggregate.isRootNode(subIdeaId) || _.size(contentAggregate.ideas) > 1;\n      },\n      performRemove = function () {\n        // No longer needs to be looked up since it was created earlier:\n        // const parent = contentAggregate.findParent(subIdeaId) || contentAggregate,\n        const oldRank = parent && parent.findChildRankById(subIdeaId),\n          oldIdea = parent && parent.ideas[oldRank],\n          oldLinks = contentAggregate.links,\n          removedNodeIds = {};\n\n        // This fails if oldRank is 0, need to test for undefined etc instead:\n        // if (!oldRank) {\n        // eslint-disable-next-line eqeqeq\n        if (oldRank == null || oldRank === false || isNaN(oldRank)) { // == null tests for undefined too\n          return false;\n        }\n\n        oldIdea.traverse((traversed) => removedNodeIds[traversed.id] = true);\n        delete parent.ideas[oldRank];\n\n        // If parent is now an empty group, delete it:\n        parent.deleteIfEmptyGroup(originSession);\n\n        contentAggregate.links = _.reject(contentAggregate.links, function (link) {\n          return removedNodeIds[link.ideaIdFrom] || removedNodeIds[link.ideaIdTo];\n        });\n        logChange('removeSubIdea', [subIdeaId], function () {\n          parent.ideas[oldRank] = oldIdea;\n          contentAggregate.links = oldLinks;\n        }, originSession);\n        return true;\n      };\n\n    if (!canRemove()) {\n      return false;\n    }\n    return performRemove();\n  };\n  contentAggregate.insertIntermediateMultiple = function (idArray, ideaOptions) {\n    return contentAggregate.batch(function () {\n      const newId = contentAggregate.insertIntermediate(idArray[0], ideaOptions && ideaOptions.title);\n      if (ideaOptions && ideaOptions.attr) {\n        Object.keys(ideaOptions.attr).forEach(function (key) {\n          contentAggregate.updateAttr(newId, key, ideaOptions.attr[key]);\n        });\n      }\n      _.each(idArray.slice(1), function (id) {\n        contentAggregate.changeParent(id, newId);\n      });\n      return newId;\n    });\n  };\n  contentAggregate.insertIntermediate = function (/*inFrontOfIdeaId, title, optionalNewId, optionalAttr*/) {\n    return contentAggregate.execCommand('insertIntermediate', arguments);\n  };\n  commandProcessors.insertIntermediate = function (originSession, inFrontOfIdeaId, title, optionalNewId, optionalAttr) {\n    const parentIdea = contentAggregate.isRootNode(inFrontOfIdeaId) ? contentAggregate : contentAggregate.findParent(inFrontOfIdeaId),\n      childRank = parentIdea && parentIdea.findChildRankById(inFrontOfIdeaId),\n      canInsert = function () {\n        if (contentAggregate.id == inFrontOfIdeaId) { //eslint-disable-line eqeqeq\n          return false;\n        }\n        if (!parentIdea) {\n          return false;\n        }\n        if (optionalNewId && findIdeaById(optionalNewId)) {\n          return false;\n        }\n\n        if (!childRank) {\n          return false;\n        }\n        return true;\n      },\n      performInsert = function () {\n        const createIdeaParams = () => {\n            const params = {\n              title: title,\n              id: optionalNewId\n            };\n            if (optionalAttr) {\n              params.attr = optionalAttr;\n            }\n            return params;\n          },\n          oldIdea = parentIdea.ideas[childRank],\n          newIdea = init(createIdeaParams());\n\n        parentIdea.ideas[childRank] = newIdea;\n        newIdea.ideas = {\n          1: oldIdea\n        };\n        logChange('insertIntermediate', [inFrontOfIdeaId, title, newIdea.id, optionalAttr], function () {\n          parentIdea.ideas[childRank] = oldIdea;\n        }, originSession);\n        return newIdea.id;\n      };\n\n    if (!canInsert()) {\n      return false;\n    }\n    return performInsert();\n\n  };\n  contentAggregate.changeParent = function (/*ideaId, newParentId*/) {\n    return contentAggregate.execCommand('changeParent', arguments);\n  };\n  commandProcessors.changeParent = function (originSession, ideaId, newParentId) {\n    const parent = findIdeaById(newParentId),\n      idea = contentAggregate.findSubIdeaById(ideaId),\n      oldParent = contentAggregate.isRootNode(ideaId) ? contentAggregate : contentAggregate.findParent(ideaId),\n      canChangeParent = function () {\n        if (ideaId == newParentId) { // eslint-disable-line eqeqeq\n          return false;\n        }\n        if (!parent) {\n          return false;\n        }\n\n        if (!idea) {\n          return false;\n        }\n        if (idea.findSubIdeaById(newParentId)) {\n          return false;\n        }\n        if (parent.containsDirectChild(ideaId)) {\n          return false;\n        }\n        if (!oldParent) {\n          return false;\n        }\n        return true;\n      },\n      performChangeParent = function () {\n        const oldRank = oldParent.findChildRankById(ideaId),\n          newRank = appendSubIdea(parent, idea),\n          oldPosition = idea.getAttr('position');\n\n        updateAttr(idea, 'position');\n        delete oldParent.ideas[oldRank];\n\n        // If parent is now an empty group, delete it without breaking undo/redo:\n        oldParent.deleteIfEmptyGroup(originSession);\n\n        logChange('changeParent', [ideaId, newParentId], function () {\n          updateAttr(idea, 'position', oldPosition);\n          oldParent.ideas[oldRank] = idea;\n          delete parent.ideas[newRank];\n        }, originSession);\n      };\n    if (!canChangeParent()) {\n      return false;\n    }\n    performChangeParent();\n    return true;\n  };\n  contentAggregate.mergeAttrProperty = function (ideaId, attrName, attrPropertyName, attrPropertyValue) {\n    let val = contentAggregate.getAttrById(ideaId, attrName) || {};\n    if (attrPropertyValue) {\n      val[attrPropertyName] = attrPropertyValue;\n    } else {\n      delete val[attrPropertyName];\n    }\n    if (_.isEmpty(val)) {\n      val = false;\n    }\n    return contentAggregate.updateAttr(ideaId, attrName, val);\n  };\n  contentAggregate.updateAttr = function (/*ideaId, attrName, attrValue*/) {\n    return contentAggregate.execCommand('updateAttr', arguments);\n  };\n  commandProcessors.updateAttr = function (originSession, ideaId, attrName, attrValue) {\n    const idea = findIdeaById(ideaId),\n      undoAction = updateAttr(idea, attrName, attrValue);\n    if (undoAction) {\n      logChange('updateAttr', [ideaId, attrName, attrValue], undoAction, originSession);\n    }\n    return !!undoAction;\n  };\n  contentAggregate.getOrderedSiblingRanks = function (ideaId, options) {\n    const parentIdea = contentAggregate.findParent(ideaId),\n      currentRank = parentIdea && parentIdea.findChildRankById(ideaId);\n    if (!currentRank) {\n      return false;\n    }\n    if (options && options.ignoreRankSide) {\n      return _.sortBy(_.map(_.keys(parentIdea.ideas), parseFloat));\n    } else {\n      return _.sortBy(sameSideSiblingRanks(parentIdea, currentRank), Math.abs);\n    }\n  };\n  contentAggregate.moveRelative = function (ideaId, relativeMovement, options) {\n    const parentIdea = contentAggregate.findParent(ideaId),\n      currentRank = parentIdea && parentIdea.findChildRankById(ideaId),\n      siblingRanks = contentAggregate.getOrderedSiblingRanks(ideaId, options),\n      currentIndex = siblingRanks && siblingRanks.indexOf(currentRank),\n      calcNewIndex = function () {\n        let calcIndex = currentIndex + (relativeMovement > 0 ? relativeMovement + 1 : relativeMovement);\n        if (options && options.ignoreRankSide) {\n          if (currentRank < 0) {\n            calcIndex = currentIndex + (relativeMovement < 0 ? relativeMovement - 1 : relativeMovement);\n            if (siblingRanks[calcIndex] > 0) {\n              calcIndex = calcIndex + 1;\n            }\n          } else if (siblingRanks[calcIndex] < 0) {\n            calcIndex = calcIndex - 1;\n          }\n        }\n        return calcIndex;\n\n      },\n      /* we call positionBefore, so movement down is actually 2 spaces, not 1 */\n      newIndex = calcNewIndex(),\n      beforeRank = newIndex >= 0 && siblingRanks && siblingRanks.length && siblingRanks[newIndex],\n      beforeSibling = beforeRank && parentIdea && parentIdea.ideas[beforeRank],\n      shouldNotPosition = function () {\n        if (!parentIdea) {\n          return false;\n        }\n        if (options && options.ignoreRankSide && currentRank < 0) {\n          return newIndex > (siblingRanks.length - 1);\n        }\n        return (newIndex < 0);\n      };\n    let result = false;\n    if (shouldNotPosition()) {\n      return false;\n    }\n    contentAggregate.startBatch();\n    //handle reordering on top down maps where moving from positive to negative or vice versa\n    if (options && options.ignoreRankSide && beforeRank && beforeSibling && ((beforeRank * currentRank) < 0)) {\n      contentAggregate.flip(ideaId);\n    }\n    result = contentAggregate.positionBefore(ideaId, beforeSibling && beforeSibling.id, parentIdea);\n    contentAggregate.endBatch();\n    return result;\n  };\n  contentAggregate.positionBefore = function (/*ideaId, positionBeforeIdeaId, parentIdea*/) {\n    return contentAggregate.execCommand('positionBefore', arguments);\n  };\n  commandProcessors.positionBefore = function (originSession, ideaId, positionBeforeIdeaId, parentIdeaArg) {\n    let newRank, afterRank, siblingRanks, candidateSiblings, beforeRank, maxRank, undoFunction = undefined;\n    const parentIdea = parentIdeaArg || contentAggregate.findParent(ideaId),\n      currentRank = parentIdea && parentIdea.findChildRankById(ideaId);\n\n    if (!parentIdea) {\n      return false;\n    }\n\n    if (ideaId == positionBeforeIdeaId) { //eslint-disable-line eqeqeq\n      return false;\n    }\n    newRank = 0;\n    if (positionBeforeIdeaId) {\n      afterRank = parentIdea.findChildRankById(positionBeforeIdeaId);\n      if (!afterRank) {\n        return false;\n      }\n      siblingRanks = sameSideSiblingRanks(parentIdea, afterRank);\n      candidateSiblings = _.reject(_.sortBy(siblingRanks, Math.abs), function (k) {\n        return Math.abs(k) >= Math.abs(afterRank);\n      });\n      beforeRank = candidateSiblings.length > 0 ? _.max(candidateSiblings, Math.abs) : 0;\n      if (beforeRank == currentRank) { //eslint-disable-line eqeqeq\n        return false;\n      }\n      newRank = beforeRank + (afterRank - beforeRank) / 2;\n    } else {\n      maxRank = maxKey(parentIdea.ideas, currentRank < 0 ? -1 : 1);\n      if (maxRank == currentRank) { //eslint-disable-line eqeqeq\n        return false;\n      }\n      newRank = maxRank + 10 * (currentRank < 0 ? -1 : 1);\n    }\n    if (newRank == currentRank) { //eslint-disable-line eqeqeq\n      return false;\n    }\n    undoFunction = reorderChild(parentIdea, newRank, currentRank);\n    logChange('positionBefore', [ideaId, positionBeforeIdeaId], undoFunction, originSession);\n    return true;\n  };\n\n  contentAggregate.addLink = function (/*ideaIdFrom, ideaIdTo*/) {\n    return contentAggregate.execCommand('addLink', arguments);\n  };\n  commandProcessors.addLink = function (originSession, ideaIdFrom, ideaIdTo) {\n    const link = {\n      ideaIdFrom: ideaIdFrom,\n      ideaIdTo: ideaIdTo,\n      attr: {\n        style: {\n          color: 'red', // changed from #707070 grey\n          lineStyle: 'solid',\n          arrow: 'to'\n        }\n      }\n    };\n\n    if (!isLinkValid(ideaIdFrom, ideaIdTo)) {\n      return false;\n    }\n    if (findLinkBetween(ideaIdFrom, ideaIdTo)) {\n      return false;\n    }\n    contentAggregate.links = contentAggregate.links || [];\n    contentAggregate.links.push(link);\n    logChange('addLink', [ideaIdFrom, ideaIdTo], function () {\n      contentAggregate.links.pop();\n    }, originSession);\n    return true;\n  };\n  contentAggregate.removeLink = function (/*ideaIdOne, ideaIdTwo*/) {\n    return contentAggregate.execCommand('removeLink', arguments);\n  };\n  commandProcessors.removeLink = function (originSession, ideaIdOne, ideaIdTwo) {\n    let i = 0, link;\n\n    while (contentAggregate.links && i < contentAggregate.links.length) {\n      link = contentAggregate.links[i];\n      if (link.ideaIdFrom === ideaIdOne && link.ideaIdTo === ideaIdTwo) { //eslint-disable-line eqeqeq\n        contentAggregate.links.splice(i, 1);\n        logChange('removeLink', [ideaIdOne, ideaIdTwo], function () {\n          // Fixes bug with undoing link attribute changes not working\n          //  Was cloning link, so undo was applied to clone, not original link.\n          contentAggregate.links.push(link);\n        }, originSession);\n        return true;\n      }\n      i += 1;\n    }\n    return false;\n  };\n  contentAggregate.getLinkAttr = function (ideaIdFrom, ideaIdTo, name) {\n    const link = findLinkDirectional(ideaIdFrom, ideaIdTo);\n    if (link && link.attr && link.attr[name]) {\n      return link.attr[name];\n    }\n    return false;\n  };\n  contentAggregate.updateLinkAttr = function (/*ideaIdFrom, ideaIdTo, attrName, attrValue*/) {\n    return contentAggregate.execCommand('updateLinkAttr', arguments);\n  };\n  commandProcessors.updateLinkAttr = function (originSession, ideaIdFrom, ideaIdTo, attrName, attrValue) {\n    const link = findLinkDirectional(ideaIdFrom, ideaIdTo),\n      undoAction = updateAttr(link, attrName, attrValue);\n    if (undoAction) {\n      logChange('updateLinkAttr', [ideaIdFrom, ideaIdTo, attrName, attrValue], undoAction, originSession);\n    }\n    return !!undoAction;\n  };\n\n  /* undo/redo */\n  contentAggregate.canUndo = function () {\n    return !!(eventStacks[sessionKey] && eventStacks[sessionKey].length > 0);\n  };\n  contentAggregate.canRedo = function () {\n    return !!(redoStacks[sessionKey] && redoStacks[sessionKey].length > 0);\n  };\n  contentAggregate.undo = function () {\n    return contentAggregate.execCommand('undo', arguments);\n  };\n  commandProcessors.undo = function (originSession) {\n    let topEvent = false;\n    contentAggregate.endBatch();\n    topEvent = eventStacks[originSession] && eventStacks[originSession].pop();\n    if (topEvent && topEvent.undoFunction) {\n      topEvent.undoFunction();\n      if (!redoStacks[originSession]) {\n        redoStacks[originSession] = [];\n      }\n      redoStacks[originSession].push(topEvent);\n      contentAggregate.dispatchEvent('changed', 'undo', [], originSession);\n      return true;\n    }\n    return false;\n  };\n  contentAggregate.redo = function () {\n    return contentAggregate.execCommand('redo', arguments); // Calls commandProcessors for the command\n  };\n  commandProcessors.redo = function (originSession) {\n    let topEvent = false;\n    contentAggregate.endBatch();\n    topEvent = redoStacks[originSession] && redoStacks[originSession].pop();\n    if (topEvent) {\n      isRedoInProgress = true;\n      contentAggregate.execCommand(topEvent.eventMethod, topEvent.eventArgs, originSession);\n      isRedoInProgress = false;\n      return true;\n    }\n    return false;\n  };\n  contentAggregate.storeResource = function (/*resourceBody, optionalKey*/) {\n    return contentAggregate.execCommand('storeResource', arguments);\n  };\n  commandProcessors.storeResource = function (originSession, resourceBody, optionalKey) {\n    const maxIdForSession = function () {\n        const keys = _.keys(contentAggregate.resources),\n          filteredKeys = sessionKey ? _.filter(keys, RegExp.prototype.test.bind(new RegExp('\\\\/' + sessionKey + '$'))) : keys,\n          intKeys = _.map(filteredKeys, function (string) {\n            return parseInt(string, 10);\n          });\n        return _.isEmpty(intKeys) ? 0 : _.max(intKeys);\n      },\n      nextResourceId = function () {\n        const intId = maxIdForSession() + 1;\n        return intId + uniqueResourcePostfix;\n      },\n      getExistingResourceId = function () {\n        if (!optionalKey && contentAggregate.resources) {\n          return _.find(_.keys(contentAggregate.resources), function (key) {\n            return contentAggregate.resources[key] === resourceBody;\n          });\n        }\n      },\n      storeNewResource = function () {\n        const id = optionalKey || nextResourceId();\n        contentAggregate.resources = contentAggregate.resources || {};\n        contentAggregate.resources[id] = resourceBody;\n        contentAggregate.dispatchEvent('resourceStored', resourceBody, id, originSession);\n        return id;\n      };\n\n    return getExistingResourceId() || storeNewResource();\n  };\n  contentAggregate.getResource = function (id) {\n    return contentAggregate.resources && contentAggregate.resources[id];\n  };\n  contentAggregate.hasSiblings = function (id) {\n    const parent = contentAggregate.findParent(id);\n\n    if (contentAggregate.isRootNode(id)) {\n      return false;\n    }\n\n    return parent && _.size(parent.ideas) > 1;\n  };\n  contentAggregate.isRootNode = function (id) {\n    return isRootNode(id);\n  };\n  contentAggregate.getDefaultRootId = function () {\n    const rootNodes = contentAggregate && _.values(contentAggregate.ideas);\n    return rootNodes && rootNodes.length && rootNodes[0].id;\n  };\n\n  contentUpgrade(contentAggregate);\n  observable(contentAggregate);\n  init(contentAggregate);\n  return contentAggregate;\n};\n","/* global module, require */\nconst URLHelper = require('../util/url-helper'),\n  _ = require('underscore');\nmodule.exports = function formatNoteToHtml(noteText) {\n  'use strict';\n  if (!noteText) {\n    return '';\n  }\n  if (typeof noteText !== 'string') {\n    throw 'invalid-args';\n  }\n  const safeString = _.escape(noteText);\n  return URLHelper.formatLinks(safeString);\n};\n","/*global module, require*/\nconst urlHelper = require('../util/url-helper'),\n  removeLinks = function (nodeTitle, maxUrlLength) {\n    'use strict';\n    const strippedTitle = nodeTitle && urlHelper.stripLink(nodeTitle);\n    if (strippedTitle.trim() === '') {\n      return (!maxUrlLength || (nodeTitle.length < maxUrlLength) ? nodeTitle : (nodeTitle.substring(0, maxUrlLength) + '...'));\n    } else {\n      return strippedTitle;\n    }\n  },\n  removeExtraSpaces = function (nodeTitle) {\n    'use strict';\n    return nodeTitle.replace(/[ \\t]+/g, ' ');\n  },\n  cleanNonPrintable = function (nodeTitle) {\n    'use strict';\n    return nodeTitle.replace(/[\\u0000-\\u0008\\u000B-\\u000C\\u000E-\\u001F\\u007F\\u0080-\\u009F]+/gu, '');\n  },\n  trimLines = function (nodeTitle) {\n    'use strict';\n    return nodeTitle.replace(/\\r/g, '').split('\\n').map(line => line.trim()).join('\\n');\n  };\nmodule.exports = function (nodeTitle, maxUrlLength) {\n  'use strict';\n  if (!nodeTitle || !nodeTitle.trim()) {\n    return '';\n  }\n  const sanitizedTitle = cleanNonPrintable(nodeTitle),\n    withoutLinks = removeLinks(sanitizedTitle, maxUrlLength),\n    withConsolidatedSpaces = removeExtraSpaces(withoutLinks);\n  return trimLines(withConsolidatedSpaces);\n};\n\n","/* global require, module */\nconst _ = require('underscore');\nmodule.exports = function isEmptyGroup(contentIdea) {\n  'use strict';\n  return contentIdea.attr && contentIdea.attr.group && _.isEmpty(contentIdea.ideas);\n};\n","/*global module */\nconst positive = function positive(key) {\n    'use strict';\n    return key >= 0;\n  },\n  negative = function negative(key) {\n    'use strict';\n    return !positive(key);\n  },\n  absCompare = function (a, b) {\n    'use strict';\n    return Math.abs(a) - Math.abs(b);\n  },\n  safeSort = function (contentIdea) {\n    'use strict';\n    const childKeys = Object.keys(contentIdea.ideas).map(parseFloat),\n      sortedChildKeys = childKeys.filter(positive).sort(absCompare).concat(childKeys.filter(negative).sort(absCompare));\n    return sortedChildKeys.map(function (key) {\n      return contentIdea.ideas[key];\n    });\n  };\nmodule.exports = function sortedSubIdeas(contentIdea) {\n  'use strict';\n\n  if (!contentIdea.ideas) {\n    return [];\n  }\n  return safeSort(contentIdea);\n};\n\n","/*global module, require */\nconst sortedSubIdeas = require('./sorted-sub-ideas');\nmodule.exports = function traverse(contentIdea, iterator, postOrder, level) {\n  'use strict';\n  const isSingleRootMap = !level && (!contentIdea.formatVersion || contentIdea.formatVersion < 3);\n  level = level || (isSingleRootMap ? 1 : 0);\n  if (!postOrder && (isSingleRootMap || level)) {\n    iterator(contentIdea, level);\n  }\n  sortedSubIdeas(contentIdea).forEach(function (subIdea) {\n    traverse(subIdea, iterator, postOrder, level + 1);\n  });\n  if (postOrder && (isSingleRootMap || level)) {\n    iterator(contentIdea, level);\n  }\n};\n\n","/*global module, require*/\nconst isObjectObject = require('./is-object-object'),\n  isNotRecursableObject = value => {\n    'use strict';\n    return !isObjectObject(value);\n  };\nmodule.exports = function deepAssign() {\n  'use strict';\n  const args = Array.prototype.slice.call(arguments, 0),\n    assignee = (args && args[0]),\n    assigners = (args && args.length > 1 && args.slice(1)) || [];\n  if (!assignee || args.find(isNotRecursableObject)) {\n    throw new Error('invalid-args');\n  }\n  assigners.forEach(assigner => {\n    Object.keys(assigner)\n      .forEach(key => {\n        if (isObjectObject(assigner[key]) && isObjectObject(assignee[key])) {\n          assignee[key] = deepAssign({}, assignee[key], assigner[key]);\n        } else if (isObjectObject(assigner[key])) {\n          assignee[key] = deepAssign({}, assigner[key]);\n        } else {\n          assignee[key] = assigner[key];\n        }\n\n      });\n  });\n  return assignee;\n};\n","/*global module*/\nmodule.exports = function isObjectObject(value) {\n  'use strict';\n  if (!value) {\n    return false;\n  }\n  const type = typeof value;\n  if (type === 'object') {\n    return Object.prototype.toString.call(value) === '[object Object]';\n  }\n  return false;\n};\n","/*global module, require*/\nconst contentUpgrade = require('../content/content-upgrade'),\n  Theme = require('../theme/theme'),\n  extractConnectors = require('./extract-connectors'),\n  extractLinks = require('./extract-links'),\n  MultiRootLayout = require('./multi-root-layout'),\n  nodeAttributeUtils = require('./node-attribute-utils'),\n  defaultLayouts = {\n    'standard': require('./standard/calculate-standard-layout'),\n    'top-down': require('./top-down/calculate-top-down-layout')\n  },\n  formatResult = function (result, idea, theme, orientation) {\n    'use strict';\n    nodeAttributeUtils.setThemeAttributes(result, theme);\n    return {\n      orientation: orientation,\n      nodes: result,\n      connectors: extractConnectors(idea, result, theme),\n      links: extractLinks(idea, result),\n      theme: idea.attr && idea.attr.theme,\n      themeOverrides: Object.assign({}, idea.attr && idea.attr.themeOverrides)\n    };\n  };\n\nmodule.exports = function calculateLayout(idea, dimensionProvider, optional) {\n  'use strict';\n  const layouts = (optional && optional.layouts) || defaultLayouts,\n    theme = (optional && optional.theme) || new Theme({}),\n    multiRootLayout = new MultiRootLayout(),\n    margin = theme.attributeValue(['layout'], [], ['spacing'], { h: 20, v: 20 }),\n    orientation = theme.attributeValue(['layout'], [], ['orientation'], 'standard'),\n    calculator = layouts[orientation] || layouts.standard;\n\n  idea = contentUpgrade(idea);\n\n  Object.keys(idea.ideas).forEach(function (rank) {\n    const rootIdea = idea.ideas[rank],\n      rootResult = calculator(rootIdea, dimensionProvider, { h: (margin.h || margin), v: (margin.v || margin) });\n    multiRootLayout.appendRootNodeLayout(rootResult, rootIdea);\n  });\n\n  return formatResult(multiRootLayout.getCombinedLayout(10, optional), idea, theme, orientation);\n  // result = calculator(idea, dimensionProvider, {h: (margin.h || margin), v: (margin.v || margin)});\n\n};\n\n","/*global module, require */\nconst _ = require('underscore');\nmodule.exports = function extractConnectors(aggregate, visibleNodes, theme) {\n  'use strict';\n  const result = {},\n    // TODO: Remove blockParentConnectorOverride once site has been live for a while\n    allowParentConnectorOverride = !(theme && (theme.connectorEditingContext || theme.blockParentConnectorOverride)),\n    traverse = function (idea, parentId, isChildNode) {\n      if (isChildNode) {\n        const visibleNode = visibleNodes[idea.id];\n        if (!visibleNode) {\n          return;\n        }\n        if (parentId !== aggregate.id) {\n          result[idea.id] = {\n            type: 'connector',\n            from: parentId,\n            to: idea.id\n          };\n          if (visibleNode.attr && visibleNode.attr.parentConnector) {\n            if (allowParentConnectorOverride && visibleNode.attr && visibleNode.attr.parentConnector) {\n              result[idea.id].attr = _.clone(visibleNode.attr.parentConnector);\n            } else if (theme && theme.connectorEditingContext && theme.connectorEditingContext.allowed && theme.connectorEditingContext.allowed.length) {\n              result[idea.id].connectorEditingContext = theme.connectorEditingContext;\n              result[idea.id].attr = _.pick(visibleNode.attr.parentConnector, theme.connectorEditingContext.allowed);\n            }\n          }\n        }\n      }\n      if (idea.ideas) {\n        Object.keys(idea.ideas).forEach(function (subNodeRank) {\n          traverse(idea.ideas[subNodeRank], idea.id, true);\n        });\n      }\n    };\n  traverse(aggregate);\n  return result;\n};\n","/*global module, require*/\nconst _ = require('underscore');\nmodule.exports = function extractLinks(idea, visibleNodes) {\n  'use strict';\n  const result = {};\n  _.each(idea.links, function (link) {\n    if (visibleNodes[link.ideaIdFrom] && visibleNodes[link.ideaIdTo]) {\n      result[link.ideaIdFrom + '_' + link.ideaIdTo] = {\n        type: 'link',\n        ideaIdFrom: link.ideaIdFrom,\n        ideaIdTo: link.ideaIdTo,\n        attr: _.clone(link.attr)\n      };\n    }\n  });\n  return result;\n};\n\n","/*global module, require */\nconst _ = require('underscore'),\n  PolyBool = require('polybooljs'),\n  convexHull = require('monotone-convex-hull-2d'),\n  dotProduct = function (p1, p2) {\n    'use strict';\n    return (p1[0] * p2[0]) + (p1[1] * p2[1]);\n  },\n  unitVector = function (vector) {\n    'use strict';\n    const magnitude = Math.sqrt(Math.pow(vector[0], 2) + Math.pow(vector[1], 2));\n    if (magnitude === 0) {\n      return [0, 0];\n    }\n    return [vector[0] / magnitude, vector[1] / magnitude];\n  },\n  toPolyBoolPoly = function (poly) {\n    'use strict';\n    return {\n      regions: poly,\n      inverted: false\n    };\n  },\n  arePointsEqual = function (p1, p2) {\n    'use strict';\n    return p1 && p2 && p1.length === 2 && p2.length === 2 && p1[0] === p2[0] && p1[1] === p2[1];\n  },\n  areShapesEqual = function (shape1, shape2) {\n    'use strict';\n    if (!shape1 || !shape2 || shape1.length !== shape2.length) {\n      return false;\n    }\n    return _.filter(shape1, function (p1) {\n      return _.filter(shape2, function (p2) {\n        return arePointsEqual(p1, p2);\n      }).length;\n    }).length === shape1.length;\n  },\n  polygonsAreEqual = function (poly1, poly2) {\n    'use strict';\n    const matchingShapes = function () {\n      return _.filter(poly1, function (shape1) {\n        return _.filter(poly2, function (shape2) {\n          return areShapesEqual(shape1, shape2);\n        }).length;\n      });\n    };\n    if (poly1.length > poly2.length) {\n      return false;\n    }\n\n    // if (true || matchingShapes.length) {\n    //   Logger.debug('matchingShapes.length === poly1.length', matchingShapes.length === poly1.length, 'matchingShapes', matchingShapes, 'poly1', poly1, 'poly2', poly2);\n\n    // }\n    return matchingShapes().length === poly1.length;\n  },\n  shapeContainingIntersection = function (poly, intersection) {\n    'use strict';\n    const pbIntersection = toPolyBoolPoly(intersection),\n      containingShape = _.find(poly, function (shape) {\n        const pbShape = toPolyBoolPoly([shape]),\n          shapeIntersection = PolyBool.intersect(pbIntersection, pbShape);\n        return (polygonsAreEqual(intersection, shapeIntersection.regions));\n      });\n    return containingShape && containingShape.length && containingShape;\n  },\n  polygonIntersectionPoints = function (poly1, poly2) {\n    'use strict';\n    const pbPoly1 = toPolyBoolPoly(poly1),\n      pbPoly2 = toPolyBoolPoly(poly2),\n      intersection = PolyBool.intersect(pbPoly1, pbPoly2),\n      isSameAsPoly1 = polygonsAreEqual(poly1, intersection.regions),\n      isContained = isSameAsPoly1 && !polygonsAreEqual(intersection.regions, poly2),\n      containingShape = isContained && shapeContainingIntersection(poly2, intersection.regions);\n\n    if (containingShape) {\n      return containingShape;\n    }\n    return _.flatten(intersection.regions, true);\n  },\n  projectPointOnLineVector = function (point, vectorOrigin, vector) {\n    'use strict';\n    const pointVector = [point[0] - vectorOrigin[0], point[1] - vectorOrigin[1]],\n      valDp = dotProduct(vector, pointVector),\n      len2 = dotProduct(vector, vector),\n      resultVector = [\n        vectorOrigin[0] + ((valDp * vector[0]) / len2),\n        vectorOrigin[1] + ((valDp * vector[1]) / len2)\n      ];\n    if (!vector[0] && !vector[1]) {\n      throw new Error('invalid-args');\n    }\n    return resultVector;\n  },\n\n  orderPointsOnVector = function (points, vectorOrigin, vector, pointsBeforeOriginOnly) {\n    'use strict';\n    const pointScale = function (point) {\n        const dx = point[0] - vectorOrigin[0],\n          dy = point[1] - vectorOrigin[1],\n          val = (function () {\n            if (dx === 0) {\n              if (vector[1] === 0) {\n                return 1;\n              }\n              return dy / vector[1];\n            } else {\n              if (vector[0] === 0) {\n                return 1;\n              }\n              return dx / vector[0];\n            }\n          }()),\n          pointSign = val >= 0 ? 1 : -1,\n          vectorScale = pointSign * (Math.pow(dx, 2) + Math.pow(dy, 2));\n        return vectorScale;\n      },\n      filteredPoints = _.filter(points, function (point) {\n        if (pointsBeforeOriginOnly) {\n          return pointScale(point) < 0;\n        }\n        return pointScale(point) >= 0;\n      });\n\n\n    return _.sortBy(filteredPoints, pointScale);\n  },\n  buildPoints = function (layout, margin) {\n    'use strict';\n    const points = [];\n    _.each(layout, function (node) {\n      const x1 = Math.round(node.x - margin),\n        x2 = Math.round(node.x + node.width + margin),\n        y1 = Math.round(node.y - margin),\n        y2 = Math.round(node.y + node.height + margin);\n\n      points.push([x1, y1]);\n      points.push([x1, y2]);\n      points.push([x2, y2]);\n      points.push([x2, y1]);\n    });\n    return points;\n  },\n  tolayoutPolygonHull = function (layout, margin) {\n    'use strict';\n    const points = buildPoints(layout, margin),\n      hullIndices = convexHull(points),\n      hull = _.map(hullIndices, function (hullIndex) {\n        return points[hullIndex];\n      });\n    return [hull];\n  },\n  roundVector = function (vector) {\n    'use strict';\n    return [Math.round(vector[0]), Math.round(vector[1])];\n  },\n  tolayoutPolygonRect = function (layout, margin) {\n    'use strict';\n    let minX = 0,\n      maxX = 0,\n      minY = 0,\n      maxY = 0;\n    _.each(layout, function (node) {\n      minX = Math.min(minX, node.x);\n      maxX = Math.max(maxX, node.x + node.width);\n      minY = Math.min(minY, node.y);\n      maxY = Math.max(maxY, node.y + node.width);\n    });\n    minX = minX - margin;\n    maxX = maxX + margin;\n    minY = minY - margin;\n    maxY = maxY + margin;\n    return [\n      [\n        roundVector([minX, minY]), roundVector([maxX, minY]), roundVector([maxX, maxY]), roundVector([minX, maxY])\n      ]\n    ];\n  },\n  addVectors = function (vector1, vector2) {\n    'use strict';\n    const x = vector1[0] + vector2[0],\n      y = vector1[1] + vector2[1];\n    if (isNaN(x) || isNaN(y)) {\n      //Logger.debug('addVectors invalid-args x', x, 'y', y, 'vector1', vector1, 'vector2', vector2);\n      throw new Error('invalid-args');\n    }\n    return [x, y];\n  },\n  subtractVectors = function (vector1, vector2) {\n    'use strict';\n    const x = vector1[0] - vector2[0],\n      y = vector1[1] - vector2[1];\n    if (isNaN(x) || isNaN(y)) {\n      //Logger.debug('subtractVectors invalid-args vector1', vector1, 'vector2', vector2);\n      throw new Error('invalid-args');\n    }\n    return [x, y];\n  },\n  translatePoly = function (poly, translation) {\n    'use strict';\n    return poly.map(function (region) {\n      return region.map(function (vector) {\n        return roundVector(addVectors(vector, translation));\n      });\n    });\n  },\n  firstProjectedPolyPointOnVector = function (poly, vectorOrigin, vector) {\n    'use strict';\n    const polyPoints = _.flatten(poly, true),\n      intersectionsOnLine = polyPoints.map(function (intersection) {\n        return projectPointOnLineVector(intersection, vectorOrigin, vector);\n      }),\n      orderedIntersectionsOnLine = orderPointsOnVector(intersectionsOnLine, vectorOrigin, vector, true);\n    return orderedIntersectionsOnLine.length && orderedIntersectionsOnLine[0];\n  },\n  furthestIntersectionPoint = function (poly1, poly2, vectorOrigin, vector) {\n    'use strict';\n    const intersections = polygonIntersectionPoints(poly1, poly2),\n      intersectionsOnLine = intersections.map(function (intersection) {\n        return projectPointOnLineVector(intersection, vectorOrigin, vector);\n      }),\n      orderedIntersectionsOnLine = orderPointsOnVector(intersectionsOnLine, vectorOrigin, vector);\n    return orderedIntersectionsOnLine.length && orderedIntersectionsOnLine.pop();\n  },\n  translatePolyToIntersecton = function (polyToTranslate, intersectionPoint, vector) {\n    'use strict';\n    const firstPolyPoint = firstProjectedPolyPointOnVector(polyToTranslate, intersectionPoint, vector),\n      translation = firstPolyPoint && roundVector(subtractVectors(intersectionPoint, firstPolyPoint));\n\n    if (!firstPolyPoint) {\n      return false;\n    }\n    return {\n      translation: translation,\n      translatedPoly: translatePoly(polyToTranslate, translation)\n    };\n  },\n  translatePolyToNotOverlap = function (polyToFit, existingRegions, polyRootCenter, vector, previousTranslation, depth) {\n    'use strict';\n\n    const firstPolyPoint = firstProjectedPolyPointOnVector(polyToFit, polyRootCenter, vector) || polyRootCenter,\n      intersectionPoint = furthestIntersectionPoint(polyToFit, existingRegions, firstPolyPoint, vector);\n    let polyTranslation;\n    depth = depth || 0;\n    previousTranslation = previousTranslation || [0, 0];\n    if (intersectionPoint) {\n      polyTranslation = translatePolyToIntersecton(polyToFit, intersectionPoint, vector);\n      if (polyTranslation) {\n        previousTranslation = addVectors(previousTranslation, polyTranslation.translation);\n        polyRootCenter = addVectors(polyRootCenter, polyTranslation.translation);\n        if (depth < 100) {\n          return translatePolyToNotOverlap(polyTranslation.translatedPoly, existingRegions, polyRootCenter, vector, previousTranslation, (depth + 1));\n        }\n      }\n    }\n    return {\n      translation: previousTranslation,\n      translatedPoly: polyToFit\n    };\n  },\n  extension = function (vector) {\n    'use strict';\n    return Math.pow(vector[0], 2) + Math.pow(vector[1], 2);\n  };\n\nmodule.exports = {\n  tolayoutPolygonRect: tolayoutPolygonRect,\n  tolayoutPolygonHull: tolayoutPolygonHull,\n  furthestIntersectionPoint: furthestIntersectionPoint,\n  projectPointOnLineVector: projectPointOnLineVector,\n  orderPointsOnVector: orderPointsOnVector,\n  firstProjectedPolyPointOnVector: firstProjectedPolyPointOnVector,\n  translatePoly: translatePoly,\n  addVectors: addVectors,\n  subtractVectors: subtractVectors,\n  translatePolyToIntersecton: translatePolyToIntersecton,\n  translatePolyToNotOverlap: translatePolyToNotOverlap,\n  unitVector: unitVector,\n  roundVector: roundVector,\n  polygonIntersectionPoints: polygonIntersectionPoints,\n  shapeContainingIntersection: shapeContainingIntersection,\n  extension: extension\n};\n","/*global module, require*/\nconst _ = require('underscore'),\n  nodeToBox = require('./node-to-box');\n\nmodule.exports = function LayoutModel(emptyLayout) {\n  'use strict';\n  let layout;\n  const self = this,\n    options = {\n      coneRatio: 0.5,\n      majorAxisRatio: 3\n    },\n    getNodesForPredicate = function (predicate) {\n      const nodes = layout && _.values(layout.nodes),\n        filtered = nodes && _.filter(nodes, predicate);\n      return nodes && filtered.length && filtered;\n    },\n    getNodesDown = function (referenceNode, coneRatio) {\n      const predicate = function (node) {\n        const dy = (node.y + node.height) - (referenceNode.y + referenceNode.height),\n          x1 = referenceNode.x - Math.abs(dy * coneRatio),\n          x2 = referenceNode.x + referenceNode.width + Math.abs(dy * coneRatio);\n\n        if (node.id === referenceNode.id || node.y <= Math.round(referenceNode.y + referenceNode.height * 0.5)) {\n          return false;\n        }\n        if (coneRatio !== undefined && (node.x > x2 || (node.x + node.width) < x1)) {\n          return false;\n        }\n        return true;\n      };\n      return getNodesForPredicate(predicate);\n    },\n    getNodesRight = function (referenceNode, coneRatio) {\n      const predicate = function (node) {\n        const dx = (node.x + node.width) - (referenceNode.x + referenceNode.width),\n          y1 = referenceNode.y - Math.abs(dx * coneRatio),\n          y2 = referenceNode.y + referenceNode.height + Math.abs(dx * coneRatio);\n\n        if (node.id === referenceNode.id || node.x <= Math.round(referenceNode.x + referenceNode.width * 0.5)) {\n          return false;\n        }\n        if (coneRatio !== undefined && (node.y > y2 || (node.y + node.height) < y1)) {\n          return false;\n        }\n        return true;\n      };\n      return getNodesForPredicate(predicate);\n    },\n    getNodesUp = function (referenceNode, coneRatio) {\n      const predicate = function (node) {\n        const dy = node.y - referenceNode.y,\n          x1 = referenceNode.x - Math.abs(dy * coneRatio),\n          x2 = referenceNode.x + referenceNode.width + Math.abs(dy * coneRatio);\n\n        if (node.id === referenceNode.id || (node.y + node.height) >= Math.round(referenceNode.y + referenceNode.height * 0.5)) {\n          return false;\n        }\n        if (coneRatio !== undefined && (node.x > x2 || (node.x + node.width) < x1)) {\n          return false;\n        }\n        return true;\n      };\n      return getNodesForPredicate(predicate);\n    },\n    getNodesLeft = function (referenceNode, coneRatio) {\n      const predicate = function (node) {\n        const dx = node.x - referenceNode.x,\n          y1 = referenceNode.y - Math.abs(dx * coneRatio),\n          y2 = referenceNode.y + referenceNode.height + Math.abs(dx * coneRatio);\n\n        if (node.id === referenceNode.id || (node.x + node.width) >= Math.round(referenceNode.x + referenceNode.width * 0.5)) {\n          return false;\n        }\n        if (coneRatio !== undefined && (node.y > y2 || (node.y + node.height) < y1)) {\n          return false;\n        }\n        return true;\n      };\n      return getNodesForPredicate(predicate);\n    },\n    getNearest = function (referenceNode, nodes, xRatio, yRatio) {\n      const referenceNodeCenter = {\n          x: Math.round(referenceNode.x + referenceNode.width * 0.5),\n          y: Math.round(referenceNode.y + referenceNode.height * 0.5)\n        },\n        calculateDistance = function (point1, point2) {\n          const dx = xRatio * (point1.x - point2.x),\n            dy = yRatio * (point1.y - point2.y);\n          return Math.pow(dx, 2) + Math.pow(dy, 2);\n        };\n      if (!nodes) {\n        return false;\n      }\n      if (nodes.length === 1) {\n        return nodes[0];\n      }\n      return _.min(nodes, function (node) {\n        const d = [\n          calculateDistance(node, referenceNodeCenter),\n          calculateDistance({ x: node.x + node.width, y: node.y + node.height }, referenceNodeCenter),\n          calculateDistance({ x: node.x + node.width, y: node.y }, referenceNodeCenter),\n          calculateDistance({ x: node.x, y: node.y + node.height }, referenceNodeCenter),\n          calculateDistance({ x: Math.round(node.x + node.width * 0.5), y: Math.round(node.y + node.height * 0.5) }, referenceNodeCenter)\n        ];\n        return _.min(d);\n      });\n    },\n    getPreferred = (referenceNode, nodes, xRatio, yRatio) => {\n      // Logger.debug('getPreferred', 'layout', layout, 'referenceNode', referenceNode, 'nodes', nodes); //eslint-disable-line\n      if (self.getOrientation() === 'standard') {\n        const siblings = nodes.filter((node) => referenceNode.parentId && referenceNode.parentId === node.parentId);\n        if (siblings.length) {\n          return _.min(siblings, (node) => Math.abs(node.y - referenceNode.y));\n        }\n      }\n      return getNearest(referenceNode, nodes, xRatio, yRatio);\n    };\n\n  self.getNode = function (nodeId) {\n    return (layout && layout.nodes && layout.nodes[nodeId]);\n  };\n  self.isRootNode = function (nodeId) {\n    return (layout && layout.nodes && layout.nodes[nodeId] && layout.nodes[nodeId].level === 1);\n  };\n  self.getNodeBox = function (nodeId) {\n    return nodeToBox(self.getNode(nodeId));\n  };\n  self.setLayout = function (newLayout) {\n    layout = newLayout || emptyLayout;\n  };\n  self.getLayout = function () {\n    return layout || emptyLayout;\n  };\n  self.nodeIdLeft = function (nodeId) {\n    const referenceNode = self.getNode(nodeId),\n      nodes = referenceNode && (getNodesLeft(referenceNode, options.coneRatio) || getNodesLeft(referenceNode)),\n      node = nodes && getNearest(referenceNode, nodes, 1, options.majorAxisRatio);\n    return node && node.id;\n  };\n  self.nodeIdRight = function (nodeId) {\n    const referenceNode = self.getNode(nodeId),\n      nodes = referenceNode && (getNodesRight(referenceNode, options.coneRatio) || getNodesRight(referenceNode)),\n      node = nodes && getNearest(referenceNode, nodes, 1, options.majorAxisRatio);\n    return node && node.id;\n  };\n\n  self.nodeIdUp = function (nodeId) {\n    const referenceNode = self.getNode(nodeId),\n      nodes = referenceNode && (getNodesUp(referenceNode, options.coneRatio) || getNodesUp(referenceNode)),\n      node = nodes && getPreferred(referenceNode, nodes, options.majorAxisRatio, 1);\n    return node && node.id;\n  };\n  self.nodeIdDown = function (nodeId) {\n    const referenceNode = self.getNode(nodeId),\n      nodes = referenceNode && (getNodesDown(referenceNode, options.coneRatio) || getNodesDown(referenceNode)),\n      node = nodes && getPreferred(referenceNode, nodes, options.majorAxisRatio, 1);\n    return node && node.id;\n  };\n  self.getOrientation = function () {\n    return (layout && layout.orientation) || 'standard';\n  };\n  self.layoutBounds = function () {\n    let minx, miny, maxx, maxy;\n    if (_.isEmpty(layout.nodes)) {\n      return false;\n    }\n    _.each(layout.nodes, function (node) {\n      if (!minx) {\n        minx = node.x;\n        miny = node.y;\n        maxx = node.x + node.width;\n        maxy = node.y + node.height;\n      } else {\n        minx = Math.min(node.x, minx);\n        miny = Math.min(node.y, miny);\n        maxx = Math.max(node.x + node.width, maxx);\n        maxy = Math.max(node.y + node.height, maxy);\n      }\n    });\n    return { minX: minx, minY: miny, maxX: maxx, maxY: maxy, width: (maxx - minx), height: (maxy - miny) };\n  };\n\n  self.clipRectTransform = function (centerNodeId, options) {\n    let scale = (options && options.scale) || 1;\n    const centerNode = self.getNode(centerNodeId),\n      bounds = self.layoutBounds(),\n      padding = (options && options.padding) || 0,\n      imgCenter = {\n        x: centerNode.x + (centerNode.width / 2),\n        y: centerNode.y + (centerNode.height / 2)\n      };\n    if (options && options.clipRect) {\n      return {\n        x: (options.clipRect.width / 2) - imgCenter.x,\n        y: (options.clipRect.height / 2) - imgCenter.y,\n        width: options.clipRect.width,\n        height: options.clipRect.height,\n        scale: scale\n      };\n    } else if (options && options.page) {\n      scale = Math.min((options.page.width - 2 * padding) / bounds.width, (options.page.height - 2 * padding) / bounds.height);\n      return {\n        x: -1 * bounds.minX + Math.floor(0.5 * (options.page.width / scale - bounds.width)), // in scaled coordinates\n        y: -1 * bounds.minY + Math.floor(0.5 * (options.page.height / scale - bounds.height)), // in scaled coordinates\n        width: options.page.width,\n        height: options.page.height,\n        scale: scale\n      };\n    } else {\n      return {\n        x: -1 * bounds.minX + Math.floor(padding / scale), // in scaled coordinates\n        y: -1 * bounds.minY + Math.floor(padding / scale), // in scaled coordinates\n        width: bounds.width * scale + 2 * padding,\n        height: bounds.height * scale + 2 * padding,\n        scale: scale\n      };\n    }\n  };\n\n};\n","/*global module, require*/\nconst _ = require('underscore'),\n  layoutGeometry = require('./layout-geometry');\n\nmodule.exports = function MultiRootLayout() {\n  'use strict';\n  const self = this,\n    mergeNodes = function (storedLayout, offset) {\n      _.each(storedLayout.rootLayout, function (node) {\n        node.x = node.x + offset.x;\n        node.y = node.y + offset.y;\n        node.rootId = storedLayout.rootIdea.id;\n      });\n    },\n    globalIdeaTopLeftPosition = function (idea) {\n      const positionArray = (idea && idea.attr && idea.attr.position) || [0, 0, 0];\n      return {\n        x: positionArray[0],\n        y: positionArray[1],\n        priority: positionArray[2]\n      };\n    },\n    toStoredLayout = function (rootLayout, rootIdea) {\n      const storedLayout = {\n        rootIdea: rootIdea,\n        rootNode: rootLayout[rootIdea.id],\n        rootLayout: rootLayout\n      };\n      return storedLayout;\n    },\n    isPositioned = function (rootIdea) {\n      return globalIdeaTopLeftPosition(rootIdea).priority;\n    },\n    getDesiredRootNodeOffset = function (storedLayout) {\n      let rootPosition = globalIdeaTopLeftPosition(storedLayout.rootIdea);\n      if (!storedLayout.rootNode) {\n        return { x: 0, y: 0 };\n      }\n      if (!rootPosition || !rootPosition.priority) {\n        rootPosition = { x: Math.round(storedLayout.rootNode.width / -2), y: Math.round(storedLayout.rootNode.height / -2) };\n      }\n      return {\n        x: (rootPosition.x - storedLayout.rootNode.x),\n        y: (rootPosition.y - storedLayout.rootNode.y)\n      };\n    },\n    positionedLayouts = [],\n    unpositionedLayouts = [],\n    getMostRecentlyPositionedLayout = function () {\n      return positionedLayouts.length && _.max(positionedLayouts, function (layout) {\n        return globalIdeaTopLeftPosition(layout.rootIdea).priority;\n      });\n    };\n\n  self.appendRootNodeLayout = function (rootLayout, rootIdea) {\n    const storedLayout = toStoredLayout(rootLayout, rootIdea);\n    if (isPositioned(rootIdea)) {\n      positionedLayouts.push(storedLayout);\n    } else {\n      unpositionedLayouts.push(storedLayout);\n    }\n  };\n  self.getCombinedLayout = function (margin, optional) {\n    let placedLayoutPoly = [],\n      result = {};\n\n    const origin = { x: 0, y: 0 },\n      contextNode = optional && optional.contextNode,\n      contextLayout = contextNode && positionedLayouts.find(layout => layout.rootLayout[contextNode]),\n      firstToPlace = contextLayout || getMostRecentlyPositionedLayout(),\n      rootDistance = function (storedLayout) {\n        const rootCenter = getDesiredRootNodeOffset(storedLayout),\n          nodeDistance = function (node) {\n            return Math.pow(rootCenter.x + node.x + node.width / 2 - origin.x, 2) + Math.pow(rootCenter.y + node.y + node.height / 2 - origin.y, 2);\n          },\n          nodeDistances = Object.keys(storedLayout.rootLayout).map(key => nodeDistance(storedLayout.rootLayout[key]));\n        return Math.min.apply({}, nodeDistances);\n      },\n      placedLayouts = [],\n      layoutCount = positionedLayouts.length + unpositionedLayouts.length,\n      hasMultipleLayouts = layoutCount > 1,\n      positionLayout = function (storedLayout) {\n        let offset, storedLayoutPoly;\n\n        const placedRootOffset = getDesiredRootNodeOffset(storedLayout),\n          initialTranslation = layoutGeometry.roundVector([placedRootOffset.x, placedRootOffset.y]),\n          placeNewLayout = function () {\n            const vector = layoutGeometry.unitVector([placedRootOffset.x - origin.x, placedRootOffset.y - origin.y]),\n              horizontalMovement = [Math.sign(vector[0]) || 1, 0],\n              verticalMovement = [0, Math.sign(vector[1]) || 1],\n              horizontalTranslationResult = layoutGeometry.translatePolyToNotOverlap(storedLayoutPoly, placedLayoutPoly, initialTranslation, horizontalMovement, initialTranslation),\n              horizontalExtension = layoutGeometry.extension(layoutGeometry.subtractVectors(horizontalTranslationResult.translation, initialTranslation)),\n              verticalTranslationResult = horizontalExtension && layoutGeometry.translatePolyToNotOverlap(storedLayoutPoly, placedLayoutPoly, initialTranslation, verticalMovement, initialTranslation),\n              verticalExtension = verticalTranslationResult && layoutGeometry.extension(layoutGeometry.subtractVectors(verticalTranslationResult.translation, initialTranslation));\n            if (!verticalExtension || (horizontalExtension < verticalExtension)) {\n              offset = { x: horizontalTranslationResult.translation[0], y: horizontalTranslationResult.translation[1] };\n              storedLayoutPoly = horizontalTranslationResult.translatedPoly;\n            } else {\n              offset = { x: verticalTranslationResult.translation[0], y: verticalTranslationResult.translation[1] };\n              storedLayoutPoly = verticalTranslationResult.translatedPoly;\n            }\n          };\n\n        storedLayoutPoly = hasMultipleLayouts && layoutGeometry.translatePoly(layoutGeometry.tolayoutPolygonHull(storedLayout.rootLayout, margin), initialTranslation);\n\n        if (!storedLayout || _.contains(placedLayouts, storedLayout)) {\n          return;\n        }\n\n        if (placedLayouts.length) {\n          placeNewLayout();\n        } else {\n          offset = placedRootOffset;\n        }\n\n        mergeNodes(storedLayout, offset);\n        placedLayouts.push(storedLayout);\n        if (hasMultipleLayouts) {\n          placedLayoutPoly = placedLayoutPoly.concat(storedLayoutPoly);\n        }\n\n      };\n    if (!margin) {\n      throw new Error('invalid-args');\n    }\n    if (firstToPlace) {\n      positionLayout(firstToPlace);\n      if (contextLayout) {\n        origin.x = contextLayout.rootLayout[contextNode].x;\n        origin.y = contextLayout.rootLayout[contextNode].y;\n      }\n    }\n    positionedLayouts.forEach(layout => layout.distance = rootDistance(layout));\n    positionedLayouts.sort((layout1, layout2) => layout1.distance - layout2.distance).forEach(positionLayout);\n    unpositionedLayouts.forEach(positionLayout);\n    placedLayouts.forEach(function (placedLayout) {\n      result = _.extend(result, placedLayout.rootLayout);\n    });\n    return result;\n  };\n};\n","/*global module, require*/\nconst objectUtils = require('../util/object-utils'),\n  _ = require('underscore'),\n  INHERIT_MARKER = 'theme_inherit',\n  inheritAttributeKeysFromParentNode = (parentNode, node, keysToInherit) => {\n    'use strict';\n    let remainingToInherit = [];\n    if (parentNode.attr) {\n      keysToInherit.forEach((keyToInherit) => {\n        const parentValue = objectUtils.getValue(parentNode.attr, keyToInherit);\n        if (parentValue && parentValue !== INHERIT_MARKER) {\n\n          objectUtils.setValue(node.attr, keyToInherit, parentValue);\n        } else {\n          remainingToInherit.push(keyToInherit);\n        }\n      });\n    } else {\n      remainingToInherit = keysToInherit;\n    }\n    return remainingToInherit;\n  },\n  inheritAttributeKeys = (nodesMap, node, keysToInherit) => {\n    'use strict';\n    if (!node || !node.parentId) {\n      return;\n    }\n    const parentNode = nodesMap[node.parentId],\n      remainingToInherit = (parentNode && inheritAttributeKeysFromParentNode(parentNode, node, keysToInherit)) || [];\n    if (!remainingToInherit.length || !parentNode || !parentNode.parentId) {\n      return;\n    }\n    inheritAttributeKeys(nodesMap, parentNode, remainingToInherit);\n    inheritAttributeKeysFromParentNode(parentNode, node, remainingToInherit);\n  },\n  inheritAttributes = (nodesMap, node) => {\n    'use strict';\n    if (!node || !node.parentId || !node.attr) {\n      return;\n    }\n    const keysToInherit = objectUtils.keyComponentsWithValue(node.attr, INHERIT_MARKER);\n    if (!keysToInherit || !keysToInherit.length) {\n      return;\n    }\n    inheritAttributeKeys(nodesMap, node, keysToInherit);\n  },\n  setThemeAttributes = function (nodes, theme) {\n    'use strict';\n    if (!nodes || !theme) {\n      throw 'invalid-args';\n    }\n    Object.keys(nodes).forEach(function (nodeKey) {\n      const node = nodes[nodeKey];\n      node.styles = theme.nodeStyles(node.level, node.attr);\n      node.attr = _.extend({}, theme.getLayoutConnectorAttributes(node.styles), node.attr);\n    });\n    Object.keys(nodes).forEach(function (nodeKey) {\n      const node = nodes[nodeKey];\n      inheritAttributes(nodes, node);\n    });\n  };\n\nmodule.exports = {\n  INHERIT_MARKER: INHERIT_MARKER,\n  inheritAttributes: inheritAttributes,\n  inheritAttributeKeys: inheritAttributeKeys,\n  inheritAttributeKeysFromParentNode: inheritAttributeKeysFromParentNode,\n  setThemeAttributes: setThemeAttributes\n};\n","/*global module*/\nmodule.exports = function nodeToBox(node) {\n  'use strict';\n  if (!node) {\n    return false;\n  }\n  return {\n    left: node.x,\n    top: node.y,\n    width: node.width,\n    height: node.height,\n    level: node.level,\n    styles: node.styles || ['default']\n  };\n};\n","/*global module, require */\nconst _ = require('underscore'),\n  treeUtils = require('./tree');\nmodule.exports  = function calculateStandardLayout(idea, dimensionProvider, margin) {\n  'use strict';\n  const positive = function (rank, parentId) {\n      return parentId !== idea.id || rank > 0;\n    },\n    negative = function (rank, parentId) {\n      return parentId !== idea.id || rank < 0;\n    },\n    positiveTree = treeUtils.calculateTree(idea, dimensionProvider, margin, positive),\n    negativeTree = treeUtils.calculateTree(idea, dimensionProvider, margin, negative),\n    layout = positiveTree.toLayout(),\n    negativeLayout = negativeTree.toLayout();\n  _.each(negativeLayout.nodes, function (n) {\n    n.x = -1 * n.x - n.width;\n  });\n  return _.extend(negativeLayout.nodes, layout.nodes);\n};\n\n","/*global require, module*/\nconst _ = require('underscore'),\n  borderLength = function (border) {\n    'use strict';\n    return _.reduce(border, function (seed, el) {\n      return seed + el.l;\n    }, 0);\n  },\n  borderSegmentIndexAt = function (border, length) {\n    'use strict';\n    let l = 0, i = -1;\n    while (l <= length) {\n      i += 1;\n      if (i >= border.length) {\n        return -1;\n      }\n      l += border[i].l;\n    }\n    return i;\n  },\n  extendBorder = function (originalBorder, extension) {\n    'use strict';\n    let lengthToCut,\n      result = originalBorder.slice();\n    const origLength = borderLength(originalBorder),\n      i = borderSegmentIndexAt(extension, origLength);\n    if (i >= 0) {\n      lengthToCut = borderLength(extension.slice(0, i + 1));\n      result.push({ h: extension[i].h, l: lengthToCut - origLength });\n      result = result.concat(extension.slice(i + 1));\n    }\n    return result;\n  },\n  Outline = function (topBorder, bottomBorder) {\n    'use strict';\n    const shiftBorder = function (border, deltaH) {\n      return _.map(border, function (segment) {\n        return {\n          l: segment.l,\n          h: segment.h + deltaH\n        };\n      });\n    };\n    this.initialHeight = function () {\n      return this.bottom[0].h - this.top[0].h;\n    };\n    this.borders = function () {\n      return _.pick(this, 'top', 'bottom');\n    };\n    this.spacingAbove = function (outline) {\n      let i = 0, j = 0, result = 0, li = 0, lj = 0;\n      while (i < this.bottom.length && j < outline.top.length) {\n        result = Math.max(result, this.bottom[i].h - outline.top[j].h);\n        if (li + this.bottom[i].l < lj + outline.top[j].l) {\n          li += this.bottom[i].l;\n          i += 1;\n        } else if (li + this.bottom[i].l === lj + outline.top[j].l) {\n          li += this.bottom[i].l;\n          i += 1;\n          lj += outline.top[j].l;\n          j += 1;\n        } else {\n          lj += outline.top[j].l;\n          j += 1;\n        }\n      }\n      return result;\n    };\n    this.indent = function (horizontalIndent, margin) {\n      const top = this.top.slice(),\n        bottom = this.bottom.slice(),\n        vertCenter = Math.round((bottom[0].h + top[0].h) / 2);\n\n      if (!horizontalIndent) {\n        return this;\n      };\n\n      top.unshift({ h: Math.round(vertCenter - margin / 2), l: horizontalIndent });\n      bottom.unshift({ h: Math.round(vertCenter + margin / 2), l: horizontalIndent });\n      return new Outline(top, bottom);\n    };\n    this.stackBelow = function (outline, margin) {\n      const spacing = outline.spacingAbove(this),\n        top = extendBorder(outline.top, shiftBorder(this.top, spacing + margin)),\n        bottom = extendBorder(shiftBorder(this.bottom, spacing + margin), outline.bottom);\n      return new Outline(\n        top,\n        bottom\n      );\n    };\n    this.expand = function (initialTopHeight, initialBottomHeight) {\n      const topAlignment = initialTopHeight - this.top[0].h,\n        bottomAlignment = initialBottomHeight - this.bottom[0].h,\n        top = shiftBorder(this.top, topAlignment),\n        bottom = shiftBorder(this.bottom, bottomAlignment);\n      return new Outline(\n        top,\n        bottom\n      );\n    };\n    this.insertAtStart = function (dimensions, margin) {\n      const alignment = 0, //-1 * this.top[0].h - suboutlineHeight * 0.5,\n        topBorder = shiftBorder(this.top, alignment),\n        bottomBorder = shiftBorder(this.bottom, alignment),\n        easeIn = function (border) {\n          border[0].l *= 0.5;\n          border[1].l += border[0].l;\n        };\n      topBorder[0].l += margin;\n      bottomBorder[0].l += margin;\n      topBorder.unshift({ h: Math.round(-0.5 * dimensions.height), l: dimensions.width });\n      bottomBorder.unshift({ h: Math.round(0.5 * dimensions.height), l: dimensions.width });\n      if (topBorder[0].h > topBorder[1].h) {\n        easeIn(topBorder);\n      }\n      if (bottomBorder[0].h < bottomBorder[1].h) {\n        easeIn(bottomBorder);\n      }\n      return new Outline(topBorder, bottomBorder);\n    };\n    this.top = topBorder.slice();\n    this.bottom = bottomBorder.slice();\n  },\n  outlineFromDimensions = function (dimensions) {\n    'use strict';\n    return new Outline([{\n      h: Math.round(-0.5 * dimensions.height),\n      l: dimensions.width\n    }], [{\n      h: Math.round(0.5 * dimensions.height),\n      l: dimensions.width\n    }]);\n  };\n\n\nmodule.exports = {\n  borderLength: borderLength,\n  borderSegmentIndexAt: borderSegmentIndexAt,\n  extendBorder: extendBorder,\n  Outline: Outline,\n  outlineFromDimensions: outlineFromDimensions\n};\n","/*global module, require*/\nconst _ = require('underscore'),\n  isEmptyGroup = require('../../content/is-empty-group'),\n  outlineUtils = require('./outline'),\n  Tree = function (options) {\n    'use strict';\n    _.extend(this, options);\n    this.toLayout = function (x, y, parentId) {\n      const result = {\n          nodes: {},\n          connectors: {}\n        },\n        self = _.pick(this, 'id', 'title', 'attr', 'width', 'textWidth', 'height', 'level');\n\n      if (parentId) {\n        self.parentId = parentId;\n      }\n\n      x = x || 0;\n      y = y || 0;\n\n\n      if (self.level === 1) {\n        self.x = Math.round(-0.5 * this.width);\n        self.y = Math.round(-0.5 * this.height);\n      } else {\n        self.x = x + this.deltaX || 0;\n        self.y = y + this.deltaY || 0;\n      }\n      result.nodes[this.id] = self;\n      if (parentId !== undefined) {\n        result.connectors[self.id] = {\n          from: parentId,\n          to: self.id\n        };\n      }\n      if (this.subtrees) {\n        this.subtrees.forEach(function (t) {\n          const subLayout = t.toLayout(self.x, self.y, self.id);\n          _.extend(result.nodes, subLayout.nodes);\n          _.extend(result.connectors, subLayout.connectors);\n        });\n      }\n      return result;\n    };\n  },\n  calculateTree = function (content, dimensionProvider, margin, rankAndParentPredicate, level) {\n    'use strict';\n    const options = {\n        id: content.id,\n        title: content.title,\n        attr: content.attr,\n        deltaY: 0,\n        deltaX: 0,\n        level: level || 1\n      },\n      buildReferenceTree = function (treeArray, dy, oldPositions) {\n        let referenceTree, tree;\n        const adjustSpacing = function (i) {\n          const oldSpacing = oldPositions[i].deltaY - oldPositions[i - 1].deltaY,\n            newSpacing = treeArray[i].deltaY - treeArray[i - 1].deltaY;\n          if (newSpacing < oldSpacing) {\n            tree.deltaY += oldSpacing - newSpacing;\n          }\n        };\n\n        for (let i = 0; i < treeArray.length; i += 1) {\n          tree = treeArray[i];\n          if (tree.attr && tree.attr.position) {\n            tree.deltaY = tree.attr.position[1];\n            if (referenceTree === undefined || tree.attr.position[2] > treeArray[referenceTree].attr.position[2]) {\n              referenceTree = i;\n            }\n          } else {\n            tree.deltaY += dy;\n          }\n          if (i > 0) {\n            adjustSpacing(i);\n          }\n        }\n        return referenceTree;\n      },\n      setVerticalSpacing = function (treeArray, dy) {\n        const oldPositions = _.map(treeArray, function (t) {\n            return _.pick(t, 'deltaX', 'deltaY');\n          }),\n          referenceTree = buildReferenceTree(treeArray, dy, oldPositions),\n          alignment = referenceTree && (treeArray[referenceTree].attr.position[1] - treeArray[referenceTree].deltaY);\n        if (alignment) {\n          for (let i = 0; i < treeArray.length; i += 1) {\n            treeArray[i].deltaY += alignment;\n          }\n        }\n      },\n      shouldIncludeSubIdeas = function () {\n        return !(_.isEmpty(content.ideas) || (content.attr && content.attr.collapsed));\n      },\n      includedSubIdeaKeys = function () {\n        const allRanks = _.map(_.keys(content.ideas), parseFloat),\n          candidateRanks = rankAndParentPredicate ? _.filter(allRanks, function (rank) {\n            return rankAndParentPredicate(rank, content.id);\n          }) : allRanks,\n          includedRanks = _.filter(candidateRanks, function (rank) {\n            return !isEmptyGroup(content.ideas[rank]);\n          });\n        return _.sortBy(includedRanks, Math.abs);\n      },\n      includedSubIdeas = function () {\n        const result = [];\n        _.each(includedSubIdeaKeys(), function (key) {\n          result.push(content.ideas[key]);\n        });\n        return result;\n      },\n      nodeDimensions = dimensionProvider(content, options.level),\n      appendSubtrees = function (subtrees) {\n        let suboutline, deltaHeight, subtreePosition, horizontal, treeOutline;\n        _.each(subtrees, function (subtree) {\n          subtree.deltaX = nodeDimensions.width + margin.h;\n          subtreePosition = subtree.attr && subtree.attr.position && subtree.attr.position[0];\n          if (subtreePosition && subtreePosition > subtree.deltaX) {\n            horizontal = subtreePosition - subtree.deltaX;\n            subtree.deltaX = subtreePosition;\n          } else {\n            horizontal = 0;\n          }\n          if (!suboutline) {\n            suboutline = subtree.outline.indent(horizontal, margin.h);\n          } else {\n            treeOutline = subtree.outline.indent(horizontal, margin.h);\n            deltaHeight = treeOutline.initialHeight();\n            suboutline = treeOutline.stackBelow(suboutline, margin.v);\n            subtree.deltaY = Math.round(suboutline.initialHeight() - deltaHeight / 2 - subtree.height / 2);\n          }\n        });\n        if (subtrees && subtrees.length) {\n          setVerticalSpacing(subtrees, Math.round(0.5 * (nodeDimensions.height - suboutline.initialHeight())));\n          suboutline = suboutline.expand(\n            Math.round(subtrees[0].deltaY - nodeDimensions.height * 0.5),\n            Math.round(subtrees[subtrees.length - 1].deltaY + subtrees[subtrees.length - 1].height - nodeDimensions.height * 0.5)\n          );\n        }\n        options.outline = suboutline.insertAtStart(nodeDimensions, margin.h);\n      };\n    _.extend(options, nodeDimensions);\n    options.outline = outlineUtils.outlineFromDimensions(nodeDimensions);\n    if (shouldIncludeSubIdeas()) {\n      options.subtrees = _.map(includedSubIdeas(), function (i) {\n        return calculateTree(i, dimensionProvider, margin, rankAndParentPredicate, options.level + 1);\n      });\n      if (!_.isEmpty(options.subtrees)) {\n        appendSubtrees(options.subtrees);\n      }\n    }\n    return new Tree(options);\n  };\n\nmodule.exports = {\n  Tree: Tree,\n  calculateTree: calculateTree\n};\n","/*global module, require */\nconst _ = require('underscore'),\n  compactedGroupWidth = require('./compacted-group-width'),\n  sortNodesByLeftPosition = require('./sort-nodes-by-left-position');\nmodule.exports = function alignGroup(result, rootIdea, margin) {\n  'use strict';\n  if (!margin) {\n    throw 'invalid-args';\n  }\n  const nodes = result.nodes,\n    rootNode = nodes[rootIdea.id],\n    childIds = _.values(rootIdea.ideas).map(function (idea) {\n      return idea.id;\n    }),\n    childNodes = childIds.map(function (id) {\n      return nodes[id];\n    }).filter(function (node) {\n      return node;\n    }),\n    sortedChildNodes = sortNodesByLeftPosition(childNodes),\n    getChildNodeBoundaries = function () {\n      const rightMost = sortedChildNodes[sortedChildNodes.length - 1];\n      return {\n        left: sortedChildNodes[0].x,\n        right: rightMost.x + rightMost.width\n      };\n    },\n    setGroupWidth = function () {\n      if (!childNodes.length) {\n        return;\n      }\n      const levelBoundaries = getChildNodeBoundaries();\n      rootNode.x = levelBoundaries.left;\n      rootNode.width = levelBoundaries.right - levelBoundaries.left;\n    },\n    compactChildNodes = function () {\n      if (!childNodes.length) {\n        return;\n      }\n      const levelBoundaries = getChildNodeBoundaries(),\n        levelCenter = levelBoundaries.left + (levelBoundaries.right - levelBoundaries.left) / 2,\n        requiredWidth = compactedGroupWidth(childNodes, margin);\n      let position = levelCenter - requiredWidth / 2;\n      sortedChildNodes.forEach(node => {\n        node.x = position;\n        position = position + node.width + margin;\n      });\n    },\n    sameLevelNodes = _.values(nodes).filter(function (node) {\n      return node.level === rootNode.level && node.id !== rootNode.id;\n    });\n\n  compactChildNodes();\n  setGroupWidth();\n\n  sameLevelNodes.forEach(function (node) {\n    node.verticalOffset = (node.verticalOffset || 0) + rootNode.height;\n  });\n};\n","/*global module, require*/\nconst _ = require('underscore'),\n  isEmptyGroup = require('../../content/is-empty-group'),\n  alignGroup = require('./align-group'),\n  combineVerticalSubtrees = require('./combine-vertical-subtrees');\nmodule.exports  = function calculateTopDownLayout(aggregate, dimensionProvider, margin) {\n  'use strict';\n  const isGroup = function (node) {\n      return node.attr && node.attr.group;\n    },\n    toNode = function (idea, level, parentId) {\n      const dimensions = dimensionProvider(idea, level),\n        node = _.extend({ level: level, verticalOffset: 0, title: isGroup(idea) ? '' : idea.title }, dimensions, _.pick(idea, ['id', 'attr']));\n      if (parentId) {\n        node.parentId = parentId;\n      }\n      return node;\n    },\n    //TODO: adds some complexity to the standard traverse function - includes parent id, omits post order, skips groups\n    traverse = function (idea, predicate, level, parentId) {\n      const childResults = {},\n        shouldIncludeSubIdeas = !(_.isEmpty(idea.ideas) || (idea.attr && idea.attr.collapsed));\n\n      level = level || 1;\n      if (shouldIncludeSubIdeas) {\n        Object.keys(idea.ideas).forEach(function (subNodeRank) {\n          const newLevel = isGroup(idea) ? level : level + 1,\n            result = traverse(idea.ideas[subNodeRank], predicate, newLevel, idea.id);\n          if (result) {\n            childResults[subNodeRank] = result;\n          }\n        });\n      }\n      return predicate(idea, childResults, level, parentId);\n    },\n    traversalLayout = function (idea, childLayouts, level, parentId) {\n      const node = toNode(idea, level, parentId);\n      let result;\n\n      if (isGroup(node) && !_.isEmpty(idea.ideas)) {\n        result = combineVerticalSubtrees(node, childLayouts, margin.h, true);\n        alignGroup(result, idea, margin.h);\n      } else {\n        result = combineVerticalSubtrees(node, childLayouts, margin.h);\n      }\n      return result;\n    },\n    traversalLayoutWithoutEmptyGroups = function (idea, childLayouts, level, parentId) {\n      return (idea === aggregate || !isEmptyGroup(idea)) && traversalLayout(idea, childLayouts, level, parentId);\n    },\n    setLevelHeights = function (nodes, levelHeights) {\n      _.each(nodes, function (node) {\n        node.y = levelHeights[node.level - 1] + node.verticalOffset;\n        delete node.verticalOffset;\n      });\n    },\n    getLevelHeights = function (nodes) {\n      const maxHeights = [],\n        heights = [];\n      let level,\n        totalHeight = 0;\n\n      _.each(nodes, function (node) {\n        maxHeights[node.level - 1] = Math.max(maxHeights[node.level - 1] || 0, node.height + node.verticalOffset);\n      });\n      totalHeight = maxHeights.reduce(function (memo, item) {\n        return memo + item;\n      }, 0) + (margin.v * (maxHeights.length - 1));\n\n      heights[0] = Math.round(-0.5 * totalHeight);\n\n      for (level = 1; level < maxHeights.length; level++) {\n        heights[level] = heights[level - 1] + margin.v + maxHeights[level - 1];\n      }\n      return heights;\n    },\n    tree = traverse(aggregate, traversalLayoutWithoutEmptyGroups);\n\n  setLevelHeights(tree.nodes, getLevelHeights(tree.nodes));\n\n  return tree.nodes;\n};\n\n","/*global module, require */\nconst _ = require('underscore'),\n  VerticalSubtreeCollection = require('./vertical-subtree-collection');\nmodule.exports = function combineVerticalSubtrees(node, childLayouts, margin, sameLevel) {\n  'use strict';\n  const result = {\n      nodes: {}\n    },\n    shift = function (nodes, xOffset) {\n      _.each(nodes, function (node) {\n        node.x += xOffset;\n      });\n      return nodes;\n    },\n    verticalSubtreeCollection = new VerticalSubtreeCollection(childLayouts, margin);\n  let treeOffset;\n\n  if (Array.isArray(childLayouts)) {\n    throw 'child layouts are an array!';\n  }\n\n  result.nodes[node.id] = node;\n  node.x = Math.round(-0.5 * node.width);\n  result.levels = [{ width: node.width, xOffset: node.x }];\n\n  if (!verticalSubtreeCollection.isEmpty()) {\n    if (sameLevel) {\n      result.levels = verticalSubtreeCollection.getMergedLevels();\n      treeOffset = result.levels[0].xOffset;\n    } else {\n      result.levels = result.levels.concat(verticalSubtreeCollection.getMergedLevels());\n      treeOffset = result.levels[1].xOffset;\n    }\n    Object.keys(childLayouts).forEach(function (subtreeRank) {\n      _.extend(result.nodes, shift(childLayouts[subtreeRank].nodes, treeOffset + verticalSubtreeCollection.getExpectedTranslation(subtreeRank)));\n    });\n  }\n  return result;\n};\n","/*global module */\nmodule.exports = function compactedGroupWidth(nodeGroup, margin) {\n  'use strict';\n  if (!nodeGroup || !nodeGroup.length) {\n    return 0;\n  }\n  const totalWidth = nodeGroup.reduce((total, current) => total + current.width, 0),\n    requiredMargins = (nodeGroup.length - 1) * margin;\n  return totalWidth + requiredMargins;\n};\n","/*global module */\nmodule.exports = function sortNodesByLeftPosition(nodes) {\n  'use strict';\n  if (!nodes || !nodes.length) {\n    return nodes;\n  }\n  return [].concat(nodes).sort((a, b) => a.x - b.x);\n};\n","/*global module, require */\nconst _ = require('underscore');\nmodule.exports = function VerticalSubtreeCollection(subtreeMap, marginArg) {\n  'use strict';\n  const self = this,\n    sortedRanks = function () {\n      if (!subtreeMap) {\n        return [];\n      }\n      return _.sortBy(Object.keys(subtreeMap), parseFloat);\n    },\n    margin = marginArg || 0,\n    calculateExpectedTranslations = function () {\n      const ranks = sortedRanks(),\n        translations = {},\n\n        sortByRank = function () {\n          /* todo: cache */\n          if (_.isEmpty(subtreeMap)) {\n            return [];\n          }\n          return sortedRanks().map(function (key) {\n            return subtreeMap[key];\n          });\n        };\n      let currentWidthByLevel;\n\n      sortByRank().forEach(function (childLayout, rankIndex) {\n        const currentRank = ranks[rankIndex];\n        if (currentWidthByLevel === undefined) {\n          translations[currentRank] = 0 - childLayout.levels[0].xOffset;\n          currentWidthByLevel = childLayout.levels.map(function (level) {\n            return level.width + translations[currentRank] + level.xOffset;\n          });\n        } else {\n          childLayout.levels.forEach(function (level, levelIndex) {\n            const currentLevelWidth = currentWidthByLevel[levelIndex];\n            if (currentLevelWidth !== undefined) {\n              if (translations[currentRank] === undefined) {\n                translations[currentRank] = currentLevelWidth + margin - level.xOffset;\n              } else {\n                translations[currentRank] = Math.max(translations[currentRank], currentLevelWidth + margin - level.xOffset);\n              }\n            }\n          });\n\n          childLayout.levels.forEach(function (level, levelIndex) {\n            currentWidthByLevel[levelIndex] = translations[currentRank] + level.xOffset + level.width;\n          });\n        }\n      });\n      return translations;\n    },\n    translationsByRank = calculateExpectedTranslations();\n\n  self.getLevelWidth = function (level) {\n    const candidateRanks = sortedRanks().filter(function (rank) {\n        return self.existsOnLevel(rank, level);\n      }),\n      referenceLeft = candidateRanks[0], /* won't work if the first child layout does not exist on the widest level */\n      referenceRight = candidateRanks[candidateRanks.length - 1],\n      leftLayout = subtreeMap[referenceLeft],\n      rightLayout = subtreeMap[referenceRight],\n      leftx = leftLayout.levels[level].xOffset + self.getExpectedTranslation(referenceLeft),\n      rightx = rightLayout.levels[level].xOffset + self.getExpectedTranslation(referenceRight);\n    return rightx + rightLayout.levels[level].width - leftx;\n  };\n  self.getLevelWidths = function () {\n    /* todo: cache */\n    const result = [],\n      maxLevel = _.max(_.map(subtreeMap, function (childLayout) {\n        return childLayout.levels.length;\n      }));\n    for (let levelIdx = 0; levelIdx < maxLevel; levelIdx++) {\n      result.push(self.getLevelWidth(levelIdx));\n    }\n    return result;\n  };\n  self.isEmpty = function () {\n    return _.isEmpty(subtreeMap);\n  };\n\n  self.getExpectedTranslation = function (rank) {\n    return translationsByRank[rank];\n  };\n  self.existsOnLevel = function (rank, level) {\n    return subtreeMap[rank].levels.length > level;\n  };\n  self.getMergedLevels = function () {\n    const targetCombinedLeftOffset = Math.round(self.getLevelWidth(0) * -0.5);\n    return self.getLevelWidths().map(function (levelWidth, index) {\n      const candidateRanks = sortedRanks().filter(function (rank) {\n          return self.existsOnLevel(rank, index);\n        }),\n        referenceLeft = candidateRanks[0], /* won't work if the first child layout does not exist on the widest level */\n        leftLayout = subtreeMap[referenceLeft];\n      return {\n        width: levelWidth,\n        xOffset: leftLayout.levels[index].xOffset + self.getExpectedTranslation(referenceLeft) + targetCombinedLeftOffset\n      };\n    });\n\n  };\n\n};\n","/*global require, module, PATH_FILE_CONFIG_MAPJS */\nconst _ = require('underscore'),\n  MemoryClipboard = require('./clipboard'),\n  LayoutModel = require('./layout/layout-model'),\n  observable = require('./util/observable'),\n  Utilities = require('./util/mapjs-utilities'),\n  { default: CONFIG } = require(PATH_FILE_CONFIG_MAPJS);\n\nmodule.exports = function MapModel(selectAllTitles, clipboardProvider, defaultReorderMargin, optional) {\n  'use strict';\n  let idea,\n    isAddLinkMode,\n    currentLabelGenerator,\n    isInputEnabled = true,\n    isEditingEnabled = true,\n    revertSelectionForUndo,\n    revertActivatedForUndo,\n    themeSource = false,\n    paused = false,\n    activatedNodes = [],\n    layoutCalculator,\n    currentlySelectedIdeaId;\n\n  // TODO: Apparently `const self = this` is now bad practice, so try removing and updating references if necessary\n  //   Or can just rename self to something else\n  const self = this,\n    autoThemedIdeaUtils = (optional && optional.autoThemedIdeaUtils) || require('./content/auto-themed-idea-utils'),\n    clipboard = clipboardProvider || new MemoryClipboard(),\n    reorderMargin = (optional && optional.reorderMargin) || 20,\n    layoutModel = (optional && optional.layoutModel) || new LayoutModel({ nodes: {}, connectors: {} }),\n    setRootNodePositionsForPrecalculatedLayout = function (contextNode, specificLayout) {\n      const rootIdeas = Object.keys(idea.ideas).map(rank => idea.ideas[rank]),\n        layout = specificLayout || layoutCalculator(idea, contextNode);\n      rootIdeas.forEach(rootIdea => {\n        const existingPosition = rootIdea.attr && rootIdea.attr.position,\n          rootNodeInLayout = layout.nodes && layout.nodes[rootIdea.id],\n          shouldUpdatePosition = rootNodeInLayout && (!existingPosition || existingPosition[0] !== rootNodeInLayout.x || existingPosition[1] !== rootNodeInLayout.y);\n        if (shouldUpdatePosition) {\n          idea.updateAttr(rootIdea.id, 'position', [rootNodeInLayout.x, rootNodeInLayout.y, 1]);\n        }\n      });\n    },\n    addSubIdea = (parentId, ideaTitle, optionalNewId, optionalIdeaAttr) => {\n      const themeObj = themeSource && themeSource();\n      return autoThemedIdeaUtils.addSubIdea(idea, themeObj, parentId, ideaTitle, optionalNewId, optionalIdeaAttr);\n    },\n    insertIntermediateMultiple = (inFrontOfIdeaIds, ideaOptions) => {\n      const themeObj = themeSource && themeSource();\n      return autoThemedIdeaUtils.insertIntermediateMultiple(idea, themeObj, inFrontOfIdeaIds, ideaOptions);\n    },\n    changeParent = (ideaId, newParentId) => {\n      const themeObj = themeSource && themeSource();\n      return autoThemedIdeaUtils.changeParent(idea, themeObj, ideaId, newParentId);\n    },\n    setActiveNodes = function (activated) {\n      const wasActivated = _.clone(activatedNodes);\n      if (activated.length === 0) {\n        activatedNodes = [currentlySelectedIdeaId];\n      } else {\n        activatedNodes = activated;\n      }\n      self.dispatchEvent('activatedNodesChanged', _.difference(activatedNodes, wasActivated), _.difference(wasActivated, activatedNodes));\n    },\n    applyLabels = function (newLayout) {\n      const labelMap = currentLabelGenerator && currentLabelGenerator(idea);\n      if (!labelMap) {\n        return;\n      }\n      _.each(newLayout.nodes, function (node, id) {\n        if (labelMap[id] || labelMap[id] === 0) {\n          node.label = labelMap[id];\n        }\n      });\n    },\n    closestNodeId = function (nodeList, referenceNode) {\n      const closestNode = _.min(nodeList, function (node) {\n        return Math.pow(node.x + node.width / 2 - referenceNode.x - referenceNode.width / 2, 2)\n          + Math.pow(node.y + node.height / 2 - referenceNode.y - referenceNode.height / 2, 2);\n      });\n      return closestNode && closestNode.id;\n    },\n    updateCurrentLayout = function (newLayout, sessionId, themeChanged) {\n      let layoutCompleteOptions;\n      const currentLayout = layoutModel.getLayout(),\n        nodePositionsChanged = (oldNode, newNode) => {\n          if (!oldNode || !newNode) {\n            return false;\n          }\n          return (newNode.x !== oldNode.x || newNode.y !== oldNode.y);\n        },\n        connectorNodeMoved = (oldConnector, newConnector) => {\n          if (!oldConnector || !newConnector || oldConnector.from !== newConnector.from || oldConnector.to !== newConnector.to) {\n            return false;\n          }\n          const oldFromNode = currentLayout.nodes[oldConnector.from],\n            oldToNode = currentLayout.nodes[oldConnector.to],\n            newFromNode = newLayout.nodes[newConnector.from],\n            newToNode = newLayout.nodes[newConnector.to];\n          return nodePositionsChanged(oldFromNode, newFromNode) || nodePositionsChanged(oldToNode, newToNode);\n        };\n\n      self.dispatchEvent('layoutChangeStarting', _.size(newLayout.nodes) - _.size(currentLayout.nodes));\n      applyLabels(newLayout);\n      _.each(currentLayout.connectors, function (oldConnector, connectorId) {\n        const newConnector = newLayout.connectors && newLayout.connectors[connectorId];\n        if (!newConnector || newConnector.from !== oldConnector.from || newConnector.to !== oldConnector.to) {\n          self.dispatchEvent('connectorRemoved', oldConnector);\n        }\n      });\n      _.each(currentLayout.links, function (oldLink, linkId) {\n        const newLink = newLayout.links && newLayout.links[linkId];\n        if (!newLink) {\n          self.dispatchEvent('linkRemoved', oldLink);\n        }\n      });\n      _.each(currentLayout.nodes, function (oldNode, nodeId) {\n        const newNode = newLayout.nodes[nodeId];\n        let newActive;\n        if (!newNode) {\n          /*jslint eqeq: true*/\n          if (nodeId == currentlySelectedIdeaId) { //eslint-disable-line eqeqeq\n            self.selectNode(closestNodeId(newLayout.nodes, oldNode));\n          }\n          newActive = _.reject(activatedNodes, function (e) {\n            return e == nodeId; // eslint-disable-line eqeqeq\n          });\n          if (newActive.length !== activatedNodes.length) {\n            setActiveNodes(newActive);\n          }\n          self.dispatchEvent('nodeRemoved', oldNode, nodeId, sessionId);\n        }\n      });\n\n      _.each(newLayout.nodes, function (newNode, nodeId) {\n        const oldNode = currentLayout.nodes[nodeId];\n        if (!oldNode) {\n          self.dispatchEvent('nodeCreated', newNode, sessionId);\n        } else {\n          if (nodePositionsChanged(newNode, oldNode)) {\n            self.dispatchEvent('nodeMoved', newNode, sessionId);\n          }\n          if ((newNode.width !== oldNode.width || newNode.height !== oldNode.height) ||\n            (newNode.level !== oldNode.level) ||\n            (!_.isEqual(newNode.attr || {}, oldNode.attr || {})) ||\n            themeChanged) {\n            self.dispatchEvent('nodeAttrChanged', newNode, sessionId);\n          }\n          if (newNode.title !== oldNode.title) {\n            self.dispatchEvent('nodeTitleChanged', newNode, sessionId);\n          }\n          if (newNode.label !== oldNode.label) {\n            self.dispatchEvent('nodeLabelChanged', newNode, sessionId);\n          }\n        }\n      });\n      _.each(newLayout.connectors, function (newConnector, connectorId) {\n        const oldConnector = currentLayout.connectors[connectorId];\n        if (oldConnector && !_.isEqual(oldConnector.attr || {}, newConnector.attr || {})) {\n          self.dispatchEvent('connectorAttrChanged', newConnector);\n        } else if (connectorNodeMoved(oldConnector, newConnector)) {\n          self.dispatchEvent('connectorMoved', newConnector);\n        }\n        if (!oldConnector || newConnector.from !== oldConnector.from || newConnector.to !== oldConnector.to) {\n          self.dispatchEvent('connectorCreated', newConnector, sessionId);\n        }\n      });\n      _.each(newLayout.links, function (newLink, linkId) {\n        const oldLink = currentLayout.links && currentLayout.links[linkId];\n        if (oldLink) {\n          if (!_.isEqual(newLink.attr || {}, (oldLink && oldLink.attr) || {})) {\n            self.dispatchEvent('linkAttrChanged', newLink, sessionId);\n          }\n        } else {\n          self.dispatchEvent('linkCreated', newLink, sessionId);\n        }\n      });\n      if (themeChanged) {\n        layoutCompleteOptions = { themeChanged: true };\n      }\n      layoutModel.setLayout(newLayout);\n      // Logs node layout to console to help with debugging:\n      Utilities.idea_pp(idea);\n      if (!self.isInCollapse) {\n        self.dispatchEvent('layoutChangeComplete', layoutCompleteOptions);\n      }\n    },\n    selectNewIdea = function (newIdeaId) {\n      revertSelectionForUndo = currentlySelectedIdeaId;\n      revertActivatedForUndo = activatedNodes.slice(0);\n      self.selectNode(newIdeaId);\n    },\n    editNewIdea = function (newIdeaId) {\n      selectNewIdea(newIdeaId);\n      self.editNode(false, true, true);\n    },\n    getCurrentlySelectedIdeaId = function () {\n      return currentlySelectedIdeaId || idea.getDefaultRootId();\n    },\n    onIdeaChanged = function (action, args, sessionId) {\n      if (paused) {\n        return;\n      }\n      revertSelectionForUndo = false;\n      revertActivatedForUndo = false;\n      self.rebuildRequired(sessionId);\n    },\n    currentlySelectedIdea = function () {\n      return (idea.findSubIdeaById(currentlySelectedIdeaId) || idea);\n    },\n    ensureNodeIsExpanded = function (source, nodeId) {\n      const node = idea.findSubIdeaById(nodeId) || idea;\n      if (node.getAttr('collapsed')) {\n        idea.updateAttr(nodeId, 'collapsed', false);\n      }\n    },\n    addSubIdeaToTargetNode = function (source, targetId, initialTitle) {\n      const targetNode = idea.findSubIdeaById(targetId) || idea;\n      let newId;\n      ensureNodeIsExpanded(source, targetId);\n      if (initialTitle) {\n        newId = addSubIdea(targetId, initialTitle);\n      } else {\n        newId = addSubIdea(targetId);\n      }\n      if (layoutModel.getOrientation() === 'top-down') {\n        if (targetNode.findChildRankById(newId) < 0) {\n          idea.flip(newId);\n        }\n      }\n      return newId;\n    },\n    setNodePositionFromCurrentLayout = function (nodeId) {\n      const node = nodeId && layoutModel.getNode(nodeId);\n      if (node) {\n        idea.updateAttr(nodeId, 'position', [node.x, node.y, 1]);\n      }\n    },\n    positionNextTo = function (nodeId, relativeNodeId) {\n      const relativeNode = relativeNodeId && layoutModel.getNode(relativeNodeId);\n      if (relativeNode) {\n        idea.updateAttr(nodeId, 'position', [relativeNode.x + relativeNode.width + 2 * reorderMargin, relativeNode.y, 1]);\n      }\n    },\n    analytic = function (eventName, eventArg) {\n      if (eventArg) {\n        self.dispatchEvent('analytic', 'mapModel', eventName, eventArg);\n      } else {\n        self.dispatchEvent('analytic', 'mapModel', eventName);\n      }\n    };\n  observable(this);\n  self.pause = function () {\n    paused = true;\n  };\n  self.resume = function () {\n    paused = false;\n    self.rebuildRequired();\n  };\n  self.getIdea = function () {\n    return idea;\n  };\n  self.isEditingEnabled = function () {\n    return isEditingEnabled;\n  };\n  self.getCurrentLayout = function () {\n    return layoutModel.getLayout();\n  };\n  self.analytic = analytic;\n  self.getCurrentlySelectedIdeaId = getCurrentlySelectedIdeaId;\n  self.rebuildRequired = function (sessionId) {\n    if (!idea) {\n      return;\n    }\n    const currentLayout = layoutModel.getLayout(),\n      themeHasChanged = currentLayout.theme !== (idea.attr && idea.attr.theme),\n      ideaThemeOverrides = idea.attr && idea.attr.themeOverrides,\n      layoutThemeOverrides = currentLayout && currentLayout.themeOverrides,\n      themeOverridesHaveChanged = !_.isEqual(ideaThemeOverrides || {}, layoutThemeOverrides || {}),\n      themeChanged = themeHasChanged || themeOverridesHaveChanged;\n    if (themeChanged) {\n      self.dispatchEvent('themeChanged', idea.attr && idea.attr.theme, idea.attr && idea.attr.themeOverrides);\n    }\n    updateCurrentLayout(self.reactivate(layoutCalculator(idea)), sessionId, themeChanged);\n  };\n  this.setIdea = function (anIdea, tryKeepingContext) {\n    const oldSelectedIdea = currentlySelectedIdeaId;\n    if (!layoutCalculator) {\n      throw new Error('layout calculator not set');\n    };\n    if (idea) {\n      idea.removeEventListener('changed', onIdeaChanged);\n      paused = false;\n      setActiveNodes([]);\n      self.dispatchEvent('nodeSelectionChanged', currentlySelectedIdeaId, false);\n      currentlySelectedIdeaId = undefined;\n    }\n    idea = anIdea;\n    idea.addEventListener('changed', onIdeaChanged);\n    onIdeaChanged();\n    if (tryKeepingContext && idea.findSubIdeaById(oldSelectedIdea)) {\n      self.selectNode(oldSelectedIdea, true);\n    } else {\n      self.selectNode(idea.getDefaultRootId(), true);\n      self.dispatchEvent('mapViewResetRequested');\n    }\n\n  };\n  this.setEditingEnabled = function (value) {\n    isEditingEnabled = value;\n  };\n  this.getEditingEnabled = function () {\n    return isEditingEnabled;\n  };\n  this.setInputEnabled = function (source, dataset, value, holdFocus) {\n    (typeof value === 'undefined') ? value = dataset.setInputEnabled === 'true' : undefined;\n    if (isInputEnabled !== value) {\n      isInputEnabled = value;\n      self.dispatchEvent('inputEnabledChanged', value, !!holdFocus);\n    }\n  };\n  this.getInputEnabled = function () {\n    return isInputEnabled;\n  };\n  this.selectNode = function (id, force, appendToActive) {\n    if (force || (isInputEnabled && (id !== currentlySelectedIdeaId || !self.isActivated(id)))) {\n      if (currentlySelectedIdeaId) {\n        self.dispatchEvent('nodeSelectionChanged', currentlySelectedIdeaId, false);\n      }\n      currentlySelectedIdeaId = id;\n      if (appendToActive) {\n        self.activateNode('internal', id);\n      } else {\n        setActiveNodes([id]);\n      }\n\n      self.dispatchEvent('nodeSelectionChanged', id, true);\n    }\n  };\n  // This seems to be triggered by mouseup not mousedown\n  this.clickNode = function (id, event) {\n    const button = event && event.button && event.button !== -1,\n      // 'which', unlike button, seems to get populated on mouse up.\n      which = event.which;\n    if (event && event.altKey) {\n      self.toggleLink('mouse', id);\n    } else if (event && event.shiftKey) {\n      /*don't stop propagation, this is needed for drop targets*/\n      self.toggleActivationOnNode('mouse', id);\n    } else if (isAddLinkMode && !button) { // Removed in commit 354071624edb6c257441fcdfcb3f11ab92ad395e, restored to enable add link button. Using which instead of button stops it working.\n      this.toggleLink('mouse', id);\n      this.toggleAddLinkMode();\n    } else if (which) {\n      this.selectNode(id);\n      if (button && button !== -1 && isInputEnabled) {\n        self.dispatchEvent('contextMenuRequested', id, event.layerX, event.layerY);\n      }\n    } else {\n      self.dispatchEvent('nodeClicked', id, event);\n    }\n  };\n  this.findIdeaById = function (id) {\n    if (idea.id == id) { //eslint-disable-line eqeqeq\n      return idea;\n    }\n    return idea.findSubIdeaById(id);\n  };\n  this.getSelectedStyle = function (prop) {\n    return this.getStyleForId(currentlySelectedIdeaId, prop);\n  };\n  this.getStyleForId = function (id, prop) {\n    const node = layoutModel.getNode(id);\n    return node && node.attr && node.attr.style && node.attr.style[prop];\n  };\n  this.toggleCollapse = function (source) {\n    const selectedIdea = currentlySelectedIdea();\n    let isCollapsed;\n    if (self.isActivated(selectedIdea.id) && _.size(selectedIdea.ideas) > 0) {\n      isCollapsed = selectedIdea.getAttr('collapsed');\n    } else {\n      isCollapsed = self.everyActivatedIs(function (id) {\n        const node = self.findIdeaById(id);\n        if (node && _.size(node.ideas) > 0) {\n          return node.getAttr('collapsed');\n        }\n        return true;\n      });\n    }\n    this.collapse(source, !isCollapsed);\n  };\n  this.collapse = function (source, doCollapse) {\n    const contextNodeId = getCurrentlySelectedIdeaId(),\n      contextNode = function () {\n        return layoutModel.getNode(contextNodeId);\n      },\n      moveNodes = function (nodes, deltaX, deltaY) {\n        if (deltaX || deltaY) {\n          _.each(nodes, function (node) {\n            node.x += deltaX;\n            node.y += deltaY;\n            self.dispatchEvent('nodeMoved', node, 'scroll');\n          });\n        }\n      },\n      moveConnectors = function (connectors) {\n        if (!connectors) {\n          return;\n        }\n        Object.keys(connectors).forEach(key => self.dispatchEvent('connectorMoved', connectors[key]));\n      },\n      oldContext = contextNode();\n    let newContext = false;\n    analytic('collapse:' + doCollapse, source);\n    self.isInCollapse = true;\n    if (isInputEnabled) {\n      self.applyToActivated(function (id) {\n        const node = self.findIdeaById(id);\n        if (node && (!doCollapse || (node.ideas && _.size(node.ideas) > 0))) {\n          idea.updateAttr(id, 'collapsed', doCollapse);\n        }\n      });\n    }\n    newContext = contextNode();\n    if (oldContext && newContext) {\n      moveNodes(\n        layoutModel.getLayout().nodes,\n        oldContext.x - newContext.x,\n        oldContext.y - newContext.y\n      );\n      moveConnectors(layoutModel.getLayout().connectors);\n    }\n    self.isInCollapse = false;\n    self.dispatchEvent('layoutChangeComplete');\n  };\n  this.updateStyle = function (source, prop, value) {\n    /*jslint eqeq:true */\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (isInputEnabled) {\n      analytic('updateStyle:' + prop, source);\n      self.applyToActivated(function (id) {\n        if (self.getStyleForId(id, prop) != value) { //eslint-disable-line eqeqeq\n          idea.mergeAttrProperty(id, 'style', prop, value);\n        }\n      });\n    }\n  };\n  this.updateLinkStyle = function (source, ideaIdFrom, ideaIdTo, prop, value) {\n    const merged = _.extend({}, idea.getLinkAttr(ideaIdFrom, ideaIdTo, 'style'));\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (isInputEnabled) {\n      analytic('updateLinkStyle:' + prop, source);\n      if (prop === 'arrow') {\n        // If arrow button pressed, toggle arrow value.\n        value = merged.arrow ? false : 'to';\n      }\n      merged[prop] = value;\n      idea.updateLinkAttr(ideaIdFrom, ideaIdTo, 'style', merged);\n    }\n  };\n  this.addSubIdea = function (source, parentId, initialTitle) {\n    const target = parentId || currentlySelectedIdeaId;\n    let newId;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addSubIdea', source);\n    if (isInputEnabled) {\n      idea.batch(function () {\n        newId = addSubIdeaToTargetNode(source, target, initialTitle);\n        setRootNodePositionsForPrecalculatedLayout(newId);\n      });\n      if (newId) {\n        if (initialTitle) {\n          selectNewIdea(newId);\n        } else {\n          editNewIdea(newId);\n        }\n      }\n    }\n\n  };\n  self.addGroupSubidea = function (source, options) {\n    const parentId = options && options.parentId,\n      group = (options && options.group) || true,\n      target = parentId || currentlySelectedIdeaId;\n    let newGroupId, newId;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addGroupSubidea', source);\n    if (isInputEnabled) {\n      idea.batch(function () {\n        newGroupId = addSubIdeaToTargetNode(source, target, 'group');\n        if (newGroupId) {\n          idea.updateAttr(newGroupId, 'contentLocked', true);\n          idea.updateAttr(newGroupId, 'group', group);\n          newId = addSubIdea(newGroupId);\n        }\n        setRootNodePositionsForPrecalculatedLayout(newId);\n      });\n      if (newId) {\n        editNewIdea(newId);\n      }\n    }\n\n  };\n\n  // Button removed since current functionality not very useful\n  // this.insertIntermediateGroup = function (source, options) {\n  //   const activeNodes = [],\n  //     group = (options && options.group) || true;\n  //   if (!isEditingEnabled) {\n  //     return false;\n  //   }\n  //   // This line stops parent reason being added to root node:\n  //   // if (!isInputEnabled || idea.isRootNode(currentlySelectedIdeaId)) {\n  //   if (!isInputEnabled) {\n  //     return false;\n  //   }\n  //   analytic('insertIntermediate', source);\n  //   self.applyToActivated(function (i) {\n  //     activeNodes.push(i);\n  //   });\n  //   insertIntermediateMultiple(activeNodes, { title: 'group', attr: { group: group, contentLocked: true } });\n  // };\n\n  this.insertIntermediate = function (source) {\n    const activeNodes = [];\n    let newId = false;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (!isInputEnabled) {\n      return false;\n    }\n    analytic('insertIntermediate', source);\n    self.applyToActivated(function (i) {\n      activeNodes.push(i);\n    });\n    newId = insertIntermediateMultiple(activeNodes);\n    if (newId) {\n      editNewIdea(newId);\n    }\n  };\n  this.flip = function (source) {\n    const node = layoutModel.getNode(currentlySelectedIdeaId);\n\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('flip', source);\n    if (!isInputEnabled || idea.isRootNode(currentlySelectedIdeaId)) {\n      return false;\n    }\n    if (!node || node.level !== 2) {\n      return false;\n    }\n\n    return idea.flip(currentlySelectedIdeaId);\n  };\n  this.addSiblingIdeaBefore = function (source) {\n    let newId, parent, contextRank, newRank;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addSiblingIdeaBefore', source);\n    if (!isInputEnabled) {\n      return false;\n    }\n    if (idea.isRootNode(currentlySelectedIdeaId)) {\n      parent = idea;\n    } else {\n      parent = idea.findParent(currentlySelectedIdeaId);\n    }\n    idea.batch(function () {\n      if (parent !== idea) {\n        ensureNodeIsExpanded(source, parent.id);\n      }\n      newId = addSubIdea(parent.id);\n      if (newId) {\n        if (parent === idea) {\n          positionNextTo(newId, currentlySelectedIdeaId);\n        } else {\n          contextRank = parent.findChildRankById(currentlySelectedIdeaId);\n          newRank = parent.findChildRankById(newId);\n          if (contextRank * newRank < 0) {\n            idea.flip(newId);\n          }\n          idea.positionBefore(newId, currentlySelectedIdeaId);\n        }\n        setRootNodePositionsForPrecalculatedLayout(newId);\n      }\n    });\n    if (newId) {\n      editNewIdea(newId);\n    }\n  };\n  this.addSiblingIdea = function (source, optionalNodeId, optionalInitialText) {\n    let newId, nextId, parent, contextRank, newRank;\n    const currentId = optionalNodeId || currentlySelectedIdeaId;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addSiblingIdea', source);\n    if (isInputEnabled) {\n\n      if (idea.isRootNode(currentId)) {\n        parent = idea;\n      } else {\n        parent = idea.findParent(currentId);\n      }\n      idea.batch(function () {\n        if (parent !== idea) {\n          ensureNodeIsExpanded(source, parent.id);\n        }\n        if (optionalInitialText) {\n          newId = addSubIdea(parent.id, optionalInitialText);\n        } else {\n          newId = addSubIdea(parent.id);\n        }\n        if (newId) {\n          if (parent === idea) {\n            positionNextTo(newId, currentlySelectedIdeaId);\n          } else {\n            nextId = idea.nextSiblingId(currentId);\n            contextRank = parent.findChildRankById(currentId);\n            newRank = parent.findChildRankById(newId);\n            if (contextRank * newRank < 0) {\n              idea.flip(newId);\n            }\n            if (nextId) {\n              idea.positionBefore(newId, nextId);\n            }\n          }\n          setRootNodePositionsForPrecalculatedLayout(newId);\n        }\n      });\n      if (newId) {\n        if (optionalInitialText) {\n          selectNewIdea(newId);\n        } else {\n          editNewIdea(newId);\n        }\n      }\n    }\n  };\n  this.removeSubIdea = function (source) {\n    let removed;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('removeSubIdea', source);\n    if (isInputEnabled) {\n      self.applyToActivated(function (id) {\n        removed = idea.removeSubIdea(id);\n      });\n    }\n    return removed;\n  };\n  this.updateTitle = function (ideaId, title, isNew) {\n    idea.batch(() => {\n      if (isNew) {\n        idea.initialiseTitle(ideaId, title);\n      } else {\n        idea.updateTitle(ideaId, title);\n      }\n      setRootNodePositionsForPrecalculatedLayout(ideaId);\n    });\n  };\n  this.editNode = function (source, shouldSelectAll, editingNew) {\n    const currentIdea = currentlySelectedIdea(),\n      title = currentIdea.title;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (source) {\n      analytic('editNode', source);\n    }\n    if (!isInputEnabled) {\n      return false;\n    }\n\n    if (currentIdea.attr && currentIdea.attr.contentLocked) {\n      return false;\n    }\n\n    if (_.include(selectAllTitles, title)) { // === 'Press Space or double-click to edit') {\n      shouldSelectAll = true;\n    }\n    self.dispatchEvent('nodeEditRequested', currentlySelectedIdeaId, shouldSelectAll, !!editingNew);\n  };\n  // this.editIcon = function (source) {\n  //   if (!isEditingEnabled) {\n  //     return false;\n  //   }\n  //   if (source) {\n  //     analytic('editIcon', source);\n  //   }\n  //   if (!isInputEnabled) {\n  //     return false;\n  //   }\n  //   self.dispatchEvent('nodeIconEditRequested', currentlySelectedIdeaId);\n  // };\n  this.scaleUp = function (source) {\n    self.scale(source, 1.25);\n  };\n  this.scaleDown = function (source) {\n    self.scale(source, 0.8);\n  };\n  this.scale = function (source, scaleMultiplier, zoomPoint) {\n    if (isInputEnabled) {\n      self.dispatchEvent('mapScaleChanged', scaleMultiplier, zoomPoint);\n      analytic(scaleMultiplier < 1 ? 'scaleDown' : 'scaleUp', source);\n    }\n  };\n  this.move = function (source, deltaX, deltaY) {\n    if (isInputEnabled) {\n      self.dispatchEvent('mapMoveRequested', deltaX, deltaY);\n      analytic('move', source);\n    }\n  };\n  this.resetView = function (source) {\n    const selectedNode = layoutModel.getNode(currentlySelectedIdeaId),\n      localRoot = (selectedNode && selectedNode.rootId) || (idea && idea.getDefaultRootId());\n    if (!localRoot) {\n      return;\n    }\n    if (isInputEnabled) {\n      analytic('resetView', source);\n      self.selectNode(localRoot);\n      self.dispatchEvent('mapViewResetRequested');\n    }\n  };\n  this.decorationAction = function (source, nodeId, decorationType) {\n    analytic('decorationAction', source);\n    self.dispatchEvent('decorationActionRequested', nodeId, decorationType);\n  };\n\n  // This now only needed for `alt+o` shortcut, since file input can be tabbed to while pretending that 'Load' button is selected.\n  //   So container no longer needed as argument but leaving in for now.\n  this.handleKey_loadMap = function (source, event, container) {\n    analytic('handleKeyLoadMap', source);\n    // const container = event.currentTarget,\n    const FILEBUTTON_CLASS = CONFIG.toolbar_fileButton.class,\n      fileButton = container.getElementsByClassName(FILEBUTTON_CLASS)[0];\n    fileButton.click();\n  };\n\n  // TODO: Add support for multiple files\n  //   When the (file input element) multiple Boolean attribute is specified, the file input allows the user to select more than one file.\n  //   Could either load them as separate map roots, or open a container for each one\n  //    If load is part of toolbar then only former makes sense\n  this.readFile = function (source, data_target, filename, event) {\n    analytic('loadMap', source);\n    const fileList = event.target.files;\n    if (fileList.length > 0) { // fileList can change from a file to no file\n      const file = fileList[0],\n        reader = new window.FileReader;\n\n      reader.onload = function () {\n        self.loadMap(reader.result, data_target, true);\n      };\n\n      // Think this triggers the onload, but not certain:\n      reader.readAsText(file);\n    }\n  };\n\n  // TODO: Need to re-use some of this in combination with addMap(), drag and drop, cut and paste.\n  // TODO: Should have error catching/sanitation for file type/data\n  // Called by `readFile()` above and also client_argmap2mapjs.lua\n  this.loadMap = function (mapJson, target_container_id, replace) {\n    const mapM = this,\n      old_idea = mapM.getIdea();\n\n    // Batch ensures that operations are atomic\n    // So counts as a single undo/redo step\n    return old_idea.batch(function () {\n      if (replace) {\n        // Was hoping that nesting this inside batch would enable undo, but does not.\n        const new_idea = mapM.content(JSON.parse(mapJson));\n        mapM.setIdea(new_idea);\n      } else {\n        old_idea.pasteMultiple('root', JSON.parse(mapJson).ideas);\n        mapM.removeSubIdea('root', 'loadMap');\n      }\n    });\n\n    return true;\n  };\n  this.downloadMap = function (source) {\n    analytic('downloadMap', source);\n    const mapJson = this.getIdea(),\n      mapOutput = JSON.stringify(mapJson);\n    Utilities.downloadToFile(mapOutput, mapJson.title + '.json', 'application/json');\n  };\n\n  // Not currently very useful, so removed button:\n  // this.openAttachment = function (source, nodeId) {\n  //   analytic('openAttachment', source);\n  //   nodeId = nodeId || currentlySelectedIdeaId;\n  //   const node = layoutModel.getNode(nodeId),\n  //     attachment = node && node.attr && node.attr.attachment;\n  //   if (node) {\n  //     self.dispatchEvent('attachmentOpened', nodeId, attachment);\n  //   }\n  // };\n  // this.setAttachment = function (source, nodeId, attachment) {\n  //   const hasAttachment = !!(attachment && (attachment.content || attachment.goldAssetId));\n  //   if (!isEditingEnabled) {\n  //     return false;\n  //   }\n  //   analytic('setAttachment', source);\n  //   idea.updateAttr(nodeId, 'attachment', hasAttachment && attachment);\n  // };\n\n  this.toggleLink = function (source, nodeIdTo) {\n    const exists = _.find(idea.links, function (link) {\n      return (String(link.ideaIdFrom) === String(nodeIdTo) && String(link.ideaIdTo) === String(currentlySelectedIdeaId)) || (String(link.ideaIdTo) === String(nodeIdTo) && String(link.ideaIdFrom) === String(currentlySelectedIdeaId));\n    });\n    if (exists) {\n      self.removeLink(source, exists.ideaIdFrom, exists.ideaIdTo);\n    } else {\n      self.addLink(source, nodeIdTo);\n    }\n  };\n  this.addLink = function (source, nodeIdTo) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addLink', source);\n    idea.addLink(currentlySelectedIdeaId, nodeIdTo);\n  };\n\n  this.selectLink = function (source, link, selectionPoint) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('selectLink', source);\n    if (!link) {\n      return false;\n    }\n\n    // Remove class 'selected' from previously selected link, add it to newly selected link\n    //  Also node IDs can contain dots ('.') so rewrite ID . with _, consistent with how they appear in HTML.\n    // QUESTION: Should this be toggle so two clicks would unselect?\n    //   Would need to change link-edit-widget behaviour too.\n    const link_id = [link.type, link.ideaIdFrom, link.ideaIdTo].join('_').replaceAll('.', '_'),\n      // Unfortunately links are not guaranteed to have a unique ID, because code was written assuming a single container on the page, but now supports multiple containers, which may have links between identical node IDs.\n      // Can  identify current container using this.container_element (which is assigned in start.js), so that only relevant links are affected:\n      // Can only use getElementById at doc level so using querySelector instead:\n      link_element = this.containerElement.querySelector('#' + link_id);\n    if (link_element && !link_element.classList.contains('selected-link')) {\n      // TODO: Would be more efficient to remember the selected link and then remove the class from it without having to find it again.\n      const old_selected_link = this.containerElement.getElementsByClassName('selected-link')[0];\n      (old_selected_link ? old_selected_link.classList.remove('selected-link') : undefined);\n      link_element.classList.add('selected-link');\n    };\n    self.dispatchEvent('linkSelected', link, selectionPoint, idea.getLinkAttr(link.ideaIdFrom, link.ideaIdTo, 'style'));\n  };\n\n  this.selectConnector = function (source, connector, selectionPoint) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('selectConnector', source);\n    if (!connector) {\n      return false;\n    }\n    self.dispatchEvent('connectorSelected', connector, selectionPoint, idea.getAttrById(connector.to, 'parentConnector'));\n  };\n  this.removeLink = function (source, nodeIdFrom, nodeIdTo) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('removeLink', source);\n    idea.removeLink(nodeIdFrom, nodeIdTo);\n  };\n\n  this.toggleAddLinkMode = function (source) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (!isInputEnabled) {\n      return false;\n    }\n    analytic('toggleAddLinkMode', source);\n    isAddLinkMode = !isAddLinkMode;\n    self.dispatchEvent('addLinkModeToggled', isAddLinkMode);\n  };\n  this.cancelCurrentAction = function (source) {\n    if (!isInputEnabled) {\n      return false;\n    }\n    if (!isEditingEnabled) {\n      return false;\n    }\n    if (isAddLinkMode) {\n      this.toggleAddLinkMode(source);\n    }\n  };\n\n  self.undo = function (source) {\n    const undoSelectionClone = revertSelectionForUndo,\n      undoActivationClone = revertActivatedForUndo;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('undo', source);\n    if (isInputEnabled) {\n      idea.undo();\n      if (undoSelectionClone) {\n        self.selectNode(undoSelectionClone);\n      }\n      if (undoActivationClone) {\n        setActiveNodes(undoActivationClone);\n      }\n\n    }\n  };\n  self.redo = function (source) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n\n    analytic('redo', source);\n    if (isInputEnabled) {\n      idea.redo();\n    }\n  };\n  self.moveRelative = function (source, relativeMovement) {\n    let options;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('moveRelative', source);\n    if (isInputEnabled) {\n      if (layoutModel.getOrientation() === 'top-down') {\n        options = { ignoreRankSide: true };\n      }\n      idea.moveRelative(currentlySelectedIdeaId, relativeMovement, options);\n    }\n  };\n  self.cut = function (source) {\n    const activeNodeIds = [], parents = [];\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('cut', source);\n    if (isInputEnabled) {\n      self.applyToActivated(function (nodeId) {\n        activeNodeIds.push(nodeId);\n        parents.push(idea.findParent(nodeId).id);\n      });\n      clipboard.put(idea.cloneMultiple(activeNodeIds));\n      idea.removeMultiple(activeNodeIds);\n    }\n  };\n  self.contextForNode = function (nodeId) {\n    const node = self.findIdeaById(nodeId),\n      hasChildren = node && node.ideas && _.size(node.ideas) > 0,\n      rootCount = _.size(idea.ideas),\n      hasSiblings = idea.hasSiblings(nodeId),\n      hasPreferredWidth = node && node.attr && node.attr.style && node.attr.style.width,\n      hasPosition = node && node.attr && node.attr.position,\n      isCollapsed = node && node.getAttr('collapsed'),\n      canPaste = node && isEditingEnabled && clipboard && clipboard.get(),\n      isRoot = idea.isRootNode(nodeId);\n    if (node) {\n      return {\n        hasChildren: !!hasChildren,\n        hasSiblings: !!hasSiblings,\n        hasPreferredWidth: !!hasPreferredWidth,\n        canPaste: !!canPaste,\n        hasPreferredPosition: !!hasPosition,\n        notRoot: !isRoot,\n        notLastRoot: !isRoot || (rootCount > 1),\n        canUndo: idea.canUndo() && !revertSelectionForUndo,\n        canRedo: idea.canRedo() && !revertSelectionForUndo,\n        canCollapse: hasChildren && !isCollapsed,\n        canExpand: hasChildren && isCollapsed\n      };\n    }\n\n  };\n  self.copy = function (source) {\n    const activeNodeIds = [];\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('copy', source);\n    if (isInputEnabled) {\n      self.applyToActivated(function (node) {\n        activeNodeIds.push(node);\n      });\n      clipboard.put(idea.cloneMultiple(activeNodeIds));\n    }\n  };\n  self.paste = function (source) {\n    let result;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('paste', source);\n    if (isInputEnabled) {\n      result = idea.pasteMultiple(currentlySelectedIdeaId, clipboard.get());\n      if (result && result[0]) {\n        self.selectNode(result[0]);\n      }\n    }\n    return result;\n  };\n  self.pasteStyle = function (source) {\n    const clipContents = clipboard.get();\n    let pastingStyle;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('pasteStyle', source);\n    if (isInputEnabled && clipContents && clipContents[0]) {\n      pastingStyle = clipContents[0].attr && clipContents[0].attr.style;\n      self.applyToActivated(function (id) {\n        idea.updateAttr(id, 'style', pastingStyle);\n      });\n    }\n  };\n  self.getIcon = function (nodeId) {\n    const node = layoutModel.getNode(nodeId || currentlySelectedIdeaId);\n    if (!node) {\n      return false;\n    }\n    return node.attr && node.attr.icon;\n  };\n  self.setIcon = function (source, url, imgWidth, imgHeight, position, nodeId, metaData) {\n    let nodeIdea = false, iconObject;\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('setIcon', source);\n    nodeId = nodeId || currentlySelectedIdeaId;\n    nodeIdea = self.findIdeaById(nodeId);\n    if (!nodeIdea) {\n      return false;\n    }\n    if (url) {\n      iconObject = {\n        url: url,\n        width: imgWidth,\n        height: imgHeight,\n        position: position\n      };\n      if (metaData) {\n        iconObject.metaData = metaData;\n      }\n      idea.updateAttr(nodeId, 'icon', iconObject);\n    } else {\n      idea.updateAttr(nodeId, 'icon', false);\n      if (!nodeIdea.title && _.size(nodeIdea.ideas) === 0) {\n        idea.removeSubIdea(nodeId);\n      }\n    }\n  };\n  self.insertUp = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.addSiblingIdeaBefore(source);\n    } else {\n      self.insertIntermediate(source);\n    }\n  };\n  self.insertDown = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.addSiblingIdea(source);\n    } else {\n      self.addSubIdea(source);\n    }\n  };\n  self.insertLeft = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.insertIntermediate(source);\n    } else {\n      self.addSiblingIdeaBefore(source);\n    }\n  };\n  self.insertRight = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.addSubIdea(source);\n    } else {\n      self.addSiblingIdea(source);\n    }\n  };\n  self.moveUp = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.moveRelative(source, -1);\n    }\n  };\n  self.moveDown = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.moveRelative(source, 1);\n    }\n  };\n  self.moveLeft = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.flip(source);\n    } else {\n      self.moveRelative(source, -1);\n    }\n  };\n  self.moveRight = function (source) {\n    if (layoutModel.getOrientation() === 'standard') {\n      self.flip(source);\n    } else {\n      self.moveRelative(source, 1);\n    }\n  };\n  self.getSelectedNodeId = function () {\n    return getCurrentlySelectedIdeaId();\n  };\n  self.centerOnNode = function (nodeId) {\n    if (!layoutModel.getNode(nodeId)) {\n      idea.startBatch();\n      _.each(idea.calculatePath(nodeId), function (parent) {\n        idea.updateAttr(parent.id, 'collapsed', false);\n      });\n      idea.endBatch();\n    }\n    self.dispatchEvent('nodeFocusRequested', nodeId);\n    self.selectNode(nodeId);\n  };\n  self.search = function (query) {\n    const result = [];\n    query = query.toLocaleLowerCase();\n    idea.traverse(function (contentIdea) {\n      if (contentIdea.title && contentIdea.title.toLocaleLowerCase().indexOf(query) >= 0) {\n        result.push({ id: contentIdea.id, title: contentIdea.title });\n      }\n    });\n    return result;\n  };\n  //node activation and selection\n  (function () {\n    const applyToNodeDirection = function (source, analyticTag, method, direction) {\n        if (!isInputEnabled) {\n          return;\n        }\n        analytic(analyticTag, source);\n        const relId = layoutModel['nodeId' + direction](currentlySelectedIdeaId);\n        if (relId) {\n          method.apply(self, [relId]);\n        }\n      },\n      applyFuncs = {};\n\n    ['Left', 'Right', 'Up', 'Down'].forEach(function (direction) {\n      applyFuncs[direction] = function (source, analyticTag, method) {\n        applyToNodeDirection(source, analyticTag, method, direction);\n      };\n    });\n    self.getActivatedNodeIds = function () {\n      return activatedNodes.slice(0);\n    };\n    self.activateSiblingNodes = function (source) {\n      const parent = idea.findParent(currentlySelectedIdeaId),\n        siblingIds = parent && parent.ideas && _.map(parent.ideas, function (child) {\n          return child.id;\n        });\n\n      analytic('activateSiblingNodes', source);\n      if (!siblingIds) {\n        return;\n      }\n      setActiveNodes(siblingIds);\n    };\n    self.activateNodeAndChildren = function (source) {\n      const contextId = getCurrentlySelectedIdeaId(),\n        subtree = idea.getSubTreeIds(contextId);\n      analytic('activateNodeAndChildren', source);\n      subtree.push(contextId);\n      setActiveNodes(subtree);\n    };\n    _.each(['Left', 'Right', 'Up', 'Down'], function (position) {\n      self['activateNode' + position] = function (source) {\n        applyFuncs[position](source, 'activateNode' + position, function (nodeId) {\n          self.selectNode(nodeId, false, true);\n        });\n      };\n      self['selectNode' + position] = function (source) {\n        applyFuncs[position](source, 'selectNode' + position, self.selectNode);\n      };\n    });\n\n    self.toggleActivationOnNode = function (source, nodeId) {\n      analytic('toggleActivated', source);\n      if (!self.isActivated(nodeId)) {\n        setActiveNodes([nodeId].concat(activatedNodes));\n      } else {\n        setActiveNodes(_.without(activatedNodes, nodeId));\n      }\n    };\n    self.activateNode = function (source, nodeId) {\n      analytic('activateNode', source);\n      if (!self.isActivated(nodeId)) {\n        activatedNodes.push(nodeId);\n        self.dispatchEvent('activatedNodesChanged', [nodeId], []);\n      }\n    };\n    self.activateChildren = function (source) {\n      const context = currentlySelectedIdea();\n      analytic('activateChildren', source);\n      if (!context || _.isEmpty(context.ideas) || context.getAttr('collapsed')) {\n        return;\n      }\n      setActiveNodes(idea.getSubTreeIds(context.id));\n    };\n    self.activateSelectedNode = function (source) {\n      analytic('activateSelectedNode', source);\n      setActiveNodes([getCurrentlySelectedIdeaId()]);\n    };\n    self.isActivated = function (id) {\n      return _.find(activatedNodes, function (activeId) {\n        return id == activeId; //eslint-disable-line eqeqeq\n      });\n    };\n    self.applyToActivated = function (toApply) {\n      idea.batch(function () {\n        _.each(activatedNodes, toApply);\n      });\n    };\n    self.everyActivatedIs = function (predicate) {\n      return _.every(activatedNodes, predicate);\n    };\n    self.activateLevel = function (source, level) {\n      const toActivate = _.map(\n        _.filter(\n          layoutModel.getLayout().nodes,\n          function (node) {\n            return node.level == level; //eslint-disable-line eqeqeq\n          }\n        ),\n        function (node) {\n          return node.id;\n        }\n      );\n      analytic('activateLevel', source);\n      if (!_.isEmpty(toActivate)) {\n        setActiveNodes(toActivate);\n      }\n    };\n    self.reactivate = function (layout) {\n      _.each(layout.nodes, function (node) {\n        if (_.contains(activatedNodes, node.id)) {\n          node.activated = true;\n        }\n      });\n      return layout;\n    };\n  }());\n\n  self.getNodeIdAtPosition = function (x, y) {\n    const isPointOverNode = function (node) { //move to mapModel candidate\n      /*jslint eqeq: true*/\n        return x >= node.x &&\n        y >= node.y &&\n        x <= node.x + node.width &&\n        y <= node.y + node.height;\n      },\n      node = _.find(layoutModel.getLayout().nodes, isPointOverNode);\n    // QUESTION: Returns node.id, why not whole node?\n    return node && node.id;\n  };\n  self.autoPosition = function (nodeId) {\n    return idea.updateAttr(nodeId, 'position', false);\n  };\n  self.standardPositionNodeAt = function (nodeId, x, y, manualPosition) {\n    let result = false;\n    const rootNode = layoutModel.getNode(layoutModel.getNode(nodeId).rootId),\n      getVerticallyClosestNode = function () {\n        let verticallyClosestNode = {\n          id: null,\n          y: Infinity\n        };\n        _.each(idea.sameSideSiblingIds(nodeId), function (id) {\n          // ISSUE: idea.sameSideSiblingIds(nodeId) can return deleted grouping (e.g. green, supporting) node, which means node is undefined in next line:\n          //   Trying check to fix\n          const node = layoutModel.getNode(id);\n          // Check node is not undefined:\n          if (!node) {\n            return false;\n          }\n          if (y < node.y && node.y < verticallyClosestNode.y) {\n            verticallyClosestNode = node;\n          }\n        });\n        return verticallyClosestNode;\n      },\n      parentIdea = idea.findParent(nodeId),\n      parentNode = layoutModel.getNode(parentIdea.id),\n      thisNode = layoutModel.getNode(nodeId),\n      nodeBeingDragged = layoutModel.getNode(nodeId),\n      tryFlip = function (rootNode, nodeBeingDragged, nodeDragEndX) {\n        const flipRightToLeft = rootNode.x < nodeBeingDragged.x && nodeDragEndX < rootNode.x,\n          flipLeftToRight = rootNode.x > nodeBeingDragged.x && rootNode.x < nodeDragEndX;\n        if (flipRightToLeft || flipLeftToRight) {\n          return idea.flip(nodeId);\n        }\n        return false;\n      },\n      validReposition = function () {\n        return nodeBeingDragged.level <= 2 ||\n          ((nodeBeingDragged.x - parentNode.x) * (x - parentNode.x) > 0);\n      },\n      getMaxSequence = function () {\n        if (_.isEmpty(parentIdea.ideas)) {\n          return 0;\n        }\n        return _.max(_.map(parentIdea.ideas, function (i) {\n          return (i.id !== nodeId && i.attr && i.attr.position && i.attr.position[2]) || 0;\n        })) || 0;\n      },\n      manuallyPositionSubNode = function () {\n        let xOffset;\n        if (x < parentNode.x) {\n          xOffset = parentNode.x - x - nodeBeingDragged.width + parentNode.width; /* negative nodes will get flipped so distance is not correct out of the box */\n        } else {\n          xOffset = x - parentNode.x;\n        }\n        analytic('nodeManuallyPositioned');\n        return idea.updateAttr(\n          nodeId,\n          'position',\n          [xOffset, y - parentNode.y, getMaxSequence() + 1]\n        );\n      },\n      manuallyPositionRootNode = function () {\n        return idea.updateAttr(\n          nodeId,\n          'position',\n          [x, y, getMaxSequence() + 1]\n        );\n      };\n\n    idea.startBatch();\n    if (thisNode && thisNode.level === 2) {\n      result = tryFlip(rootNode, nodeBeingDragged, x);\n    }\n    if (!manualPosition && validReposition()) {\n      self.autoPosition(nodeId);\n    }\n    if (nodeBeingDragged.level > 1) {\n      result = idea.positionBefore(nodeId, getVerticallyClosestNode().id) || result;\n    }\n    if (manualPosition && validReposition()) {\n      if (nodeBeingDragged.level === 1) {\n        result = manuallyPositionRootNode();\n      } else {\n        result = manuallyPositionSubNode() || result;\n      }\n    }\n    setRootNodePositionsForPrecalculatedLayout(nodeId);\n    idea.endBatch();\n    return result;\n  };\n  self.topDownPositionNodeAt = function (nodeId, x, y, manualPosition) {\n    let result, closestNodeToRight, closestNodeToLeft;\n    const parentNode = idea.findParent(nodeId),\n      nodeBeingDragged = layoutModel.getNode(nodeId),\n      isRoot = function () {\n        return nodeBeingDragged.level < 2;\n      },\n      manuallyPositionRootNode = function () {\n        return idea.updateAttr(\n          nodeId,\n          'position',\n          [x, y, 1]\n        );\n      };\n    if (manualPosition) {\n      if (isRoot()) {\n        return manuallyPositionRootNode();\n      } else {\n        return idea.batch(function () {\n          changeParent(nodeId, 'root');\n          return manuallyPositionRootNode();\n        });\n      }\n    }\n    if (!parentNode) {\n      return false;\n    }\n    _.each(parentNode.ideas, function (sibling) {\n      const node = layoutModel.getNode(sibling.id);\n      if (sibling.id === nodeId) {\n        return;\n      }\n      if (x < node.x && (!closestNodeToRight || (Math.abs(x - node.x) < Math.abs(x - layoutModel.getNode(closestNodeToRight.id).x)))) {\n        closestNodeToRight = sibling;\n      }\n      if (x > (node.x + node.width) && (!closestNodeToLeft || (Math.abs(x - node.x) < Math.abs(x - layoutModel.getNode(closestNodeToLeft.id).x)))) {\n        closestNodeToLeft = sibling;\n      }\n    });\n    idea.batch(function () {\n      const useLeftNode = !!(closestNodeToRight && closestNodeToRight.id && idea.findChildRankById(closestNodeToRight.id) < 0),\n        closestNode = useLeftNode ? closestNodeToLeft : closestNodeToRight,\n        shouldFlip = (useLeftNode && (idea.findChildRankById(nodeId) > 0));\n      self.autoPosition(nodeId);\n      if (shouldFlip) {\n        idea.flip(nodeId);\n      }\n      result = idea.positionBefore(nodeId, closestNode && closestNode.id);\n    });\n    return result;\n  };\n  self.positionNodeAt = function (nodeId, x, y, manualPosition) {\n    if (layoutModel.getOrientation() === 'standard') {\n      return self.standardPositionNodeAt(nodeId, x, y, manualPosition);\n    } else {\n      return self.topDownPositionNodeAt(nodeId, x, y, manualPosition);\n    }\n  };\n  self.dropNode = function (nodeId, dropTargetId, shiftKey) {\n    let clone;\n    const parentIdea = idea.findParent(nodeId);\n    if (dropTargetId === nodeId) {\n      return false;\n    }\n    if (shiftKey) {\n      clone = idea.clone(nodeId);\n      if (clone) {\n        idea.paste(dropTargetId, clone);\n      }\n      return false;\n    }\n    if (dropTargetId === parentIdea.id) {\n      return self.autoPosition(nodeId);\n    } else {\n      return changeParent(nodeId, dropTargetId);\n    }\n  };\n  self.setLayoutCalculator = function (newCalculator) {\n    layoutCalculator = newCalculator;\n  };\n  self.setThemeSource = function (newThemeSource) {\n    themeSource = newThemeSource;\n  };\n  self.dropImage = function (dataUrl, imgWidth, imgHeight, x, y, metaData) {\n    const dropOn = function (ideaId, position) {\n        const scaleX = Math.min(imgWidth, 300) / imgWidth,\n          scaleY = Math.min(imgHeight, 300) / imgHeight,\n          scale = Math.min(scaleX, scaleY),\n          existing = idea.getAttrById(ideaId, 'icon');\n        self.setIcon('drag and drop', dataUrl, Math.round(imgWidth * scale), Math.round(imgHeight * scale), (existing && existing.position) || position, ideaId, metaData);\n      },\n      addNew = function () {\n        idea.startBatch();\n        const newId = addSubIdea(currentlySelectedIdeaId);\n        dropOn(newId, 'center');\n        idea.endBatch();\n        self.selectNode(newId);\n      },\n      nodeId = self.getNodeIdAtPosition(x, y);\n    if (nodeId) {\n      return dropOn(nodeId, 'left');\n    }\n    addNew();\n  };\n  self.setLabelGenerator = function (labelGenerator, labelGeneratorName) {\n    currentLabelGenerator = labelGenerator;\n    self.dispatchEvent('labelGeneratorChange', labelGeneratorName, !!labelGenerator);\n    self.rebuildRequired();\n  };\n  self.getStandardReorderBoundary = function (nodeId) {\n    const node = layoutModel.getNode(nodeId),\n      nonRootStandardReorderBoundary = function (nodeId) {\n        let opposite;\n        const boundaries = [],\n          node = layoutModel.getNode(nodeId),\n          rootNode = layoutModel.getNode(node && node.rootId),\n          isRightHalf = function (node, rootNode) {\n            return node && rootNode && node.x >= rootNode.x;\n          },\n          parentIdea = idea.findParent(nodeId),\n          parentNode = layoutModel.getNode(parentIdea.id),\n          primaryEdge = isRightHalf(node, rootNode) ? 'left' : 'right',\n          secondaryEdge = isRightHalf(node, rootNode) ? 'right' : 'left',\n          siblingBoundary = function (siblings, side) {\n            const tops = _.map(siblings, function (node) {\n              // siblings sometimes contains initial undefined value, so this should stop an error being thrown\n              //   See https://workflowy.com/#/6c9851b2d1f5\n              // TODO: Is undefined sibling sign of a bug?\n                return node ? node.y : undefined;\n              }),\n              bottoms = _.map(siblings, function (node) {\n                // siblings sometimes contains initial undefined value, so this should stop an error being thrown\n                //   See https://workflowy.com/#/6c9851b2d1f5\n                // TODO: Is undefined sibling sign of a bug?\n                return node ? node.y + node.height : undefined;\n              }),\n              result = {\n                'minY': _.min(tops) - reorderMargin - node.height,\n                'maxY': _.max(bottoms) + reorderMargin,\n                'margin': reorderMargin\n              };\n            result.edge = side;\n            if (side === 'left') {\n              result.x = parentNode.x + parentNode.width + reorderMargin;\n            } else {\n              result.x = parentNode.x - reorderMargin;\n            }\n            return result;\n          },\n          parentBoundary = function (side) {\n            const result = {\n              'minY': parentNode.y - reorderMargin - node.height,\n              'maxY': parentNode.y + parentNode.height + reorderMargin,\n              'margin': reorderMargin\n            };\n            result.edge = side;\n            if (side === 'left') {\n              result.x = parentNode.x + parentNode.width + reorderMargin;\n            } else {\n              result.x = parentNode.x - reorderMargin;\n            }\n\n            return result;\n          },\n          sameSide = _.map(idea.sameSideSiblingIds(nodeId), function (id) {\n            return layoutModel.getNode(id);\n          }),\n          otherSideSiblings = function () {\n            let otherSide = _.map(parentIdea.ideas, function (subIdea) {\n              return layoutModel.getNode(subIdea.id);\n            });\n            otherSide = _.without(otherSide, node);\n            if (!_.isEmpty(sameSide)) {\n              otherSide = _.difference(otherSide, sameSide);\n            }\n            return otherSide;\n          };\n\n        if (!_.isEmpty(sameSide)) {\n          boundaries.push(siblingBoundary(sameSide, primaryEdge));\n        }\n        boundaries.push(parentBoundary(primaryEdge));\n        if (node.level === 2) {\n          opposite = otherSideSiblings();\n          if (!_.isEmpty(opposite)) {\n            boundaries.push(siblingBoundary(opposite, secondaryEdge));\n          }\n          boundaries.push(parentBoundary(secondaryEdge));\n        }\n        return boundaries;\n      };\n    if (node.level === 1) {\n      return false;\n    }\n    return nonRootStandardReorderBoundary(nodeId);\n  };\n\n  self.getTopDownReorderBoundary = function (nodeId) {\n    const node = layoutModel.getNode(nodeId),\n      parentNode = idea.findParent(nodeId),\n      tolerance = 10;\n    let minX = Infinity, maxX = -Infinity, maxY = -Infinity,\n      hasSiblings = false;\n    if (!parentNode) {\n      return [];\n    }\n    _.each(parentNode.ideas, function (subIdea) {\n      const siblingNode = layoutModel.getNode(subIdea.id);\n\n      if (siblingNode && subIdea.id !== nodeId) {\n        hasSiblings = true;\n        minX = Math.min(siblingNode.x, minX);\n        maxX = Math.max(siblingNode.x + siblingNode.width, maxX);\n        maxY = Math.max(siblingNode.y + siblingNode.height, maxY);\n      }\n    });\n    if (!hasSiblings) {\n      return [];\n    }\n    return ([{\n      minY: node.y - node.height - tolerance,\n      maxY: maxY + tolerance,\n      minX: minX - node.width - tolerance,\n      maxX: maxX + tolerance,\n      edge: 'top'\n    }]);\n  };\n  self.getReorderBoundary = function (nodeId) {\n\n    if (layoutModel.getOrientation() === 'standard') {\n      return self.getStandardReorderBoundary(nodeId);\n    } else {\n      return self.getTopDownReorderBoundary(nodeId);\n    }\n  };\n  self.focusAndSelect = function (nodeId) {\n    self.selectNode(nodeId);\n    self.dispatchEvent('nodeFocusRequested', nodeId);\n  };\n  self.requestContextMenu = function (eventPointX, eventPointY) {\n    if (isInputEnabled && isEditingEnabled) {\n      self.dispatchEvent('contextMenuRequested', currentlySelectedIdeaId, eventPointX, eventPointY);\n      return true;\n    }\n    return false;\n  };\n  // self.setTheme = function (themeId) {\n  //   if (!isEditingEnabled) {\n  //     return false;\n  //   }\n  //   const themeObj = themeSource && themeSource(themeId);\n  //   autoThemedIdeaUtils.themeChanged(idea, themeObj, themeId);\n  // };\n  self.makeSelectedNodeRoot = function () {\n    const nodeId = self.getSelectedNodeId();\n    if (!nodeId || idea.isRootNode(nodeId)) {\n      return false;\n    }\n    if (isInputEnabled && isEditingEnabled) {\n      return idea.batch(function () {\n        setRootNodePositionsForPrecalculatedLayout(nodeId, layoutModel.getLayout());\n        const result = changeParent(nodeId, 'root');\n        setNodePositionFromCurrentLayout(nodeId);\n        setRootNodePositionsForPrecalculatedLayout(nodeId);\n        return result;\n      });\n    }\n  };\n  self.setNodeWidth = function (source, id, width) {\n    idea.mergeAttrProperty(id, 'style', 'width', width);\n  };\n  self.unsetSelectedNodeWidth = function (source) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('unsetSelectedNodeWidth', source);\n    self.applyToActivated(function (id) {\n      idea.mergeAttrProperty(id, 'style', 'width', false);\n    });\n  };\n  self.unsetSelectedNodePosition = function (source) {\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('unsetSelectedNodePosition', source);\n    self.applyToActivated(self.autoPosition);\n  };\n  self.insertRoot = function (source, initialTitle) {\n    const createNode = function () {\n      if (initialTitle) {\n        return addSubIdea(idea.id, initialTitle);\n      } else {\n        return addSubIdea(idea.id);\n      }\n    };\n    if (!isEditingEnabled) {\n      return false;\n    }\n    analytic('addRootNode', source);\n    if (isInputEnabled) {\n      let newId = false;\n      idea.batch(function () {\n        newId = createNode();\n        positionNextTo(newId, self.getSelectedNodeId());\n        setRootNodePositionsForPrecalculatedLayout(newId);\n      });\n      if (newId) {\n        if (initialTitle) {\n          selectNewIdea(newId);\n        } else {\n          editNewIdea(newId);\n        }\n      }\n    }\n  };\n  self.lineLabelClicked = function (line) {\n    self.dispatchEvent('lineLabelClicked', line);\n  };\n};\n","/*global module*/\n\nmodule.exports = function calcChildPosition(parent, child, tolerance) {\n  'use strict';\n  const childMid = child.top + child.height * 0.5;\n  if (childMid < parent.top - tolerance) {\n    return 'above';\n  }\n  if (childMid > parent.top + parent.height + tolerance) {\n    return 'below';\n  }\n  return 'horizontal';\n};\n","/*global module, require*/\nconst convertToRGB = require('./color-to-rgb');\nmodule.exports = function colorParser(colorObj) {\n  'use strict';\n  if (!colorObj.color || colorObj.opacity === 0) {\n    return 'transparent';\n  }\n  if (colorObj.opacity) {\n    return 'rgba(' + convertToRGB(colorObj.color).join(',') + ',' + colorObj.opacity + ')';\n  } else {\n    return colorObj.color;\n  }\n};\n","/*global module, require*/\nconst _ = require('underscore'),\n  regCSSRGB = new RegExp(/^rgba?\\(([^,\\s]+)[,\\s]*([^,\\s]+)[,\\s]*([^,\\s\\()]+).*$/),\n  fromCSSRGB = function (colorString) {\n    'use strict';\n    let matched;\n    if (regCSSRGB.test(colorString)) {\n\n      matched = colorString.match(regCSSRGB);\n      if (matched.length === 4) {\n        return _.map(matched.slice(1), function (i) {\n          return parseInt(i);\n        });\n      }\n    }\n  },\n  fromHexString = function (colorString) {\n    'use strict';\n    const match = colorString.toString(16).match(/[a-f0-9]{6}/i);\n    let integer, r, g, b;\n    if (match) {\n      integer = parseInt(match[0], 16);\n      r = (integer >> 16) & 0xFF;\n      g = (integer >> 8) & 0xFF;\n      b = integer & 0xFF;\n\n      return [r, g, b];\n    }\n  };\nmodule.exports = function convertToRGB(colorString) {\n  'use strict';\n  return fromCSSRGB(colorString) || fromHexString(colorString) || [0, 0, 0];\n};\n","/*global require, module */\nconst _ = require('underscore'),\n  Theme = require('./theme'),\n  calcChildPosition = require('./calc-child-position'),\n  lineTypes = require('./line-types'),\n  nodeConnectionPointX = require('./node-connection-point-x'),\n  appendUnderLine = function (connectorCurve, calculatedConnector, position) {\n    'use strict';\n    if (calculatedConnector.nodeUnderline) {\n      connectorCurve.d += 'M' + (calculatedConnector.nodeUnderline.from.x - position.left) + ',' + (calculatedConnector.nodeUnderline.from.y - position.top) + ' H' + (calculatedConnector.nodeUnderline.to.x - position.left);\n    }\n    return connectorCurve;\n  },\n  appendOverLine = function (connectorCurve, calculatedConnector) {\n    'use strict';\n    const initialRadius = connectorCurve.initialRadius || 0,\n      halfWidth = calculatedConnector.nodeOverline && (Math.floor(0.5 * Math.abs(calculatedConnector.nodeOverline.to.x - calculatedConnector.nodeOverline.from.x)) - 1);\n\n    if (calculatedConnector.nodeOverline) {\n      connectorCurve.d += 'm' + (-1 * halfWidth) + ',' + initialRadius +\n        'q0,' + (-1 * initialRadius) + ' ' + initialRadius + ',' + (-1 * initialRadius) +\n        ' h' + (2 * (halfWidth - initialRadius)) +\n        'q' + initialRadius + ',0 ' + initialRadius + ',' + initialRadius;\n    }\n    return connectorCurve;\n\n  },\n  appendBorderLines = function (connectorCurve, calculatedConnector, position) {\n    'use strict';\n    return appendOverLine(appendUnderLine(connectorCurve, calculatedConnector, position), calculatedConnector);\n  },\n  nodeConnectionPointY = {\n    'center': function (node) {\n      'use strict';\n      return Math.round(node.top + node.height * 0.5);\n    },\n    'base': function (node) {\n      'use strict';\n      return node.top + node.height + 1;\n    },\n    'base-inset': function (node, inset) {\n      'use strict';\n      return node.top + node.height + 1 - inset;\n    },\n    'top': function (node) {\n      'use strict';\n      return node.top;\n    }\n  },\n\n  calculateConnector = function (parent, child, theme) {\n    'use strict';\n    const childPosition = calcChildPosition(parent, child, 10),\n      fromStyles = parent.styles,\n      toStyles = child.styles,\n      connectionPositionDefaultFrom = theme.attributeValue(['node'], fromStyles, ['connections', 'default'], { h: 'center', v: 'center' }),\n      connectionPositionDefaultTo = theme.attributeValue(['node'], toStyles, ['connections', 'default'], { h: 'nearest-inset', v: 'center' }),\n      connectionPositionFrom = _.extend({}, connectionPositionDefaultFrom, theme.attributeValue(['node'], fromStyles, ['connections', 'from', childPosition], {})),\n      connectionPositionTo = _.extend({}, connectionPositionDefaultTo, theme.attributeValue(['node'], toStyles, ['connections', 'to'], {})),\n      connectorTheme = theme.connectorTheme(childPosition, toStyles, fromStyles),\n      fromInset = theme.attributeValue(['node'], fromStyles, ['cornerRadius'], 10),\n      toInset = theme.attributeValue(['node'], toStyles, ['cornerRadius'], 10),\n      borderType = theme.attributeValue(['node'], toStyles, ['border', 'type'], '');\n    let nodeUnderline = false, nodeOverline = false;\n    if (borderType === 'underline' || borderType === 'under-overline') {\n      nodeUnderline = {\n        from: {\n          x: child.left,\n          y: child.top + child.height + 1\n        },\n        to: {\n          x: child.left + child.width,\n          y: child.top + child.height + 1\n        }\n      };\n    }\n    if (borderType === 'overline' || borderType === 'under-overline') {\n      nodeOverline = {\n        from: {\n          x: child.left,\n          y: child.top\n        },\n        to: {\n          x: child.left + child.width,\n          y: child.top\n        }\n      };\n    }\n\n    return {\n      from: {\n        x: nodeConnectionPointX[connectionPositionFrom.h](parent, child, fromInset),\n        y: nodeConnectionPointY[connectionPositionFrom.v](parent, fromInset)\n      },\n      to: {\n        x: nodeConnectionPointX[connectionPositionTo.h](child, parent, toInset),\n        y: nodeConnectionPointY[connectionPositionTo.v](child, toInset)\n      },\n      connectorTheme: connectorTheme,\n      nodeUnderline: nodeUnderline,\n      nodeOverline: nodeOverline\n    };\n  },\n  themePath = function (parent, child, themeArg) {\n    'use strict';\n    const left = Math.min(parent.left, child.left),\n      top = Math.min(parent.top, child.top),\n      position = {\n        left: left,\n        top: top,\n        width: Math.max(parent.left + parent.width, child.left + child.width, left + 1) - left,\n        height: Math.max(parent.top + parent.height, child.top + child.height, top + 1) - top + 2\n      },\n      theme = themeArg || new Theme({}),\n      calculatedConnector = calculateConnector(parent, child, theme),\n      result = appendBorderLines(lineTypes[calculatedConnector.connectorTheme.type](calculatedConnector, position, parent, child), calculatedConnector, position);\n    result.color = calculatedConnector.connectorTheme.line.color;\n    result.width = calculatedConnector.connectorTheme.line.width;\n    result.theme = calculatedConnector.connectorTheme;\n    return result;\n  };\n\nmodule.exports = themePath;\n","module.exports = {\n  'name': 'MindMup Default',\n  'node': [\n    {\n      'name': 'default',\n      'cornerRadius': 10.0,\n      'backgroundColor': '#E0E0E0',\n      'border': {\n        'type': 'surround',\n        'line': {\n          'color': '#707070',\n          'width': 1.0\n        }\n      },\n      'shadow': [{\n        'color': '#070707',\n        'opacity': 0.4,\n        'offset': {\n          'width': 2,\n          'height': 2\n        },\n        'radius': 2\n      }],\n      'text': {\n        'margin': 5.0,\n        'alignment': 'center',\n        'maxWidth': 146,\n        'color': '#4F4F4F',\n        'lightColor': '#EEEEEE',\n        'darkColor': '#000000',\n        'font': {\n          'lineSpacing': 2.5,\n          'lineSpacingPx': 3.25,\n          'size': 9,\n          'sizePx': 12,\n          'weight': 'bold'\n        }\n      },\n      'connections': {\n        'default': {\n          'h': 'center',\n          'v': 'center'\n        },\n        'from': {\n          'horizontal': {\n            'h': 'nearest-inset',\n            'v': 'center'\n          }\n        },\n        'to': {\n          'h': 'nearest',\n          'v': 'center'\n        }\n      },\n      'decorations': {\n        'height': 20,\n        'edge': 'top',\n        'overlap': true,\n        'position': 'end'\n      }\n    },\n    {\n      'name': 'level_1',\n      'backgroundColor': '#22AAE0'\n    },\n    {\n      'name': 'activated',\n      'border': {\n        'type': 'surround',\n        'line': {\n          'color': '#22AAE0',\n          'width': 3.0,\n          'style': 'dotted'\n        }\n      }\n    },\n    {\n      'name': 'level_1.activated',\n      'border': {\n        'type': 'surround',\n        'line': {\n          'color': '#EEEEEE',\n          'width': 3.0,\n          'style': 'dotted'\n        }\n      }\n    },\n    {\n      'name': 'selected',\n      'shadow': [\n        {\n          'color': '#000000',\n          'opacity': 0.9,\n          'offset': {\n            'width': 2,\n            'height': 2\n          },\n          'radius': 2\n        }\n      ]\n    },\n    {\n      'name': 'collapsed',\n      'shadow': [\n        {\n          'color': '#888888',\n          'offset': {\n            'width': 0,\n            'height': 1\n          },\n          'radius': 0\n        },\n        {\n          'color': '#FFFFFF',\n          'offset': {\n            'width': 0,\n            'height': 3\n          },\n          'radius': 0\n        },\n        {\n          'color': '#888888',\n          'offset': {\n            'width': 0,\n            'height': 4\n          },\n          'radius': 0\n        },\n        {\n          'color': '#FFFFFF',\n          'offset': {\n            'width': 0,\n            'height': 6\n          },\n          'radius': 0\n        },\n        {\n          'color': '#888888',\n          'offset': {\n            'width': 0,\n            'height': 7\n          },\n          'radius': 0\n        }\n      ]\n    },\n    {\n      'name': 'collapsed.selected',\n      'shadow': [\n        {\n          'color': '#FFFFFF',\n          'offset': {\n            'width': 0,\n            'height': 1\n          },\n          'radius': 0\n        },\n        {\n          'color': '#888888',\n          'offset': {\n            'width': 0,\n            'height': 3\n          },\n          'radius': 0\n        },\n        {\n          'color': '#FFFFFF',\n          'offset': {\n            'width': 0,\n            'height': 6\n          },\n          'radius': 0\n        },\n        {\n          'color': '#555555',\n          'offset': {\n            'width': 0,\n            'height': 7\n          },\n          'radius': 0\n        },\n        {\n          'color': '#FFFFFF',\n          'offset': {\n            'width': 0,\n            'height': 10\n          },\n          'radius': 0\n        },\n        {\n          'color': '#333333',\n          'offset': {\n            'width': 0,\n            'height': 11\n          },\n          'radius': 0\n        }\n      ]\n    }\n  ],\n  'connector': {\n    'default': {\n      'type': 'quadratic',\n      'controlPoint': {\n        'above': { 'width': 0, 'height': 0.75 },\n        'below': { 'width': 0, 'height': 0.75 },\n        'horizontal': { 'width': 0, 'height': 0 }\n      },\n      'label': {\n        'position': {\n          'ratio': 0.5\n        },\n        'backgroundColor': 'transparent',\n        'borderColor': 'transparent',\n        'text': {\n          'color': '#4F4F4F',\n          'font': {\n            'size': 9,\n            'sizePx': 12,\n            'weight': 'normal'\n          }\n        }\n      },\n      'line': {\n        'color': '#707070',\n        'width': 1.0\n      }\n    }\n  },\n  'link': {\n    'default': {\n      'line': {\n        'color': 'red',\n        'lineStyle': 'dashed',\n        'width': 1.0\n      },\n      'label': {\n        'position': {\n          'ratio': 0.5\n        },\n        'backgroundColor': '#FFFFFF',\n        'borderColor': '#FFFFFF',\n        'text': {\n          'color': '#4F4F4F',\n          'font': {\n            'size': 9,\n            'sizePx': 12,\n            'weight': 'normal'\n          }\n        }\n      }\n    }\n  }\n};\n","/*global module, require */\nconst convertToRGB = require('./color-to-rgb');\n\nmodule.exports = function foregroundStyle(backgroundColor) {\n  'use strict';\n\n  /*jslint newcap:true*/\n  // var luminosity = Color(backgroundColor).mix(Color('#EEEEEE')).luminosity();\n  const mix = function (color1, color2) {\n      return [\n        Math.round(0.5 * (color1[0] + color2[0])),\n        Math.round(0.5 * (color1[1] + color2[1])),\n        Math.round(0.5 * (color1[2] + color2[2]))\n      ];\n    },\n    calcLuminosity = function () {\n      // http://www.w3.org/TR/WCAG20/#relativeluminancedef\n      const rgb = mix(convertToRGB(backgroundColor), convertToRGB('#EEEEEE')),\n        lum = [];\n      let chan;\n      for (let i = 0; i < rgb.length; i++) {\n        chan = rgb[i] / 255;\n        lum[i] = (chan <= 0.03928) ? chan / 12.92 : Math.pow(((chan + 0.055) / 1.055), 2.4);\n      }\n      return 0.2126 * lum[0] + 0.7152 * lum[1] + 0.0722 * lum[2];\n    },\n    luminosity = calcLuminosity();\n  if (luminosity < 0.5) {\n    return 'lightColor';\n  } else if (luminosity < 0.9) {\n    return 'color';\n  }\n  return 'darkColor';\n};\n","/*global module */\nmodule.exports = {\n  dashed: '8, 8',\n  solid: ''\n};\n","/*global module*/\n\nmodule.exports = {\n  strokes: (name, width) => {\n    'use strict';\n    if (!name || name === 'solid') {\n      return '';\n    }\n    const multipleWidth = Math.max(width || 1, 1) * 4;\n    if (name === 'dashed') {\n      return [multipleWidth, multipleWidth].join(', ');\n    } else {\n      return [1, multipleWidth].join(', ');\n    }\n  },\n  linecap: (name) => {\n    'use strict';\n    if (!name || name === 'solid') {\n      return 'square';\n    }\n    if (name === 'dotted') {\n      return 'round';\n    }\n    return '';\n  }\n\n};\n","/*global module*/\n\nconst straight = function (calculatedConnector, position) {\n  'use strict';\n  return {\n    'd': 'M' + Math.round(calculatedConnector.from.x - position.left) + ',' + Math.round(calculatedConnector.from.y - position.top) + 'L' + Math.round(calculatedConnector.to.x - position.left) + ',' + Math.round(calculatedConnector.to.y - position.top),\n    'position': position\n  };\n};\n\nmodule.exports = {\n  'quadratic': function (calculatedConnector, position, parent, child) {\n    'use strict';\n    const maxOffset = Math.min(child.height, parent.height) * 1.2,\n      requestedOffset = calculatedConnector.connectorTheme.controlPoint.height * (calculatedConnector.from.y - calculatedConnector.to.y),\n      offset = Math.max(-maxOffset, Math.min(maxOffset, requestedOffset));\n\n    if (Math.round(calculatedConnector.from.y) === Math.round(calculatedConnector.to.y - offset)) {\n      return straight(calculatedConnector, position);\n    }\n    return {\n      'd': 'M' + Math.round(calculatedConnector.from.x - position.left) + ',' + Math.round(calculatedConnector.from.y - position.top) +\n        'Q' + Math.round(calculatedConnector.from.x - position.left) + ',' + Math.round(calculatedConnector.to.y - offset - position.top) + ' ' + Math.round(calculatedConnector.to.x - position.left) + ',' + Math.round(calculatedConnector.to.y - position.top),\n      'position': position\n    };\n  },\n  's-curve': function (calculatedConnector, position) {\n    'use strict';\n    const initialRadius = 10,\n      dx = Math.round(calculatedConnector.to.x - calculatedConnector.from.x),\n      dy = Math.round(calculatedConnector.to.y - calculatedConnector.from.y),\n      dxIncrement = (initialRadius < Math.abs(dx * 0.5)) ? initialRadius * Math.sign(dx) : Math.round(dx * 0.5),\n      dyIncrement = (initialRadius < Math.abs(dy * 0.5)) ? initialRadius * Math.sign(dy) : Math.round(dy * 0.5);\n\n    return {\n      'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n        'q' + dxIncrement + ',0 ' + dxIncrement + ',' + dyIncrement +\n        'c0,' + (dy - (2 * dyIncrement)) + ' ' + Math.round(dx / 2 - dxIncrement) + ',' + (dy - dyIncrement) + ' ' + (dx - dxIncrement) + ',' + (dy - dyIncrement),\n      'position': position\n    };\n\n  },\n  'top-down-s-curve': function (calculatedConnector, position) {\n    'use strict';\n    const dx = Math.round(calculatedConnector.to.x - calculatedConnector.from.x),\n      dy = Math.round(calculatedConnector.to.y - calculatedConnector.from.y),\n      initialRadius = 15,\n      dxIncrement = initialRadius * Math.sign(dx),\n      dyIncrement = initialRadius * Math.sign(dy),\n      verticalLine = Math.round(0.5 * dy) - dyIncrement,\n      flatLine = function () {\n        const yIncrement = verticalLine + Math.round(0.5 * dyIncrement);\n        return {\n          'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n            'v' + yIncrement +\n            'l' + dx + ',' + (dy - yIncrement),\n          'position': position,\n          'initialRadius': 5\n        };\n      };\n    if (initialRadius > Math.abs(dx / 2)) {\n      return flatLine();\n    }\n\n    return {\n      'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n        'v' + verticalLine +\n        'q0,' + dyIncrement + ' ' + dxIncrement + ',' + dyIncrement +\n        'h' + (dx - (2 * dxIncrement)) +\n        'q' + dxIncrement + ',0 ' + dxIncrement + ',' + dyIncrement +\n        'v' + verticalLine,\n      'position': position,\n      'initialRadius': 5\n    };\n\n  },\n  'compact-s-curve': function (calculatedConnector, position) {\n    'use strict';\n    const initialRadius = 10,\n      dx = Math.round(calculatedConnector.to.x - calculatedConnector.from.x),\n      dy = Math.round(calculatedConnector.to.y - calculatedConnector.from.y),\n      dxIncrement = initialRadius * Math.sign(dx),\n      dyIncrement = initialRadius * Math.sign(dy),\n      flatLine = function () {\n        const xIncrement = Math.round(dx / 2);\n        return {\n          'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n            'l' + xIncrement + ',0 ' +\n            'l' + (dx - xIncrement) + ',' + dy,\n          'position': position\n        };\n      };\n\n    if (initialRadius > Math.abs(dx * 0.5) || initialRadius > Math.abs(dy * 0.5)) {\n      return flatLine();\n    }\n    return {\n      'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n        'q' + dxIncrement + ',0 ' + dxIncrement + ',' + dyIncrement +\n        'v' + (dy - (2 * dyIncrement)) +\n        'q0,' + dyIncrement + ' ' + dxIncrement + ',' + dyIncrement +\n        'h' + (dx - (2 * dxIncrement)),\n      'position': position\n    };\n\n  },\n  'vertical-quadratic-s-curve': function (calculatedConnector, position) {\n    'use strict';\n    const dx = Math.round(calculatedConnector.to.x - calculatedConnector.from.x),\n      dy = Math.round(calculatedConnector.to.y - calculatedConnector.from.y),\n      dxIncrement = dx / 2,\n      dyIncrement = dy / 2;\n\n    if (Math.abs(dx) < 20) {\n\n      return {\n        'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n          'l' + dx + ',' + dy,\n        initialRadius: 10,\n        'position': position\n      };\n    }\n    return {\n      'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n        'q0,' + Math.round(dyIncrement / 2) + ' ' + dxIncrement + ',' + dyIncrement +\n        'q' + dxIncrement + ',' + Math.round(dyIncrement / 2) + ' ' + dxIncrement + ',' + dyIncrement,\n      initialRadius: 10,\n      'position': position\n    };\n  },\n  'vertical-s-curve': function (calculatedConnector, position) {\n    'use strict';\n    const initialRadius = 10,\n      dx = Math.round(calculatedConnector.to.x - calculatedConnector.from.x),\n      dy = Math.round(calculatedConnector.to.y - calculatedConnector.from.y),\n      dxIncrement = initialRadius * Math.sign(dx),\n      dyIncrement = initialRadius * Math.sign(dy);\n\n    if (initialRadius > Math.abs(dx * 0.5) || initialRadius > Math.abs(dy * 0.5)) {\n      return {\n        'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n          'l' + dx + ',' + dy,\n        'position': position\n      };\n    }\n    return {\n      'd': 'M' + (calculatedConnector.from.x - position.left) + ',' + (calculatedConnector.from.y - position.top) +\n        'q0,' + dyIncrement + ' ' + dxIncrement + ',' + dyIncrement +\n        'h' + (dx - (2 * dxIncrement)) +\n        'q' + dxIncrement + ',0 ' + dxIncrement + ',' + dyIncrement +\n        'v' + (dy - (2 * dyIncrement)),\n      'position': position\n    };\n\n  },\n  'straight': straight,\n  'no-connector': function (calculatedConnector, position) {\n    'use strict';\n    return {\n      'd': 'M' + Math.round(calculatedConnector.to.x - position.left) + ',' + Math.round(calculatedConnector.to.y - position.top),\n      'position': position\n    };\n  }\n\n};\n","/*global require, module */\nconst Theme = require ('./theme'),\n  arrowPath = function (lineFrom, lineTo, offset) {\n    'use strict';\n    const n = Math.tan(Math.PI / 9),\n      dx = lineTo.x - lineFrom.x,\n      dy = lineTo.y - lineFrom.y;\n\n    let len = 14, iy, a1x, a2x, a1y, a2y, m;\n\n    if (dx === 0) {\n      iy = dy < 0 ? -1 : 1;\n      a1x = lineTo.x + len * Math.sin(n) * iy;\n      a2x = lineTo.x - len * Math.sin(n) * iy;\n      a1y = lineTo.y - len * Math.cos(n) * iy;\n      a2y = lineTo.y - len * Math.cos(n) * iy;\n    } else {\n      m = dy / dx;\n      if (lineFrom.x < lineTo.x) {\n        len = -len;\n      }\n      a1x = lineTo.x + (1 - m * n) * len / Math.sqrt((1 + m * m) * (1 + n * n));\n      a1y = lineTo.y + (m + n) * len / Math.sqrt((1 + m * m) * (1 + n * n));\n      a2x = lineTo.x + (1 + m * n) * len / Math.sqrt((1 + m * m) * (1 + n * n));\n      a2y = lineTo.y + (m - n) * len / Math.sqrt((1 + m * m) * (1 + n * n));\n    }\n    return 'M' + Math.round(a1x - offset.left) + ',' + Math.round(a1y - offset.top) +\n      'L' + Math.round(lineTo.x - offset.left) + ',' + Math.round(lineTo.y - offset.top) +\n      'L' + Math.round(a2x - offset.left) + ',' + Math.round(a2y - offset.top) +\n      'Z';\n  },\n  lineStyles = require('./line-styles'),\n  linkPath = function (parent, child, linkAttrArg, themeArg) {\n    'use strict';\n    const calculateConnector = function (parent, child) {\n        const parentPoints =\n        [\n          {\n            x: parent.left + Math.round(0.5 * parent.width),\n            y: parent.top\n          },\n          {\n            x: parent.left + parent.width,\n            y: parent.top + Math.round(0.5 * parent.height)\n          },\n          {\n            x: parent.left + Math.round(0.5 * parent.width),\n            y: parent.top + parent.height\n          },\n          {\n            x: parent.left,\n            y: parent.top + Math.round(0.5 * parent.height)\n          }\n        ],\n          childPoints =\n          [\n            {\n              x: child.left + Math.round(0.5 * child.width),\n              y: child.top\n            },\n            {\n              x: child.left + child.width,\n              y: child.top + Math.round(0.5 * child.height)\n            },\n            {\n              x: child.left + Math.round(0.5 * child.width),\n              y: child.top + child.height\n            },\n            {\n              x: child.left,\n              y: child.top + Math.round(0.5 * child.height)\n            }\n          ];\n        let i, j, min = Infinity, bestParent, bestChild, dx, dy, current;\n        for (i = 0; i < parentPoints.length; i += 1) {\n          for (j = 0; j < childPoints.length; j += 1) {\n            dx = parentPoints[i].x - childPoints[j].x;\n            dy = parentPoints[i].y - childPoints[j].y;\n            current = dx * dx + dy * dy;\n            if (current < min) {\n              bestParent = i;\n              bestChild = j;\n              min = current;\n            }\n          }\n        }\n        return {\n          from: parentPoints[bestParent],\n          to: childPoints[bestChild]\n        };\n      },\n      conn = calculateConnector(parent, child),\n      theme = themeArg || new Theme({}),\n      linkAttr = linkAttrArg || {},\n      left = Math.min(parent.left, child.left),\n      top = Math.min(parent.top, child.top),\n      position = {\n        left: left,\n        top: top,\n        width: Math.max(parent.left + parent.width, child.left + child.width, left) - left,\n        height: Math.max(parent.top + parent.height, child.top + child.height, top) - top\n      },\n      arrowPaths = function (arrowAttr) {\n        //arrowAttr = true, to, from, both\n        if (!arrowAttr) {\n          return false;\n        }\n        const paths = [];\n        if (arrowAttr !== 'from') {\n          paths.push(arrowPath(conn.from, conn.to, position));\n        }\n        if (arrowAttr === 'from' || arrowAttr === 'both') {\n          paths.push(arrowPath(conn.to, conn.from, position));\n        }\n        return paths;\n      },\n      linkTheme = theme.linkTheme(linkAttr.type),\n      width = linkAttr.width || linkTheme.line.width,\n      lineStyle = linkAttr.lineStyle || linkTheme.line.lineStyle,\n      lineProps = {\n        color: linkAttr.color || linkTheme.line.color,\n        strokes: lineStyles.strokes(lineStyle, width),\n        linecap: lineStyles.linecap(lineStyle, width),\n        width: width\n      };\n\n\n    return {\n      d: 'M' + Math.round(conn.from.x - position.left) + ',' + Math.round(conn.from.y - position.top) + 'L' + Math.round(conn.to.x - position.left) + ',' + Math.round(conn.to.y - position.top),\n      position: position,\n      arrows: (linkAttr.arrow && linkAttr.arrow !== 'false') && arrowPaths(linkAttr.arrow),\n      theme: linkTheme,\n      lineProps: lineProps,\n      label: linkAttr.label\n    };\n  };\n\nmodule.exports = linkPath;\n","/*global module*/\nconst nearestInset = function (node, relatedNode, inset) {\n  'use strict';\n  if (node.left + node.width < relatedNode.left) {\n    return node.left + node.width - inset;\n  }\n  return node.left + inset;\n};\n\nmodule.exports = {\n  'center': function (node) {\n    'use strict';\n    return Math.round(node.left + node.width * 0.5);\n  },\n  'center-separated': function (node, relatedNode, horizontalInset, verticalInsetRatio) {\n    'use strict';\n    const insetY = node.height * (verticalInsetRatio || 0.2),\n      insetX = horizontalInset || 10,\n      halfWidth = node.width / 2,\n      nodeMidX = node.left + halfWidth,\n      relatedNodeMidX = relatedNode.left + (relatedNode.width / 2),\n      relatedNodeRight = (relatedNode.left + relatedNode.width),\n      dy = relatedNode.top - node.top + node.height - insetY,\n      calcDx = function () {\n        if (relatedNode.left > node.left + node.width) {\n          return relatedNode.left - nodeMidX;\n        } else if (relatedNodeRight < node.left) {\n          return relatedNodeRight - nodeMidX;\n        } else if (relatedNode.left < nodeMidX) {\n          return relatedNodeMidX - nodeMidX;\n        } else {\n          return relatedNodeMidX - nodeMidX;\n        }\n      },\n      dx = calcDx(),\n      requestedOffset = (dx / Math.abs(dy)) * insetY,\n      cappedOffset = Math.max(requestedOffset, (halfWidth * -1) + insetX),\n      offsetX = Math.min(cappedOffset, halfWidth - insetX);\n    return Math.round(node.left + (node.width * 0.5) + offsetX);\n  },\n  'nearest': function (node, relatedNode) {\n    'use strict';\n    return nearestInset(node, relatedNode, 0);\n  },\n  'nearest-inset': nearestInset\n};\n","/*global module, require*/\nconst deepAssign = require('../deep-assign'),\n  colorParser = require('./color-parser'),\n  isObjectObject = require('../is-object-object'),\n  themeFallbackValues = require('./theme-fallback-values'),\n  attributeForPath = function (object, pathArray, fallback) {\n    'use strict';\n    if (!object || !pathArray || !pathArray.length) {\n      return (object === undefined && fallback) || object;\n    }\n    if (pathArray.length === 1) {\n      return (object[pathArray[0]] === undefined && fallback) || object[pathArray[0]];\n    }\n    let remaining = pathArray.slice(0),\n      current = object;\n\n    while (remaining.length > 0) {\n      current = current[remaining[0]];\n      if (current === undefined) {\n        return fallback;\n      }\n      remaining = remaining.slice(1);\n    }\n    return current;\n  },\n  themeAttributeValue = (themeDictionary, prefixes, styles, postfixes, fallback) => {\n    'use strict';\n    const rootElement = attributeForPath(themeDictionary, prefixes);\n    let toAssign = [{}];\n    if (!rootElement) {\n      return fallback;\n    }\n    if (styles && styles.length) {\n      toAssign = toAssign.concat(styles.slice(0).reverse().map(style => rootElement[style]).filter(item => !!item));\n    } else if (isObjectObject(rootElement)) {\n      toAssign.push(rootElement);\n    } else if (!postfixes || !postfixes.length) {\n      return rootElement;\n    } else {\n      return fallback;\n    }\n    return attributeForPath(deepAssign.apply(deepAssign, toAssign), postfixes, fallback);\n  },\n  nodeAttributeToNodeTheme = (nodeAttribute) => {\n    'use strict';\n    const getBackgroundColor = function () {\n        const colorObj = attributeForPath(nodeAttribute, ['background']);\n        if (colorObj) {\n          return colorParser(colorObj);\n        }\n        return attributeForPath(nodeAttribute, ['backgroundColor']);\n      },\n      result = deepAssign({}, themeFallbackValues.nodeTheme);\n    if (nodeAttribute) {\n      result.margin = attributeForPath(nodeAttribute, ['text', 'margin'], result.margin);\n      result.font = deepAssign({}, result.font, attributeForPath(nodeAttribute, ['text', 'font'], result.font));\n      result.text = deepAssign({}, result.text, attributeForPath(nodeAttribute, ['text'], result.text));\n      result.borderType = attributeForPath(nodeAttribute, ['border', 'type'], result.borderType);\n      result.backgroundColor = getBackgroundColor() || result.backgroundColor;\n      result.cornerRadius = attributeForPath(nodeAttribute, ['cornerRadius'], result.cornerRadius);\n      result.lineColor = attributeForPath(nodeAttribute, ['border', 'line', 'color'], result.lineColor);\n      result.lineWidth = attributeForPath(nodeAttribute, ['border', 'line', 'width'], result.lineWidth);\n      result.lineStyle = attributeForPath(nodeAttribute, ['border', 'line', 'style'], result.lineStyle);\n    }\n    return result;\n\n  },\n  connectorControlPoint = (themeDictionary, childPosition, connectorStyle) => {\n    'use strict';\n    const controlPointOffset = childPosition === 'horizontal' ? themeFallbackValues.connectorControlPoint.horizontal : themeFallbackValues.connectorControlPoint.default,\n      defaultControlPoint = { 'width': 0, 'height': controlPointOffset },\n      configuredControlPoint = connectorStyle && attributeForPath(themeDictionary, ['connector', connectorStyle, 'controlPoint', childPosition]);\n\n    return (configuredControlPoint && Object.assign({}, configuredControlPoint)) || defaultControlPoint;\n  };\n\nmodule.exports = {\n  attributeForPath: attributeForPath,\n  themeAttributeValue: themeAttributeValue,\n  nodeAttributeToNodeTheme: nodeAttributeToNodeTheme,\n  connectorControlPoint: connectorControlPoint\n};\n","/*global module, require*/\nconst defaultTheme = require('./default-theme'),\n  deepFreeze = require('../util/deep-freeze'),\n  firstNode = defaultTheme.node[0],\n  defaultConnector = defaultTheme.connector.default;\n\nmodule.exports = deepFreeze({\n  nodeTheme: {\n    margin: firstNode.text.margin,\n    font: firstNode.text.font,\n    maxWidth: firstNode.text.maxWidth,\n    backgroundColor: firstNode.backgroundColor,\n    borderType: firstNode.border.type,\n    cornerRadius: firstNode.cornerRadius,\n    lineColor: firstNode.border.line.color,\n    lineWidth: firstNode.border.line.width,\n    lineStyle: firstNode.border.line.style,\n    text: {\n      color: firstNode.text.color,\n      lightColor: firstNode.text.lightColor,\n      darkColor: firstNode.text.darkColor\n    }\n  },\n  connectorControlPoint: {\n    horizontal: defaultConnector.controlPoint.horizontal.height,\n    default: defaultConnector.controlPoint.above.height\n  },\n  connectorTheme: {\n    type: defaultConnector.type,\n    label: defaultConnector.label,\n    line: defaultConnector.line\n  }\n});\n","/*global module, require*/\nconst _ = require('underscore'),\n  colorParser = require('./color-parser');\nmodule.exports = function ThemeProcessor() {\n  'use strict';\n  const self = this,\n    addPx = function (val) {\n      return val + 'px';\n    },\n    cssProp = {\n      cornerRadius: 'border-radius',\n      'text.color': 'color',\n      'text.margin': 'padding',\n      background: 'background-color',\n      backgroundColor: 'background-color',\n      border: 'border',\n      shadow: 'box-shadow',\n      'text.font': 'font',\n      'text.alignment': 'text-align'\n    },\n    fontWeightParser = function (fontObj) {\n      const weightMap = {\n        'light': '200',\n        'semi-bold': '600'\n      };\n      if (!fontObj || !fontObj.weight) {\n        return 'bold';\n      }\n      return weightMap[fontObj.weight] || fontObj.weight;\n    },\n    fontSizeParser = function (fontObj) {\n      const fontSize = (fontObj && fontObj.size) || 12,\n        lineSpacing = (fontObj && fontObj.lineSpacing) || 3,\n        lineHeight = (fontSize + lineSpacing) / fontSize;\n\n      return fontSize + 'pt/' + lineHeight.toFixed(2);\n    },\n    parsers = {\n      cornerRadius: addPx,\n      'text.margin': addPx,\n      background: colorParser,\n      border: function (borderOb) {\n        if (!borderOb.line) {\n          return '0';\n        }\n        return borderOb.line.width + 'px ' + (borderOb.line.style || 'solid') + ' ' + borderOb.line.color + ';margin:' + (-1 * borderOb.line.width) + 'px';\n      },\n      shadow: function (shadowArray) {\n        const boxshadows = [];\n        if (shadowArray.length === 1 && shadowArray[0].color === 'transparent') {\n          return 'none';\n        }\n        shadowArray.forEach(function (shadow) {\n          boxshadows.push(shadow.offset.width + 'px ' + shadow.offset.height + 'px ' + shadow.radius + 'px ' + colorParser(shadow));\n        });\n        return boxshadows.join(',');\n      },\n      'text.font': function (fontObj) {\n        return 'normal normal ' + fontWeightParser(fontObj) + ' ' + fontSizeParser(fontObj) + ' NotoSans, \"Helvetica Neue\", Roboto, Helvetica, Arial, sans-serif';\n      }\n    },\n    processNodeStyles = function (nodeStyleArray) {\n      let parser, cssVal;\n      const result = [],\n        pushProperties = function (styleObject, keyPrefix) {\n          _.each(styleObject, function (val, propKey) {\n            const key = (keyPrefix || '') + propKey;\n            if (cssProp[key]) {\n              parser = parsers[key] || _.identity;\n              cssVal = parser(val);\n              if (cssVal) {\n                result.push(cssProp[key]);\n                result.push(':');\n                result.push(cssVal);\n                result.push(';');\n              }\n            } else if (_.isObject(val)) {\n              pushProperties(val, key + '.');\n            }\n          });\n        },\n        appendSpanStyles = function (styleSelector, nodeStyle) {\n          const maxWidth = nodeStyle.text && nodeStyle.text.maxWidth;\n          if (!maxWidth) {\n            return;\n          }\n          result.push(styleSelector);\n          result.push(' span {');\n          result.push('max-width:');\n          result.push(maxWidth);\n          result.push('px;}');\n        },\n        appendDecorationStyles = function (styleSelector, nodeStyle) {\n          const style = nodeStyle.decorations,\n            margin = nodeStyle.text && nodeStyle.text.margin || 0,\n            fontSize = (nodeStyle && nodeStyle.text && nodeStyle.text.font && nodeStyle.text.font.size) || 9;\n          if (!style) {\n            return;\n          }\n          result.push(styleSelector);\n          result.push(' .mapjs-decorations{position:absolute;');\n          result.push(`font-size:${fontSize}pt;`);\n          if (style.edge === 'top' || style.edge === 'bottom') {\n            if (style.position === 'end') {\n              result.push('right:0;');\n            } else if (style.position === 'start') {\n              result.push('left:0;');\n            } else {\n              result.push('left:0;width:100%;text-align:center;');\n            }\n            result.push(style.edge);\n            result.push(':-');\n            result.push(style.overlap ? Math.round(style.height / 2) + margin : style.height);\n            result.push('px;');\n          } else if (style.edge === 'left' || style.edge === 'right') {\n            result.push(style.edge === 'left' ? 'right' : 'left');\n            result.push(':100%;');\n            if (style.position === 'end') {\n              result.push('bottom:0;');\n            } else if (style.position === 'start') {\n              result.push('top:0;');\n            } else {\n              result.push('top:calc(50% - ');\n              result.push(Math.round(style.height / 2));\n              result.push('px);');\n            }\n          }\n          result.push('}');\n        };\n      nodeStyleArray.forEach(function (nodeStyle) {\n        let styleSelector = '.mapjs-node';\n        if (nodeStyle.name !== 'default') {\n          styleSelector = styleSelector + '.' + nodeStyle.name.replace(/\\s/g, '_');\n        }\n        result.push(styleSelector);\n        result.push('{');\n        pushProperties(nodeStyle);\n        result.push('}');\n\n        appendDecorationStyles(styleSelector, nodeStyle);\n        appendSpanStyles(styleSelector, nodeStyle);\n      });\n      return result;\n    },\n    processThemeStyles = (theme) => {\n      if (theme.noAnimations) {\n        return [];\n      }\n      return ['body:not(.noTransition) .mapjs-node:not(.noTransition):not(.dragging), body:not(.noTransition) [data-mapjs-role=\"svg-container\"] :not(.noTransition), body:not(.noTransition) [data-mapjs-role=\"svg-container\"] :not(.noTransition) :not(.noTransition) { transition-property: transform, left, d, top, opacity; transition-duration: 400ms;}'];\n    };\n  self.process = function (theme) {\n    let nodeStyles = '';\n    if (theme.node) {\n      nodeStyles = processThemeStyles(theme).concat(processNodeStyles(theme.node)).join('');\n    }\n    return {\n      css: nodeStyles\n    };\n  };\n  self.cssFont = parsers['text.font'];\n};\n","/*global module*/\n\nmodule.exports = function themeToDictionary(themeJson) {\n  'use strict';\n  const themeDictionary = Object.assign({}, themeJson),\n    nodeArray = themeDictionary.node;\n  if (themeDictionary && Array.isArray(themeDictionary.node)) {\n    themeDictionary.node = {};\n    nodeArray.forEach(function (nodeStyle) {\n      themeDictionary.node[nodeStyle.name] = nodeStyle;\n    });\n  }\n  return themeDictionary;\n};\n","/*global module, require */\nconst AUTO_COLOR = 'theme-auto-color',\n  themeFallbackValues = require('./theme-fallback-values'),\n  themeToDictionary = require('./theme-to-dictionary'),\n  themeAttributeUtils = require('./theme-attribute-utils'),\n  defaultTheme = require('./default-theme');\nmodule.exports = function Theme(themeJson) {\n  'use strict';\n\n  const self = this,\n    themeDictionary = themeToDictionary(themeJson),\n    attributeValue = (prefixes, styles, postfixes, fallback) => themeAttributeUtils.themeAttributeValue(themeDictionary, prefixes, styles, postfixes, fallback);\n\n  self.getFontForStyles = function (themeStyles) {\n    const weight = attributeValue(['node'], themeStyles, ['text', 'font', 'weight'], 'semibold'),\n      size = attributeValue(['node'], themeStyles, ['text', 'font', 'size'], themeFallbackValues.nodeTheme.font.size),\n      lineSpacing = attributeValue(['node'], themeStyles, ['text', 'font', 'lineSpacing'], themeFallbackValues.nodeTheme.font.lineSpacing);\n    return { size: size, weight: weight, lineGap: lineSpacing };\n  };\n  self.getNodeMargin = function (themeStyles) {\n    return attributeValue(['node'], themeStyles, ['text', 'margin'], themeFallbackValues.nodeTheme.margin);\n  };\n  self.name = themeJson && themeJson.name;\n  self.connectorEditingContext = themeJson && themeJson.connectorEditingContext;\n  // TODO: Remove blockParentConnectorOverride once site has been live for a while\n  self.blockParentConnectorOverride = themeJson && themeJson.blockParentConnectorOverride;\n\n  self.attributeValue = (prefixes, styles, postfixes, fallback) => attributeValue(prefixes, styles, postfixes, fallback);\n\n  self.nodeStyles = function (nodeLevel, nodeAttr) {\n    const result = ['level_' + nodeLevel, 'default'];\n    if (nodeAttr && nodeAttr.group) {\n      result.unshift('attr_group');\n      if (typeof nodeAttr.group === 'string' || typeof nodeAttr.group === 'number') {\n        result.unshift('attr_group_' + nodeAttr.group);\n      }\n    }\n    if (nodeAttr && nodeAttr.styleNames && Array.isArray(nodeAttr.styleNames)) {\n      return nodeAttr.styleNames.concat(result);\n    }\n    return result;\n  };\n  self.nodeTheme = function (styles) {\n    const nodeAttribute = attributeValue(['node'], styles);\n    return themeAttributeUtils.nodeAttributeToNodeTheme(nodeAttribute);\n  };\n\n  self.connectorTheme = function (childPosition, childStyles, parentStyles) {\n    const position = childPosition || 'horizontal',\n      childConnectorStyle = attributeValue(['node'], childStyles, ['connections', 'style'], 'default'),\n      parentConnectorStyle = parentStyles && attributeValue(['node'], parentStyles, ['connections', 'childstyle'], false),\n      childConnector = themeAttributeUtils.attributeForPath(themeDictionary, ['connector', childConnectorStyle]),\n      parentConnector = parentConnectorStyle && themeAttributeUtils.attributeForPath(themeDictionary, ['connector', parentConnectorStyle]),\n      combinedStyle = parentConnectorStyle && (parentConnectorStyle + '.' + childConnectorStyle),\n      combinedConnector = combinedStyle && themeAttributeUtils.attributeForPath(themeDictionary, ['connector', combinedStyle]),\n      connectorStyle = (combinedConnector && combinedStyle) || (parentConnector && parentConnectorStyle) || childConnectorStyle || 'default',\n      controlPoint = themeAttributeUtils.connectorControlPoint(themeDictionary, position, connectorStyle),\n      connectorDefaults = Object.assign({}, themeFallbackValues.connectorTheme),\n      returnedConnector = Object.assign({}, combinedConnector || parentConnector || childConnector || connectorDefaults);\n    if (!returnedConnector.label) {\n      returnedConnector.label = connectorDefaults.label;\n    }\n    returnedConnector.controlPoint = controlPoint;\n    returnedConnector.line = returnedConnector.line || connectorDefaults.line;\n    return returnedConnector;\n  };\n  self.linkTheme = function (linkStyle) {\n    const fromCurrentTheme = themeAttributeUtils.attributeForPath(themeDictionary, ['link', linkStyle || 'default']),\n      fromDefaultTheme = defaultTheme.link.default;\n    return Object.assign({}, fromDefaultTheme, fromCurrentTheme);\n  };\n\n  self.noAnimations = () => !!(themeDictionary.noAnimations);\n  self.getLayoutConnectorAttributes = (styles) => {\n    const childConnectorStyle = attributeValue(['node'], styles, ['connections', 'style'], 'default'),\n      connectorDefaults = Object.assign({}, themeFallbackValues.connectorTheme),\n      childConnector = themeAttributeUtils.attributeForPath(themeDictionary, ['connector', childConnectorStyle]) || connectorDefaults,\n      result = {};\n    if (childConnector && childConnector.line) {\n      result.parentConnector = {\n        color: childConnector.line.color\n      };\n    }\n    return result;\n  };\n\n  self.cleanPersistedAttributes = (currentAttribs) => {\n    if (currentAttribs && currentAttribs.parentConnector && currentAttribs.parentConnector.themeAutoColor) {\n      if (currentAttribs.parentConnector.themeAutoColor === currentAttribs.parentConnector.color) {\n        delete currentAttribs.parentConnector.color;\n      }\n      delete currentAttribs.parentConnector.themeAutoColor;\n      if (!currentAttribs || !currentAttribs.parentConnector || !Object.keys(currentAttribs.parentConnector).length) {\n        delete currentAttribs.parentConnector;\n      }\n    }\n    return currentAttribs;\n  };\n\n  self.getPersistedAttributes = (currentAttribs, nodeLevel, numberOfSiblings) => {\n    const styles = ['level_' + nodeLevel, 'default'],\n      getAutoColor = () => {\n        const autoColors = themeDictionary.autoColors || [defaultTheme.connector.default.line.color],\n          index = (numberOfSiblings % autoColors.length);\n        return autoColors[index];\n      },\n      childConnectorStyle = attributeValue(['node'], styles, ['connections', 'style'], 'default'),\n      connectorDefaults = Object.assign({}, themeFallbackValues.connectorTheme),\n      childConnector = themeAttributeUtils.attributeForPath(themeDictionary, ['connector', childConnectorStyle]) || connectorDefaults,\n      autoColor = getAutoColor(),\n      result = {\n        attr: (currentAttribs && currentAttribs.parentConnector && { parentConnector: currentAttribs.parentConnector }) || {},\n        removed: []\n      };\n\n    if (childConnector && childConnector.line && childConnector.line.color === AUTO_COLOR) {\n      result.attr = Object.assign({\n        parentConnector: {\n          color: autoColor,\n          themeAutoColor: autoColor\n        }\n      }, result.attr);\n    } else if (result.attr.parentConnector && result.attr.parentConnector.themeAutoColor) {\n      result.attr.parentConnector = Object.assign({}, result.attr.parentConnector);\n      if (result.attr.parentConnector.themeAutoColor === result.attr.parentConnector.color) {\n        delete result.attr.parentConnector.color;\n      }\n      delete result.attr.parentConnector.themeAutoColor;\n\n      if (!result || !result.attr || !result.attr.parentConnector || !Object.keys(result.attr.parentConnector).length) {\n        result.removed.push('parentConnector');\n        delete result.attr.parentConnector;\n      }\n    }\n    return result;\n  };\n};\n","/*global module*/\n\nmodule.exports = function calcMaxWidth(attr, nodeTheme/*, options*/) {\n  'use strict';\n  return (attr && attr.style && attr.style.width) || (nodeTheme && nodeTheme.text && nodeTheme.text.maxWidth);\n};\n","/*global module*/\nmodule.exports = function cleanDOMId(s) {\n  'use strict';\n  return s.replace(/[^A-Za-z0-9_-]/g, '_');\n};\n","/*global module, require */\nconst cleanDOMId = require('./clean-dom-id');\nmodule.exports = function connectorKey(connectorObj) {\n  'use strict';\n  return cleanDOMId('connector_' + connectorObj.from + '_' + connectorObj.to);\n};\n\n","/*global module, require */\nconst _ = require('underscore');\nmodule.exports = function convertPositionToTransform(cssPosition) {\n  'use strict';\n  const position = _.omit(cssPosition, 'left', 'top');\n  position.transform = 'translate(' + cssPosition.left + 'px,' + cssPosition.top + 'px)';\n  return position;\n};\n\n","/*global module*/\n\nconst requiresRecursion = (toFreeze, prop) => {\n    'use strict';\n    return (typeof toFreeze[prop] === 'object' || typeof toFreeze[prop] === 'function') && !Object.isFrozen(toFreeze[prop]);\n  },\n  deepFreeze = function (toFreeze) {\n    'use strict';\n    Object.freeze(toFreeze);\n\n    Object.getOwnPropertyNames(toFreeze).forEach((prop) => {\n      if (toFreeze.hasOwnProperty(prop) && toFreeze[prop] !== null && requiresRecursion(toFreeze, prop)) {\n        deepFreeze(toFreeze[prop]);\n      }\n    });\n\n    return toFreeze;\n  };\nmodule.exports = deepFreeze;\n","/*global module, require */\nconst cleanDOMId = require('./clean-dom-id');\nmodule.exports = function linkKey(linkObj) {\n  'use strict';\n  return cleanDOMId('link_' + linkObj.ideaIdFrom + '_' + linkObj.ideaIdTo);\n};\n","/*eslint strict: [\"error\", \"function\"]*/\n/*global module, PATH_FILE_CONFIG_MAPJS, process*/\n// TODO: switch to lodash and test\n\n// function getvar(varname, config_file) {\n//   const { default: CONFIG } = require(path_file_config),\n//     result = CONFIG.varname;\n//   Logger.log(\"Result: \" + result);\n\n//   return result;\n// }\n\n/* eslint-disable strict */\n\nfunction MyLogger(console_original, environment = process.env.NODE_ENV) {\n  const new_logger = Object.create(console_original);\n\n  // Override some console functions based on environment\n  if (environment === 'production') {\n    // Disables console.log and console.debug in production mode.\n    //   QUESTION: change so that it logs the data elsewhere?\n    new_logger.debug = () => { };\n    new_logger.log = () => { };\n  } else {\n    // QUESTION: Add a min level so that the logging level can be easily changed\n    //  See https://www.npmjs.com/package/picolog for ideas\n    new_logger.log = (message, level = 'log') => {\n      console[level](message);\n    };\n  }\n\n  return new_logger;\n}\n/* eslint-enable strict */\n\nconst _ = require('underscore'),\n  // TODO: need to add PATH_FILE_CONFIG_MAPJS_PROCESSED see start.js\n  { default: CONFIG } = require(PATH_FILE_CONFIG_MAPJS),\n  CONTAINER_CLASS = CONFIG.mapjs_map.class,\n\n  // Setting this up here so it's ready for idea_pp\n  //  TODO: If I move idea_pp to MyLogger then I can be more flexible with where I initialise it\n  Logger = new MyLogger(console);\n\nmodule.exports = {\n  // QUESTION: How to move above constructor definition into module.exports object?\n  Logger,\n\n  // Parameterized try catch function\n  //  Simplifies environment based catching\n  //  Allows use of constants with try-catch\n  trycatch: (t, c) => {\n    'use strict';\n    // Set default exception here:\n    c = (exception) => {\n      if (process.env.NODE_ENV === 'production') {\n        Logger.error('Caught: ' + exception);\n      } else {\n        throw exception;\n      }\n    };\n\n    try {\n      return t();\n    } catch (exception) {\n      return c(exception);\n    };\n  },\n\n  // Can pass element or event\n  getContainerID: (elementOrEvent) => {\n    'use strict';\n    const containers = document.getElementsByClassName(CONTAINER_CLASS);\n\n    switch (containers.length) {\n      case 0:\n        return false;\n      case 1:\n        return containers[0].id;\n      default: // If more than 1 container, then see if it's an event with a currentTarget\n        const currentTarget = elementOrEvent.currentTarget;\n        if (currentTarget) { // If elementOrEvent is an event\n          // if current target is container then get id, else set the element to the target.\n          if (currentTarget.class === CONTAINER_CLASS) {\n            return currentTarget.id;\n          } else {\n            elementOrEvent = elementOrEvent.target; // elementOrEvent is now an element;\n          }\n        }\n        // elementOrEvent is an element:\n        return (elementOrEvent.closest) ? elementOrEvent.closest('.' + CONTAINER_CLASS).id : false;\n    }\n    return false; // Should never be called\n  },\n\n  // May not be compatible with all modern browsers\n  downloadToFile: (content, filename, contentType) => {\n    'use strict';\n    const file = new Blob([content], { type: contentType }),\n      download_anchor = document.createElement('a');\n\n    download_anchor.href = URL.createObjectURL(file);\n    download_anchor.download = filename;\n    download_anchor.click();\n\n    URL.revokeObjectURL(download_anchor.href);\n  },\n\n  /* eslint-disable strict */\n\n  // Get element from class and optional parent element\n  // TODO: Rename as getElementsMJS now it can return multiple results\n  getElementMJS: (className, parentElement = document, asCollection = false) => {\n    const elements = parentElement.getElementsByClassName(className),\n      result_count = elements.length;\n    if (result_count > 1) { // multiple elements\n      return elements;\n    } else if (result_count === 1) { // Only 1 element\n      if (asCollection) {\n        return elements;\n      }\n      return elements[0];\n    } else {\n      throw new Error('getElementMJS(): Element of class ' + className + ' not found in ' + parentElement.tagName + '.' + parentElement.classList[0]);\n    }\n  },\n\n  // TODO: Only run all this is logging is enabled.\n  //  QUESTION: What's best way to check?\n  // IDEA: Could add this and ideas_pp() to MyLogger instead. Or possibly override existing console pretty print\n  idea_pp: (idea, level = -1, key = []) => {\n    // Quick fix to avoid wasting time doing this in production mode.\n    //  TODO: Add this to Logging object and set it to {} in production mode.\n    if (process.env.NODE_ENV !== 'production') {\n      if (idea) {\n        const type = idea.attr ? (idea.attr.group ? `${idea.attr.group}` : '') : '',\n          rank = key && key !== '' ? ` ${key}: ` : '';\n        let indent = level > 0 ? '  '.repeat(level) : '';\n        parseInt(key) > 0 ? indent += ' ' : null; // So ranks with minus sign align\n        // TODO FIX: when running as script, _.pick causes an issue if underscore.js not available\n        Logger.debug(`${indent}${rank}`, _.pick(idea, 'id', 'title', 'ideas'), `${type}`);\n        if (idea.ideas) {\n          // eslint-disable-next-line no-use-before-define\n          module.exports.ideas_pp(idea.ideas, level, Object.keys(idea.ideas));\n        }\n      }\n      level -= 1;\n    }\n    return;\n  },\n\n  // Call with ideas_pp(idea);\n  ideas_pp: (ideas, level = -1, keys = []) => {\n    // Want to start with extra line break, but it doesn't appear where I expect.\n    // level == -1 ? Logger.debug('') : null;\n    level += 1;\n    if (!ideas) {\n      level -= 1;\n      return;\n    } else if (ideas.id !== undefined) {\n      module.exports.idea_pp(ideas, level, keys);\n    } else if (ideas.constructor === Array) {\n      ideas.forEach(function (idea, n) {\n        module.exports.idea_pp(idea, level, keys[n]);\n      });\n    } else if (ideas.constructor === Object) {\n      level -= 1;\n      module.exports.ideas_pp(Object.values(ideas), level, Object.keys(ideas));\n    }\n    level -= 1;\n    return;\n  }\n\n  /* eslint-enable strict */\n\n  // Commented out since not needed any longer:\n\n  // Two different ways of combining two theme files, see which one works best\n  // order matters in both merge types, better results from having idea.theme as second argument.\n  //   Assume that value of second used where there is a clash.\n  // const mergeObjects = function (theme1 = themeProvider.default, theme2 = idea.theme, method = \"lodash\") {\n  //   switch (method) {\n\n  //     case \"lodash\":\n  //       const deep_merge = require('lodash/merge');\n  //       var merged_theme = deep_merge(theme1, theme2);\n  //       break;\n\n  //     default:\n  //       // QUESTION: This spread operator (...x) worked before: maybe debugger uses ES6 but webpack doesn't?\n  //       // var merged_theme = { ...theme1, ...theme1 };\n  //       var merged_theme = Object.assign({}, theme1, theme2);\n\n  //   }\n  //   return merged_theme\n  // };\n};\n","/*global module, require*/\nconst cleanDOMId = require('./clean-dom-id');\nmodule.exports = function (id) {\n  'use strict';\n  return cleanDOMId('node_' + id);\n};\n","/*global module*/\nconst getValue = (hashmap, attributeNameComponents) => {\n    'use strict';\n    if (!hashmap || !attributeNameComponents || !attributeNameComponents.length || typeof hashmap !== 'object' || !Array.isArray(attributeNameComponents)) {\n      return false;\n    }\n    const val = hashmap[attributeNameComponents[0]],\n      remaining = attributeNameComponents.slice(1);\n    if (remaining.length) {\n      return getValue(val, remaining);\n    }\n    return val;\n  },\n  setValue = (hashmap, attributeNameComponents, value) => {\n    'use strict';\n    if (!hashmap || !attributeNameComponents || !attributeNameComponents.length || typeof hashmap !== 'object' || !Array.isArray(attributeNameComponents)) {\n      return false;\n    }\n    const remaining = attributeNameComponents.slice(1),\n      currentKey = attributeNameComponents[0];\n\n    if (remaining.length) {\n      if (!hashmap[currentKey]) {\n        if (!value) {\n          return;\n        }\n        hashmap[currentKey] = {};\n      }\n      setValue(hashmap[currentKey], remaining, value);\n      return;\n    }\n    if (!value) {\n      delete hashmap[currentKey];\n    } else {\n      hashmap[currentKey] = value;\n    }\n  },\n  keyComponentsWithValue = (hashmap, searchingFor) => {\n    'use strict';\n    if (typeof searchingFor === 'object' || Array.isArray(searchingFor)) {\n      throw 'search-type-not-supported';\n    }\n    const result = [];\n    if (!hashmap || typeof hashmap !== 'object') {\n      return [];\n    }\n    Object.keys(hashmap).forEach((key) => {\n      const val = hashmap[key];\n      if (val === searchingFor) {\n        result.push([key]);\n      }\n      if (typeof val === 'object') {\n        keyComponentsWithValue(val, searchingFor).forEach((subKey) => {\n          if (!subKey || !subKey.length) {\n            return;\n          }\n          const newComps = [key].concat(subKey);\n          result.push(newComps);\n        });\n      }\n    });\n    return result;\n  };\n\nmodule.exports = {\n  getValue: getValue,\n  setValue: setValue,\n  keyComponentsWithValue: keyComponentsWithValue\n};\n","/*global module, Logger*/\nmodule.exports = function observable(base) {\n  'use strict';\n  let listeners = [];\n  base.addEventListener = function (types, listener, priority) {\n    types.split(' ').forEach(function (type) {\n      if (type) {\n        listeners.push({\n          type: type,\n          listener: listener,\n          priority: priority || 0\n        });\n      }\n    });\n  };\n  base.listeners = function (type) {\n    return listeners.filter(function (listenerDetails) {\n      return listenerDetails.type === type;\n    }).map(function (listenerDetails) {\n      return listenerDetails.listener;\n    });\n  };\n  base.removeEventListener = function (type, listener) {\n    listeners = listeners.filter(function (details) {\n      return details.listener !== listener;\n    });\n  };\n  base.dispatchEvent = function (type) {\n    const args = Array.prototype.slice.call(arguments, 1);\n    listeners\n      .filter(function (listenerDetails) {\n        return listenerDetails.type === type;\n      })\n      .sort(function (firstListenerDetails, secondListenerDetails) {\n        return secondListenerDetails.priority - firstListenerDetails.priority;\n      })\n      .some(function (listenerDetails) {\n        try {\n          return listenerDetails.listener.apply(undefined, args) === false;\n        } catch (e) {\n          Logger.trace('dispatchEvent failed', e, listenerDetails);\n        }\n\n      });\n  };\n  return base;\n};\n","/*global module*/\nconst URLHelper = function () {\n  'use strict';\n  const self = this,\n    urlPattern = /(https?:\\/\\/|www\\.)[\\w-]+(\\.[\\w-]+)+([\\w\\(\\)\\u0080-\\u00FF.,!@?^=%&amp;:\\/~+#-]*[\\w\\(\\)\\u0080-\\u00FF!@?^=%&amp;\\/~+#-])?/i,\n    hrefUrl = function (url) {\n      if (!url) {\n        return '';\n      }\n      if (url[0] === '/') {\n        return url;\n      }\n      if (/^[a-z]+:\\/\\//i.test(url)) {\n        return url;\n      }\n      return 'http://' + url;\n    },\n    getGlobalPattern = function () {\n      return new RegExp(urlPattern, 'gi');\n    };\n\n\n  self.containsLink = function (text) {\n    return urlPattern.test(text);\n  };\n  self.getLink = function (text) {\n    const url = text && text.match(urlPattern);\n    if (url && url[0]) {\n      return hrefUrl(url[0]);\n    }\n    return url;\n  };\n\n  self.stripLink = function (text) {\n    if (!text) {\n      return '';\n    }\n    return text.replace(urlPattern, '').trim();\n  };\n  self.formatLinks = function (text) {\n    if (!text) {\n      return '';\n    }\n    return text.replace(self.getPattern(), url => `<a target=\"_blank\" href=\"${hrefUrl(url)}\">${url}</a>`);\n  };\n  self.getPattern = getGlobalPattern;\n  self.hrefUrl = hrefUrl;\n};\n\nmodule.exports = new URLHelper();\n","/*global module, require*/\nconst themeConnector = require('../core/theme/connector');\nrequire('./get-data-box');\nmodule.exports = function buildConnection(element, optional) {\n  'use strict';\n  const applyInnerRect = (shape, box) => {\n      const innerRect = shape.data().innerRect;\n      if (innerRect) {\n        box.left += innerRect.dx;\n        box.top += innerRect.dy;\n        box.width = innerRect.width;\n        box.height = innerRect.height;\n      }\n    },\n    connectorBuilder = optional && optional.connectorBuilder || themeConnector,\n    shapeFrom = element.data('nodeFrom'),\n    shapeTo = element.data('nodeTo'),\n    theme = optional && optional.theme,\n    connectorAttr = element.data('attr'),\n    fromBox = shapeFrom && shapeFrom.getDataBox(),\n    toBox = shapeTo && shapeTo.getDataBox();\n  if (!shapeFrom || !shapeTo || shapeFrom.length === 0 || shapeTo.length === 0) {\n    return;\n  }\n\n  applyInnerRect(shapeFrom, fromBox);\n  applyInnerRect(shapeTo, toBox);\n  fromBox.styles = shapeFrom.data('styles');\n  toBox.styles = shapeTo.data('styles');\n\n  return  Object.assign(connectorBuilder(fromBox, toBox, theme), connectorAttr);\n};\n","/*global module, require */\nconst defaultTheme = require('../core/theme/default-theme'),\n  createSVG = require('./create-svg'),\n  pathElement = createSVG('path');\nmodule.exports = function calcLabelCenterPoint(connectionPosition, fromBox, toBox, d, labelTheme) {\n  'use strict';\n  labelTheme = labelTheme || defaultTheme.connector.default.label;\n  const labelPosition = labelTheme.position || {};\n\n  pathElement.attr('d', d);\n  if (labelPosition.aboveEnd) {\n    const middleToBox = toBox.left + (toBox.width / 2) - connectionPosition.left,\n      middleFromBox = fromBox.left + (fromBox.width / 2) - connectionPosition.left,\n      multiplier = labelPosition.ratio || 1;\n    return {\n      x: Math.round(middleFromBox + multiplier * (middleToBox - middleFromBox)),\n      y: toBox.top - connectionPosition.top - labelPosition.aboveEnd\n    };\n  } else if (labelPosition.ratio) {\n    return pathElement[0].getPointAtLength(pathElement[0].getTotalLength() * labelTheme.position.ratio);\n  }\n\n  return pathElement[0].getPointAtLength(pathElement[0].getTotalLength() * 0.5);\n\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  createSVG = require('./create-svg'),\n  connectorKey = require('../core/util/connector-key'),\n  buildConnection = require('../browser/build-connection'),\n  convertPositionToTransform = require('../core/util/convert-position-to-transform');\n\njQuery.fn.createConnector = function (connector, optional) {\n  'use strict';\n  const stage = this.parent('[data-mapjs-role=stage]'),\n    element = createSVG('g').data({ 'nodeFrom': stage.nodeWithId(connector.from), 'nodeTo': stage.nodeWithId(connector.to), attr: connector.attr }).attr({ 'id': connectorKey(connector), 'data-mapjs-role': 'connector' }),\n    connection = buildConnection(element, optional);\n  return element.css(Object.assign(convertPositionToTransform(connection.position), { stroke: connection.color }))\n    .appendTo(this);\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  createSVG = require('./create-svg'),\n  linkKey = require('../core/util/link-key'),\n  themeLink = require('../core/theme/link'),\n  convertPositionToTransform = require('../core/util/convert-position-to-transform');\n\nrequire('./get-data-box');\njQuery.fn.createLink = function (l, optional) {\n  'use strict';\n  const stage = this.parent('[data-mapjs-role=stage]'),\n    theme = (optional && optional.theme),\n    linkBuilder = (optional && optional.linkBuilder) || themeLink,\n    elementData = {\n      'nodeFrom': stage.nodeWithId(l.ideaIdFrom),\n      'nodeTo': stage.nodeWithId(l.ideaIdTo),\n      attr: (l.attr && l.attr.style) || {}\n    },\n    element = createSVG('g').attr({\n      'id': linkKey(l),\n      'data-mapjs-role': 'link'\n    }).data(elementData),\n    connection = linkBuilder(elementData.nodeFrom.getDataBox(), elementData.nodeTo.getDataBox(), elementData.attrs, theme);\n  element.css(Object.assign(convertPositionToTransform(connection.position), { stroke: connection.lineProps.color }));\n  element.appendTo(this);\n  return element;\n};\n\n","/*global require*/\nconst jQuery = require('jquery'),\n  nodeKey = require('../core/util/node-key');\njQuery.fn.createNode = function (node) {\n  'use strict';\n  return jQuery('<div>')\n    .attr({\n      'id': nodeKey(node.id),\n      // 'tabindex': 0,\n      'data-mapjs-role': 'node',\n    })\n    .css({\n      display: 'block',\n      opacity: 0,\n      position: 'absolute',\n      top: Math.round(node.y || 0) + 'px',\n      left: Math.round(node.x || 0) + 'px',\n    })\n    .addClass('mapjs-node')\n    .appendTo(this);\n};\n","/*global require */\nconst jQuery = require('jquery');\njQuery.fn.createReorderBounds = function () {\n  'use strict';\n  const result = jQuery('<div>').attr({\n    'data-mapjs-role': 'reorder-bounds',\n    'class': 'mapjs-reorder-bounds'\n  }).hide().css('position', 'absolute').appendTo(this);\n  return result;\n};\n\n","/*global module, require, document */\nconst jQuery = require('jquery');\nmodule.exports = function createSVG(tag) {\n  'use strict';\n  return jQuery(document.createElementNS('http://www.w3.org/2000/svg', tag || 'svg'));\n};\n","/*global require, module*/\nconst jQuery = require('jquery'),\n  _ = require('underscore'),\n  calculateLayout = require('../core/layout/calculate-layout'),\n  nodeCacheMark = require('./node-cache-mark');\n\nrequire('./create-node');\nrequire('./hammer-draggable');\nrequire('./node-resize-widget');\nrequire('./update-connector');\nrequire('./update-link');\nrequire('./node-with-id');\nrequire('./update-node-content');\nrequire('./update-stage');\nrequire('./queue-fade-out');\nrequire('./edit-node');\nrequire('./update-reorder-bounds');\nrequire('./create-connector');\nrequire('./create-link');\nrequire('./find-line');\nrequire('./create-reorder-bounds');\n\nmodule.exports = function DomMapController(mapModel, stageElement, touchEnabled, imageInsertController, resourceTranslator, themeSource, options) {\n  'use strict';\n  let stageMargin = (options && options.stageMargin),\n    stageVisibilityMargin = (options && options.stageVisibilityMargin),\n    currentDroppable = false,\n    stats = {},\n    viewPortDimensions;\n\n  const self = this,\n    viewPort = stageElement.parent(),\n    viewPortAnimOptions = { duration: 400 },\n    reorderBounds = mapModel.isEditingEnabled() ? stageElement.createReorderBounds() : jQuery('<div>'),\n    svgPixel = 'data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"1\" height=\"1\"></svg>',\n    dummyTextBox = jQuery('<div>').addClass('mapjs-node').addClass('noTransition').css({ position: 'absolute', visibility: 'hidden' }),\n    getViewPortDimensions = function () {\n      if (viewPortDimensions) {\n        return viewPortDimensions;\n      }\n      viewPortDimensions = {\n        left: viewPort.scrollLeft(),\n        top: viewPort.scrollTop(),\n        innerWidth: viewPort.innerWidth(),\n        innerHeight: viewPort.innerHeight()\n      };\n      return viewPortDimensions;\n    },\n    stageToViewCoordinates = function (x, y) {\n      const stage = stageElement.data(),\n        scrollPosition = getViewPortDimensions();\n      return {\n        x: stage.scale * (x + stage.offsetX) - scrollPosition.left,\n        y: stage.scale * (y + stage.offsetY) - scrollPosition.top\n      };\n    },\n    viewToStageCoordinates = function (x, y) {\n      const stage = stageElement.data(),\n        scrollPosition = getViewPortDimensions();\n      return {\n        x: (scrollPosition.left + x) / stage.scale - stage.offsetX,\n        y: (scrollPosition.top + y) / stage.scale - stage.offsetY\n      };\n    },\n    updateScreenCoordinates = function () {\n      const element = jQuery(this);\n      element.css({\n        'left': element.data('x'),\n        'top': element.data('y')\n      }).trigger('mapjs:move');\n    },\n    ensureSpaceForPoint = function (x, y) {/* in stage coordinates */\n      const stage = stageElement.data();\n      let dirty = false;\n      if (x < -1 * stage.offsetX) {\n        stage.width = stage.width - stage.offsetX - x;\n        stage.offsetX = -1 * x;\n        dirty = true;\n      }\n      if (y < -1 * stage.offsetY) {\n        stage.height = stage.height - stage.offsetY - y;\n        stage.offsetY = -1 * y;\n        dirty = true;\n      }\n      if (x > stage.width - stage.offsetX) {\n        stage.width = stage.offsetX + x;\n        dirty = true;\n      }\n      if (y > stage.height - stage.offsetY) {\n        stage.height = stage.offsetY + y;\n        dirty = true;\n      }\n      if (dirty) {\n        stageElement.updateStage();\n      }\n    },\n    ensureSpaceForNode = function () {\n      return jQuery(this).each(function () {\n        const node = jQuery(this).data(),\n          margin = stageMargin || { top: 0, left: 0, bottom: 0, right: 0 };\n        /* sequence of calculations is important because maxX and maxY take into consideration the new offsetX snd offsetY */\n        ensureSpaceForPoint(node.x - margin.left, node.y - margin.top);\n        ensureSpaceForPoint(node.x + node.width + margin.right, node.y + node.height + margin.bottom);\n      });\n    },\n    centerViewOn = function (x, y, animate) { /*in the stage coordinate system*/\n      const stage = stageElement.data(),\n        viewPortCenter = {\n          x: Math.round(viewPort.innerWidth() / 2),\n          y: Math.round(viewPort.innerHeight() / 2)\n        },\n        margin = stageVisibilityMargin || { top: 0, left: 0, bottom: 0, right: 0 };\n      let newLeftScroll = false, newTopScroll = false;\n\n      ensureSpaceForPoint(x - viewPortCenter.x / stage.scale, y - viewPortCenter.y / stage.scale);\n      ensureSpaceForPoint(x + viewPortCenter.x / stage.scale - margin.left, y + viewPortCenter.y / stage.scale - margin.top);\n\n      newLeftScroll = stage.scale * (x + stage.offsetX) - viewPortCenter.x;\n      newTopScroll = stage.scale * (y + stage.offsetY) - viewPortCenter.y;\n      viewPort.finish();\n      if (animate) {\n        viewPort.animate({\n          scrollLeft: newLeftScroll,\n          scrollTop: newTopScroll\n        }, viewPortAnimOptions);\n      } else {\n        viewPort.scrollLeft(newLeftScroll);\n        viewPort.scrollTop(newTopScroll);\n      }\n    },\n    centerViewOnNode = function (ideaId, animate) {\n      const node = stageElement.nodeWithId(ideaId).data(),\n        nodeCenterX = Math.round(node.x + node.width / 2),\n        nodeCenterY = Math.round(node.y + node.height / 2);\n      centerViewOn(nodeCenterX, nodeCenterY, animate);\n    },\n    stagePointAtViewportCenter = function () {\n      return viewToStageCoordinates(Math.round(viewPort.innerWidth() / 2), Math.round(viewPort.innerHeight() / 2));\n    },\n    ensureNodeVisible = function (domElement) {\n      if (!domElement || domElement.length === 0) {\n        return;\n      }\n      viewPort.finish();\n      const node = domElement.data(),\n        nodeTopLeft = stageToViewCoordinates(node.x, node.y),\n        nodeBottomRight = stageToViewCoordinates(node.x + node.width, node.y + node.height),\n        animation = {},\n        margin = stageVisibilityMargin || { top: 10, left: 10, bottom: 10, right: 10 };\n      if ((nodeTopLeft.x - margin.left) < 0) {\n        animation.scrollLeft = viewPort.scrollLeft() + nodeTopLeft.x - margin.left;\n      } else if ((nodeBottomRight.x + margin.right) > viewPort.innerWidth()) {\n        animation.scrollLeft = viewPort.scrollLeft() + nodeBottomRight.x - viewPort.innerWidth() + margin.right;\n      }\n      if ((nodeTopLeft.y - margin.top) < 0) {\n        animation.scrollTop = viewPort.scrollTop() + nodeTopLeft.y - margin.top;\n      } else if ((nodeBottomRight.y + margin.bottom) > viewPort.innerHeight()) {\n        animation.scrollTop = viewPort.scrollTop() + nodeBottomRight.y - viewPort.innerHeight() + margin.bottom;\n      }\n      if (!_.isEmpty(animation)) {\n        viewPort.animate(animation, viewPortAnimOptions);\n      }\n    },\n    viewportCoordinatesForPointEvent = function (evt) {\n      const dropPosition = (evt && evt.gesture && evt.gesture.center) || evt,\n        vpOffset = viewPort.offset();\n      let result;\n      if (dropPosition) {\n        result = {\n          x: dropPosition.pageX - vpOffset.left,\n          y: dropPosition.pageY - vpOffset.top\n        };\n        if (result.x >= 0 && result.x <= viewPort.innerWidth() && result.y >= 0 && result.y <= viewPort.innerHeight()) {\n          return result;\n        }\n      }\n    },\n    stagePositionForPointEvent = function (evt) {\n      const viewportDropCoordinates = viewportCoordinatesForPointEvent(evt);\n      if (viewportDropCoordinates) {\n        return viewToStageCoordinates(viewportDropCoordinates.x, viewportDropCoordinates.y);\n      }\n    },\n    clearCurrentDroppable = function () {\n      if (currentDroppable || currentDroppable === false) {\n        jQuery('.mapjs-node').removeClass('droppable');\n        currentDroppable = undefined;\n      }\n    },\n    showDroppable = function (nodeId) {\n      stageElement.nodeWithId(nodeId).addClass('droppable');\n      currentDroppable = nodeId;\n    },\n    withinReorderBoundary = function (boundaries, box) {\n      const closeTo = function (reorderBoundary) {\n        let nodeX = box.x;\n        if (reorderBoundary.edge === 'right') {\n          nodeX += box.width;\n        }\n        if (reorderBoundary.x && reorderBoundary.margin) {\n          return Math.abs(nodeX - reorderBoundary.x) < reorderBoundary.margin * 2 &&\n            box.y < reorderBoundary.maxY &&\n            box.y > reorderBoundary.minY;\n        } else {\n          return box.y < reorderBoundary.maxY &&\n            box.y > reorderBoundary.minY &&\n            box.x < reorderBoundary.maxX &&\n            box.x > reorderBoundary.minX;\n        }\n      };\n      if (_.isEmpty(boundaries)) {\n        return false;\n      }\n      if (!box) {\n        return false;\n      }\n      return _.find(boundaries, closeTo);\n    },\n    translateToPixel = function () {\n      return svgPixel;\n    },\n    record = function (evt) {\n      if (!stats) {\n        return false;\n      }\n      if (!stats[evt]) {\n        stats[evt] = 0;\n      }\n      stats[evt] = stats[evt] + 1;\n    },\n    recordCacheMiss = function (actual, expected) {\n      if (!stats) {\n        return false;\n      }\n      if (!stats.cacheMisses) {\n        stats.cacheMisses = [];\n      }\n      stats.cacheMisses.push({ old: actual, new: expected });\n    };\n  self.resetStats = function () {\n    stats = {};\n  };\n\n  self.getStats = function () {\n    return stats;\n  };\n  self.setStageMargin = function (newMargins) {\n    stageMargin = newMargins;\n  };\n  self.setStageVisibilityMargin = function (newMargins) {\n    stageVisibilityMargin = newMargins;\n  };\n\n\n  self.dimensionProvider = function (idea, level) {\n    let result = false,\n      textBox = stageElement.nodeWithId(idea.id);\n    const expectedCacheMark = nodeCacheMark(idea, { level: level, theme: themeSource() });\n    if (textBox && textBox.length > 0) {\n      if (_.isEqual(textBox.data('nodeCacheMark'), expectedCacheMark)) {\n        record('dimension-cache:hit');\n        return _.pick(textBox.data(), 'width', 'height', 'textWidth');\n      }\n    }\n    record('dimension-cache:miss');\n    recordCacheMiss(textBox.data('nodeCacheMark'), expectedCacheMark);\n    textBox = dummyTextBox;\n    textBox.appendTo('body').updateNodeContent(\n      idea,\n      themeSource(),\n      { resourceTranslator: translateToPixel, level: level, decorations: ['left', 'right'] }\n    );\n    result = {\n      width: Math.ceil(textBox.outerWidth(true)),\n      textWidth: Math.ceil(textBox.find('[data-mapjs-role=\"title\"]').outerWidth(true)),\n      height: Math.ceil(textBox.outerHeight(true))\n    };\n    textBox.detach();\n    return result;\n  };\n\n  mapModel.setLayoutCalculator(function (contentAggregate, contextNode) {\n    return calculateLayout(contentAggregate, self.dimensionProvider, { contextNode: contextNode, theme: themeSource() });\n  });\n\n  viewPort.on('scroll', function () {\n    viewPortDimensions = undefined;\n  });\n  if (imageInsertController) {\n    imageInsertController.addEventListener('imageInserted', function (dataUrl, imgWidth, imgHeight, evt) {\n      const point = stagePositionForPointEvent(evt);\n      mapModel.dropImage(dataUrl, imgWidth, imgHeight, point && point.x, point && point.y);\n    });\n  }\n  mapModel.addEventListener('nodeCreated', function (node) {\n    let currentReorderBoundary;\n    const element = stageElement.createNode(node)\n      .updateNodeContent(node, themeSource(), { resourceTranslator: resourceTranslator })\n      .nodeResizeWidget(node.id, mapModel, stagePositionForPointEvent)\n      .on('tap', function (evt) {\n\n        const realEvent = (evt.gesture && evt.gesture.srcEvent) || evt;\n        if (realEvent.button && realEvent.button !== -1) {\n          return;\n        }\n        mapModel.clickNode(node.id, realEvent);\n        if (evt) {\n          evt.stopPropagation();\n        }\n        if (evt && evt.gesture) {\n          evt.gesture.stopPropagation();\n        }\n\n      })\n      .on('doubletap', function (event) {\n        if (event) {\n          event.stopPropagation();\n          if (event.gesture) {\n            event.gesture.stopPropagation();\n          }\n        }\n        if (!mapModel.isEditingEnabled()) {\n          mapModel.toggleCollapse('mouse');\n          return;\n        }\n        mapModel.editNode('mouse');\n      })\n      // Removed since attachment code disabled.\n      // .on('attachment-click', function () {\n      //   mapModel.openAttachment('mouse', node.id);\n      // })\n      .on('decoration-click', function (evt, decorationType) {\n        mapModel.decorationAction('mouse', node.id, decorationType);\n      })\n      .each(ensureSpaceForNode)\n      .each(updateScreenCoordinates)\n      .on('mm:start-dragging mm:start-dragging-shadow', function (evt) {\n        if (evt && evt.relatedTarget === this) {\n          mapModel.selectNode(node.id);\n          currentReorderBoundary = mapModel.getReorderBoundary(node.id);\n          element.addClass('dragging');\n        }\n      })\n      .on('mm:drag', function (evt) {\n        const dropCoords = stagePositionForPointEvent(evt),\n          currentPosition = evt.currentPosition && stagePositionForPointEvent({ pageX: evt.currentPosition.left, pageY: evt.currentPosition.top }),\n          hasShift = evt && evt.gesture && evt.gesture.srcEvent && evt.gesture.srcEvent.shiftKey,\n          nodeId = dropCoords && mapModel.getNodeIdAtPosition(dropCoords.x, dropCoords.y);\n        let border;\n        if (!dropCoords) {\n          clearCurrentDroppable();\n          return;\n        }\n\n\n        if (!hasShift && !nodeId && currentPosition) {\n          currentPosition.width = element.outerWidth();\n          currentPosition.height = element.outerHeight();\n          border = withinReorderBoundary(currentReorderBoundary, currentPosition);\n          reorderBounds.updateReorderBounds(border, currentPosition, dropCoords);\n        } else {\n          reorderBounds.hide();\n        }\n        if (!nodeId || nodeId === node.id) {\n          clearCurrentDroppable();\n        } else if (nodeId !== currentDroppable) {\n          clearCurrentDroppable();\n          if (nodeId) {\n            showDroppable(nodeId);\n          }\n        }\n      })\n      .on('contextmenu', function (event) {\n        mapModel.selectNode(node.id);\n        if (mapModel.requestContextMenu(event.pageX, event.pageY)) {\n          // Want context menu to be available over nodes too:\n          // event.preventDefault();\n          // return false;\n          return true;\n        }\n      })\n      .on('mm:stop-dragging', function (evt) {\n        element.removeClass('dragging');\n        reorderBounds.hide();\n        let dropResult, manualPosition;\n        const isShift = evt && evt.gesture && evt.gesture.srcEvent && evt.gesture.srcEvent.shiftKey,\n          stageDropCoordinates = stagePositionForPointEvent(evt),\n          nodeAtDrop = stageDropCoordinates && mapModel.getNodeIdAtPosition(stageDropCoordinates.x, stageDropCoordinates.y),\n          finalPosition = evt.finalPosition && stagePositionForPointEvent({ pageX: evt.finalPosition.left, pageY: evt.finalPosition.top });\n\n        clearCurrentDroppable();\n        if (!stageDropCoordinates) {\n          return;\n        }\n\n        if (nodeAtDrop && nodeAtDrop !== node.id) {\n          dropResult = mapModel.dropNode(node.id, nodeAtDrop, !!isShift);\n        } else {\n          // Check finalPosition not undefined:\n          if (!finalPosition) {\n            return false;\n          }\n          finalPosition.width = element.outerWidth();\n          finalPosition.height = element.outerHeight();\n          manualPosition = (!!isShift) || !withinReorderBoundary(currentReorderBoundary, finalPosition);\n          if (manualPosition) {\n            dropResult = mapModel.positionNodeAt(node.id, finalPosition.x, finalPosition.y, manualPosition);\n          } else {\n            dropResult = mapModel.positionNodeAt(node.id, stageDropCoordinates.x, stageDropCoordinates.y, manualPosition);\n          }\n        }\n        return dropResult;\n      })\n      .on('mm:cancel-dragging', function () {\n        clearCurrentDroppable();\n        element.removeClass('dragging');\n        reorderBounds.hide();\n      }).on('mm:resize', function (event) {\n        mapModel.setNodeWidth('mouse', node.id, event.nodeWidth);\n      });\n    if (touchEnabled) {\n      element.on('hold', function (evt) {\n        const realEvent = (evt.gesture && evt.gesture.srcEvent) || evt;\n        mapModel.clickNode(node.id, realEvent);\n        if (mapModel.requestContextMenu(evt.gesture.center.pageX, evt.gesture.center.pageY)) {\n          evt.preventDefault();\n          if (evt.gesture) {\n            evt.gesture.preventDefault();\n            evt.gesture.stopPropagation();\n          }\n          return false;\n        }\n      });\n    }\n    element.css('min-width', element.css('width'));\n    if (mapModel.isEditingEnabled()) {\n      element.shadowDraggable();\n    }\n  });\n  mapModel.addEventListener('nodeSelectionChanged', function (ideaId, isSelected) {\n    const node = stageElement.nodeWithId(ideaId);\n    if (isSelected) {\n      node.addClass('selected');\n      ensureNodeVisible(node);\n    } else {\n      node.removeClass('selected');\n    }\n  });\n  mapModel.addEventListener('nodeRemoved', function (node) {\n    stageElement.nodeWithId(node.id).queueFadeOut(themeSource());\n    // Have updated update content.js: 698 commandProcessors.removeSubIdea() to delete any empty groups instead of doing it here.\n  });\n  mapModel.addEventListener('nodeMoved', function (node /*, reason*/) {\n    stageElement.nodeWithId(node.id).data({\n      'x': Math.round(node.x),\n      'y': Math.round(node.y),\n      'width': Math.round(node.width),\n      'height': Math.round(node.height)\n    }).each(ensureSpaceForNode).each(updateScreenCoordinates);\n  });\n  mapModel.addEventListener('nodeTitleChanged nodeAttrChanged nodeLabelChanged', function (n) {\n    stageElement.nodeWithId(n.id).updateNodeContent(n, themeSource(), { resourceTranslator: resourceTranslator }).each(ensureSpaceForNode);\n  });\n  mapModel.addEventListener('connectorMoved', function (connector /*, reason*/) {\n    stageElement.findLine(connector).updateConnector({ theme: themeSource() });\n  });\n  mapModel.addEventListener('connectorCreated', function (connector) {\n    const connectorOptions = { theme: themeSource() },\n      element = stageElement.find('[data-mapjs-role=svg-container]')\n        .createConnector(connector, connectorOptions)\n        .updateConnector(connectorOptions);\n    stageElement.nodeWithId(connector.from).add(stageElement.nodeWithId(connector.to))\n      .on('mapjs:resize', function () {\n        element.updateConnector({ theme: themeSource() });\n      });\n    element.on('tap', function (event) {\n      const theme = themeSource();\n      if (!theme || !theme.connectorEditingContext || (theme.connectorEditingContext.allowed && theme.connectorEditingContext.allowed.length)) {\n        if (event.target && event.target.tagName === 'text') {\n          mapModel.lineLabelClicked(connector);\n        } else {\n          mapModel.selectConnector('mouse', connector,\n            event && event.gesture && event.gesture.center &&\n            { x: event.gesture.center.pageX, y: event.gesture.center.pageY }\n          );\n        }\n      }\n      event.gesture && event.gesture.stopPropagation && event.gesture.stopPropagation();\n      event.stopPropagation();\n    });\n  });\n  mapModel.addEventListener('connectorRemoved', function (connector) {\n    stageElement.findLine(connector).queueFadeOut(themeSource());\n  });\n  mapModel.addEventListener('linkCreated', function (line) {\n    const link = stageElement\n      .find('[data-mapjs-role=svg-container]')\n      .createLink(line, { theme: themeSource() }).updateLink({ theme: themeSource() });\n    link.on('tap', function (event) {\n      if (event.target && event.target.tagName === 'text') {\n        mapModel.lineLabelClicked(line);\n      } else {\n        mapModel.selectLink('mouse', line, { x: event.gesture.center.pageX, y: event.gesture.center.pageY });\n      }\n      event.stopPropagation();\n      event.gesture.stopPropagation();\n    });\n    stageElement.nodeWithId(line.ideaIdFrom).add(stageElement.nodeWithId(line.ideaIdTo))\n      .on('mapjs:move mm:drag mapjs:resize', function () {\n        link.updateLink({ theme: themeSource() });\n      });\n  });\n  mapModel.addEventListener('linkRemoved', function (l) {\n    stageElement.findLine(l).queueFadeOut(themeSource());\n  });\n  mapModel.addEventListener('mapScaleChanged', function (scaleMultiplier /*, zoomPoint */) {\n    const currentScale = stageElement.data('scale'),\n      targetScale = Math.max(Math.min(currentScale * scaleMultiplier, 5), 0.2),\n      currentCenter = stagePointAtViewportCenter();\n    if (currentScale === targetScale) {\n      return;\n    }\n    stageElement.data('scale', targetScale).updateStage();\n    centerViewOn(currentCenter.x, currentCenter.y);\n  });\n\n\n  mapModel.addEventListener('nodeVisibilityRequested', function (ideaId) {\n    const id = ideaId || mapModel.getCurrentlySelectedIdeaId(),\n      node = stageElement.nodeWithId(id);\n    if (node) {\n      ensureNodeVisible(node);\n    }\n\n  });\n  mapModel.addEventListener('nodeFocusRequested', function (ideaId) {\n    if (stageElement.data('scale') !== 1) {\n      stageElement.data('scale', 1).updateStage();\n    }\n    centerViewOnNode(ideaId, true);\n  });\n  mapModel.addEventListener('mapViewResetRequested', function () {\n    stageElement.data({ 'scale': 1, 'height': 0, 'width': 0, 'offsetX': 0, 'offsetY': 0 }).updateStage();\n    jQuery(stageElement).find('.mapjs-node').each(ensureSpaceForNode);\n    jQuery(stageElement).find('[data-mapjs-role=connector]').updateConnector({ theme: themeSource() });\n    jQuery(stageElement).find('[data-mapjs-role=link]').updateLink({ theme: themeSource() });\n    centerViewOnNode(mapModel.getCurrentlySelectedIdeaId());\n    viewPort.focus();\n  });\n  mapModel.addEventListener('layoutChangeStarting', function () {\n    viewPortDimensions = undefined;\n  });\n  mapModel.addEventListener('layoutChangeComplete', function (/*layoutChangeOptions*/) {\n    ensureNodeVisible(stageElement.nodeWithId(mapModel.getCurrentlySelectedIdeaId()));\n  });\n\n  /* editing */\n  if (!options || !options.inlineEditingDisabled) {\n    mapModel.addEventListener('nodeEditRequested', function (nodeId, shouldSelectAll, editingNew) {\n      const editingElement = stageElement.nodeWithId(nodeId),\n        source = `nodeEditRequested`; // Dummy value, adding it plus undefined so function compatible with button function call\n      mapModel.setInputEnabled(source, undefined, false);\n      viewPort.finish(); /* close any pending scroll animations */\n      editingElement.editNode(shouldSelectAll)\n        .then(function (newText) {\n          mapModel.setInputEnabled(source, undefined, true);\n          mapModel.updateTitle(nodeId, newText, editingNew);\n          stageElement.focus();\n        })\n        .catch(function () {\n          mapModel.setInputEnabled(source, undefined, true);\n          if (editingNew) { // Undoes node creation if no text added.\n            mapModel.undo('internal');\n          }\n          // Add this line to keep node:\n          //   mapModel.updateTitle(nodeId, editingElement.data('title'), editingNew);\n          stageElement.focus();\n        });\n    });\n  }\n  mapModel.addEventListener('addLinkModeToggled', function (isOn) {\n    if (isOn) {\n      stageElement.addClass('mapjs-add-link');\n    } else {\n      stageElement.removeClass('mapjs-add-link');\n    }\n  });\n  mapModel.addEventListener('linkAttrChanged', function (l) {\n    stageElement.findLine(l).data('attr', (l.attr && l.attr.style) || {}).updateLink({ theme: themeSource() });\n  });\n  mapModel.addEventListener('connectorAttrChanged', function (connector) {\n    stageElement.findLine(connector).data('attr', connector.attr || false).updateConnector({ theme: themeSource() });\n  });\n  mapModel.addEventListener('activatedNodesChanged', function (activatedNodes, deactivatedNodes) {\n    _.each(activatedNodes, function (nodeId) {\n      stageElement.nodeWithId(nodeId).addClass('activated');\n    });\n    _.each(deactivatedNodes, function (nodeId) {\n      stageElement.nodeWithId(nodeId).removeClass('activated');\n    });\n  });\n  ['nodeTitleChanged', 'nodeAttrChanged', 'nodeLabelChanged', 'nodeMoved', 'nodeRemoved', 'nodeCreated', 'connectorCreated', 'connectorRemoved', 'linkCreated', 'linkRemoved', 'linkAttrChanged', 'connectorAttrChanged'].forEach(evt => {\n    mapModel.addEventListener(evt, () => record(evt));\n  });\n  // Adding to domMapController so I can call it from image-drop-widget\n  // QUESTION: More elegant way?\n  self.stagePositionForPointEvent = stagePositionForPointEvent;\n};\n\n","/*global require, window, PATH_FILE_CONFIG_MAPJS */\nconst $ = require('jquery'),\n  _ = require('underscore'),\n  createSVG = require('./create-svg');\nconst mapjsUtilities = require('../core/util/mapjs-utilities'),\n  { default: CONFIG } = require(PATH_FILE_CONFIG_MAPJS),\n  MAPJS_MAP_CLASS = CONFIG.mapjs_map.class;\n\n// Moved import-loader call to webpack.config.js instead:\nrequire('jquery.hotkeys');\n\n$.fn.scrollWhenDragging = function (scrollPredicate) {\n  'use strict';\n  // TODO: simplify - this.each gets element from jQuery object and then $(this) turns element back into jQuery object\n  return this.each(function () {\n    const element = $(this);\n    let dragOrigin;\n    element.on('dragstart', function () {\n      if (scrollPredicate()) {\n        dragOrigin = {\n          top: element.scrollTop(),\n          left: element.scrollLeft()\n        };\n      }\n    }).on('drag', function (e) {\n      if (e.gesture && dragOrigin) {\n        element.scrollTop(dragOrigin.top - e.gesture.deltaY);\n        element.scrollLeft(dragOrigin.left - e.gesture.deltaX);\n      }\n    }).on('dragend', function () {\n      dragOrigin = undefined;\n    });\n  });\n};\n$.fn.domMapWidget = function (activityLog, mapModel, touchEnabled, imageInsertController, dragContainer, centerSelectedNodeOnOrientationChange) {\n  'use strict';\n  const hotkeyEventHandlers = {\n      'return': 'insertDown',\n      'shift+return': 'insertUp',\n      ',': 'insertLeft',\n      '.': 'insertRight',\n      'del backspace': 'removeSubIdea',\n      'left': 'selectNodeLeft',\n      'up': 'selectNodeUp',\n      'right': 'selectNodeRight',\n      'shift+right': 'activateNodeRight',\n      'shift+left': 'activateNodeLeft',\n      'meta+right ctrl+right': 'moveRight',\n      'meta+left ctrl+left': 'moveLeft',\n      'meta+up ctrl+up': 'moveUp',\n      'meta+down ctrl+down': 'moveDown',\n      'shift+up': 'activateNodeUp',\n      'shift+down': 'activateNodeDown',\n      'down': 'selectNodeDown',\n      'space f2': 'editNode',\n      'f': 'toggleCollapse',\n      'c meta+x ctrl+x': 'cut',\n      'p meta+v ctrl+v': 'paste',\n      'y meta+c ctrl+c': 'copy',\n      'ctrl+shift+v meta+shift+v': 'pasteStyle',\n      'u meta+z ctrl+z': 'undo',\n      'r meta+shift+z ctrl+shift+z meta+y ctrl+y': 'redo',\n      'meta+plus ctrl+plus z': 'scaleUp',\n      'meta+minus ctrl+minus shift+z': 'scaleDown',\n      'Esc 0 meta+0 ctrl+0': 'resetView',\n      'alt+o': 'handleKey_loadMap',\n      'alt+s': 'downloadMap',\n    // 'Esc': 'cancelCurrentAction', // Can't find any functionality\n    },\n    charEventHandlers = {\n      '[': 'activateChildren',\n      '{': 'activateNodeAndChildren',\n      '=': 'activateSiblingNodes',\n      '.': 'activateSelectedNode',\n      '/': 'toggleCollapse',\n      // 'a': 'openAttachment', // Removed since not currently very useful\n      // 'i': 'editIcon', // Can't find any functionality\n    },\n    // Bad practice: self = this\n    //   QUESTION: try removing?\n    //     self not defined when this runs. Currently means `div.mapjs-app` when called elsewhere in this file.\n    self = this;\n  let actOnKeys = true;\n  mapModel.addEventListener('inputEnabledChanged', function (canInput, holdFocus) {\n    actOnKeys = canInput;\n    if (canInput && !holdFocus) {\n      // QUESTION: Should focus be canvas instead of self (`div.mapjs-app`)?\n      self.focus();\n    }\n  });\n\n  return this.each(function () {\n    // const mapjsInstance = $(this),\n    // TODO: Rename element to mapjs_map\n    const element = $(mapjsUtilities.getElementMJS(MAPJS_MAP_CLASS, this)),\n      // const element = $(this),\n      svgContainer = createSVG()\n        .css({\n          position: 'absolute',\n          top: 0,\n          left: 0,\n        })\n        .attr({\n          'data-mapjs-role': 'svg-container',\n          'class': 'mapjs-draw-container',\n          'role': 'img',\n          'aria-label': 'Argument Map showing supporting and opposing relationships between text nodes.',\n          // 'tabindex': 0,\n        }),\n      stage = $('<div>')\n        .css(\n          {\n            position: 'relative'\n          })\n        .attr('data-mapjs-role', 'stage')\n        .appendTo(element)\n        .data({\n          // As long as style top (offset y) and viewBox 2nd co-ordinate are the same, connections and nodes will align vertically.\n          //   TODO: So prob best to set both to 0\n          //   Prob ditto for let and 1st co-ordinate.\n          'offsetX': element.innerWidth() / 2,\n          'offsetY': element.innerHeight() / 2,\n          'width': element.innerWidth() - 20,\n          'height': element.innerHeight() - 20,\n          'scale': 1,\n        })\n        .attr('tabindex', 0) //  ensures that keyboard shortcuts work on map\n        .append(svgContainer)\n        .updateStage();\n    let previousPinchScale = false;\n    // Moved this css overflow:auto setting to mapjs-default-styles.css file, so it's easier to override mapjs-container setting.\n    // element.css('overflow', 'auto').attr('tabindex', 0);\n    // Set index to 0 rather than 1 because 1 is considered bad practice for accessibility.\n    // See: https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex#sect2\n    if (mapModel.getInputEnabled()) {\n      (dragContainer || element).simpleDraggableContainer();\n    }\n\n    if (!touchEnabled) {\n      element.scrollWhenDragging(mapModel.getInputEnabled); //no need to do this for touch, this is native\n      // Keeps elements visible when dragging them out of the container:\n      // element.on('mm:start-dragging-shadow', function (e) {\n      //   if (e.target !== element[0]) {\n      //     element.css('overflow', 'hidden');\n      //   }\n      // });\n      // $(document).on('mouseup', function () {\n      //   if (element.css('overflow') !== 'auto') {\n      //     element.css('overflow', 'auto');\n      //   }\n      // });\n      element.imageDropWidget(imageInsertController);\n    } else {\n      element.on('doubletap', function (event) {\n        if (mapModel.requestContextMenu(event.gesture.center.pageX, event.gesture.center.pageY)) {\n          event.preventDefault();\n          event.gesture.preventDefault();\n          return false;\n        }\n      }).on('pinch', function (event) {\n        let scale;\n        if (!event || !event.gesture || !event.gesture.scale) {\n          return;\n        }\n        event.preventDefault();\n        event.gesture.preventDefault();\n\n        scale = event.gesture.scale;\n        if (previousPinchScale) {\n          scale = scale / previousPinchScale;\n        }\n        if (Math.abs(scale - 1) < 0.05) {\n          return;\n        }\n        previousPinchScale = event.gesture.scale;\n\n        mapModel.scale('touch', scale, {\n          x: event.gesture.center.pageX - stage.data('offsetX'),\n          y: event.gesture.center.pageY - stage.data('offsetY')\n        });\n      }).on('gestureend', function () {\n        previousPinchScale = false;\n      });\n\n    }\n    _.each(hotkeyEventHandlers, function (mappedFunction, keysPressed) {\n      self.keydown(keysPressed, function (event) { // Self is `div.mapjs-app`\n        if (actOnKeys) {\n          event.stopImmediatePropagation();\n          event.preventDefault();\n          const container = event.currentTarget;\n          // No longer need this container argument; keeping in case it's useful later.\n          mapModel[mappedFunction]('keyboard', event, container);\n        }\n      });\n    });\n    if (!touchEnabled) {\n      // No real reason to reset the maps when window is resized (which includes zooming)\n      // $(window).on('resize', function () {\n      //   mapModel.resetView();\n      // });\n    }\n\n    $(window).on('orientationchange', function () {\n      if (centerSelectedNodeOnOrientationChange) {\n        mapModel.centerOnNode(mapModel.getSelectedNodeId());\n      } else {\n        // QUESTION: Is it really necessary to reset the view when the orientation changes?\n        mapModel.resetView();\n      }\n\n    });\n    self[0].addEventListener('keydown', function (e) { // Self is `div.mapjs-app`\n      const functions = {\n        'U+003D': 'scaleUp',\n        'U+002D': 'scaleDown',\n        61: 'scaleUp',\n        173: 'scaleDown',\n        187: 'scaleUp',\n        189: 'scaleDown',\n      };\n      let mappedFunction;\n      if (e && !e.altKey && (e.ctrlKey || e.metaKey)) {\n        // ISSUE: keyCode event works, but is deprecated\n        //  https://github.com/s6mike/mapjs/issues/3\n        //  TODO: Use KeyboardEvent.key instead\n        // if (e.originalEvent && e.originalEvent.keyCode) { /* webkit */\n        if (e.isTrusted && e.keyCode) { /* webkit */\n          mappedFunction = functions[e.keyCode];\n          // mappedFunction = functions[e.originalEvent.keyCode];\n        } else if (e.key === 'MozPrintableKey') {\n          mappedFunction = functions[e.which];\n        }\n        if (mappedFunction) {\n          if (actOnKeys) {\n            e.preventDefault();\n            mapModel[mappedFunction]('keyboard');\n          }\n        }\n      }\n    });\n    self.on('wheel mousewheel', function (e) { // Self is `div.mapjs-app`\n      const scroll = e.originalEvent.deltaX || (-1 * e.originalEvent.wheelDeltaX);\n      if (scroll < 0 && element.scrollLeft() === 0) {\n        e.preventDefault();\n      }\n      if (scroll > 0 && (element[0].scrollWidth - element.width() - element.scrollLeft() === 0)) {\n        e.preventDefault();\n      }\n    });\n\n    self.on('keypress', function (evt) { // Self is `div.mapjs-app`\n      if (!actOnKeys) {\n        return;\n      }\n      if (/INPUT|TEXTAREA/.test(evt && evt.target && evt.target.tagName)) {\n        return;\n      }\n      const unicode = evt.charCode || evt.keyCode,\n        actualkey = String.fromCharCode(unicode),\n        mappedFunction = charEventHandlers[actualkey];\n      if (mappedFunction) {\n        evt.preventDefault();\n        mapModel[mappedFunction]('keyboard');\n      } else if ((Number(actualkey) <= 9 && Number(actualkey) >= 1) || actualkey === '0') {\n        evt.preventDefault();\n        mapModel.activateLevel('keyboard', Number(actualkey) + 1);\n      }\n    });\n  });\n};\n","/*global require */\nconst jQuery = require('jquery');\n\nrequire('./inner-text');\nrequire('./place-caret-at-end');\nrequire('./select-all');\nrequire('./hammer-draggable');\n\n\njQuery.fn.editNode = function (shouldSelectAll) {\n  'use strict';\n  const node = this,\n    textBox = this.find('[data-mapjs-role=title]'),\n    unformattedText = this.data('title'),\n    originalText = textBox.text();\n\n  if (unformattedText !== originalText) { /* links or some other potential formatting issues */\n    textBox.css('word-break', 'break-all');\n  }\n  textBox.text(unformattedText).attr('contenteditable', true).focus();\n  if (shouldSelectAll) {\n    textBox.selectAll();\n  } else if (unformattedText) {\n    textBox.placeCaretAtEnd();\n  }\n  node.shadowDraggable({ disable: true });\n\n  return new Promise((resolve, reject) => {\n    const clear = function () {\n        detachListeners(); //eslint-disable-line no-use-before-define\n        textBox.css('word-break', '');\n        textBox.removeAttr('contenteditable');\n        node.shadowDraggable();\n      },\n      finishEditing = function () {\n        const content = textBox.innerText();\n        if (content === unformattedText) {\n          return cancelEditing(); //eslint-disable-line no-use-before-define\n        }\n        clear();\n        resolve(content);\n      },\n      cancelEditing = function () {\n        clear();\n        textBox.text(originalText);\n        reject();\n      },\n      keyboardEvents = function (e) {\n        const ENTER_KEY_CODE = 13,\n          ESC_KEY_CODE = 27,\n          TAB_KEY_CODE = 9,\n          S_KEY_CODE = 83,\n          Z_KEY_CODE = 90;\n        if (e.which === ENTER_KEY_CODE && !e.shiftKey) { // allow shift+enter to break lines\n          finishEditing();\n          e.stopPropagation();\n        } else if (e.which === ESC_KEY_CODE) {\n          cancelEditing();\n          e.preventDefault();\n          e.stopPropagation();\n        } else if (e.which === TAB_KEY_CODE || (e.which === S_KEY_CODE && (e.metaKey || e.ctrlKey) && !e.altKey)) {\n          finishEditing();\n          e.preventDefault(); /* stop focus on another object */\n        } else if (!e.shiftKey && e.which === Z_KEY_CODE && (e.metaKey || e.ctrlKey) && !e.altKey) { /* undo node edit on ctrl+z if text was not changed */\n          if (textBox.text() === unformattedText) {\n            cancelEditing();\n          }\n          e.stopPropagation();\n        }\n        textBox.trigger('keydown-complete');\n      },\n      attachListeners = function () {\n        textBox.on('blur', finishEditing).on('keydown', keyboardEvents);\n      },\n      detachListeners = function () {\n        textBox.off('blur', finishEditing).off('keydown', keyboardEvents);\n      };\n    attachListeners();\n  });\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  connectorKey = require('../core/util/connector-key'),\n  linkKey = require('../core/util/link-key');\njQuery.fn.findLine = function (line) {\n  'use strict';\n  if (line && line.type === 'connector') {\n    return this.find('#' + connectorKey(line));\n  } else if (line && line.type === 'link') {\n    return this.find('#' + linkKey(line));\n  }\n  Logger.error('invalid.line', line); //eslint-disable-line\n  throw 'invalid-args';\n};\n\n","/*global require */\nconst jQuery = require('jquery');\njQuery.fn.getBox = function () {\n  'use strict';\n  const domShape = this && this[0];\n  if (!domShape) {\n    return false;\n  }\n  return {\n    top: domShape.offsetTop,\n    left: domShape.offsetLeft,\n    width: domShape.offsetWidth,\n    height: domShape.offsetHeight\n  };\n};\n\n","/*global require */\nconst jQuery = require('jquery');\nrequire('./get-box');\njQuery.fn.getDataBox = function () {\n  'use strict';\n  const domShapeData = this.data();\n  if (domShapeData && domShapeData.width && domShapeData.height) {\n    return {\n      top: domShapeData.y,\n      left: domShapeData.x,\n      width: domShapeData.width,\n      height: domShapeData.height\n    };\n  }\n  return this.getBox();\n};\n\n","/*global module, document, Image, require */\nconst jQuery = require('jquery');\nmodule.exports = function getDataURIAndDimensions(src, corsProxyUrl) {\n  'use strict';\n  const isDataUri = function (string) {\n      return (/^data:image/).test(string);\n    },\n    convertSrcToDataUri = function (img) {\n      let ctx = false;\n      if (isDataUri(img.src)) {\n        return img.src;\n      }\n      const canvas = document.createElement('canvas');\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx = canvas.getContext('2d');\n      ctx.drawImage(img, 0, 0);\n      return canvas.toDataURL('image/png');\n    },\n    deferred = jQuery.Deferred(),\n    domImg = new Image();\n\n  domImg.onload = function () {\n    try {\n      deferred.resolve({ dataUri: convertSrcToDataUri(domImg), width: domImg.width, height: domImg.height });\n    } catch (e) {\n      deferred.reject();\n    }\n  };\n  domImg.onerror = function () {\n    deferred.reject();\n  };\n  if (!isDataUri(src)) {\n    if (corsProxyUrl) {\n      domImg.crossOrigin = 'Anonymous';\n      src = corsProxyUrl + encodeURIComponent(src);\n    } else {\n      deferred.reject('no-cors');\n    }\n  }\n  domImg.src = src;\n  return deferred.promise();\n};\n","/*global require, mapInstance*/\nconst $ = require('jquery'),\n  Hammer = require('jquery-hammerjs/jquery.hammer-full.js'),\n  Utilities = require('../core/util/mapjs-utilities'),\n  // mapModel = mapInstance[Utilities.getContainerID(this)].mapModel,\n\n  onDrag = function (e) {\n    'use strict';\n    $(this).trigger(\n      $.Event('mm:start-dragging', {\n        relatedTarget: this,\n        gesture: e.gesture\n      })\n    );\n    e.stopPropagation();\n    e.preventDefault();\n    if (e.gesture) {\n      e.gesture.stopPropagation();\n      e.gesture.preventDefault();\n    }\n  },\n  onShadowDrag = function (e) {\n    'use strict';\n    // TODO: Move mapModel definition to outer scope if possible:\n    const mapModel = mapInstance[Utilities.getContainerID(this)].mapModel;\n    if (mapModel.getInputEnabled()) {\n      $(this).trigger(\n        $.Event('mm:start-dragging-shadow', {\n          relatedTarget: this,\n          gesture: e.gesture\n        })\n      );\n      e.stopPropagation();\n      e.preventDefault();\n      if (e.gesture) {\n        e.gesture.stopPropagation();\n        e.gesture.preventDefault();\n      }\n    }\n  };\n\n\n$.fn.simpleDraggableContainer = function () {\n  'use strict';\n  let currentDragObject,\n    originalDragObjectPosition;\n  const container = this,\n    drag = function (event) {\n\n      if (currentDragObject && event.gesture) {\n        const newpos = {\n          top: Math.round(parseInt(originalDragObjectPosition.top, 10) + event.gesture.deltaY),\n          left: Math.round(parseInt(originalDragObjectPosition.left, 10) + event.gesture.deltaX)\n        };\n        currentDragObject.css(newpos).trigger($.Event('mm:drag', { currentPosition: newpos, gesture: event.gesture }));\n        if (event.gesture) {\n          event.gesture.preventDefault();\n        }\n        return false;\n      }\n    },\n    rollback = function (e) {\n      const target = currentDragObject; // allow it to be cleared while animating\n      if (target.attr('mapjs-drag-role') !== 'shadow') {\n        target.animate(originalDragObjectPosition, {\n          complete: function () {\n            target.trigger($.Event('mm:cancel-dragging', { gesture: e.gesture }));\n          },\n          progress: function () {\n            target.trigger('mm:drag');\n          }\n        });\n      } else {\n        target.trigger($.Event('mm:cancel-dragging', { gesture: e.gesture }));\n      }\n    };\n  Hammer(this, { 'drag_min_distance': 2 }); //eslint-disable-line new-cap\n  return this.on('mm:start-dragging', function (event) {\n    if (!currentDragObject) {\n      currentDragObject = $(event.relatedTarget);\n      originalDragObjectPosition = {\n        top: currentDragObject.css('top'),\n        left: currentDragObject.css('left')\n      };\n      $(this).on('drag', drag);\n    }\n  }).on('mm:start-dragging-shadow', function (event) {\n    const target = $(event.relatedTarget),\n      clone = function () {\n        const result = target.clone().addClass('drag-shadow').appendTo(container).offset(target.offset()).data(target.data()).attr('mapjs-drag-role', 'shadow'),\n          scale = target.parent().data('scale') || 1;\n        if (scale !== 0) {\n          result.css({\n            'transform': 'scale(' + scale + ')',\n            'transform-origin': 'top left'\n          });\n        }\n        return result;\n      };\n    if (!currentDragObject) {\n      currentDragObject = clone();\n      originalDragObjectPosition = {\n        top: currentDragObject.css('top'),\n        left: currentDragObject.css('left')\n      };\n      currentDragObject.on('mm:stop-dragging mm:cancel-dragging', function (e) {\n        this.remove();\n        e.stopPropagation();\n        e.stopImmediatePropagation();\n        const evt = $.Event(e.type, {\n          gesture: e.gesture,\n          finalPosition: e.finalPosition\n        });\n        target.trigger(evt);\n      }).on('mm:drag', function (e) {\n        target.trigger(e);\n      });\n      $(this).on('drag', drag);\n    }\n  }).on('dragend', function (e) {\n    $(this).off('drag', drag);\n    if (currentDragObject) {\n      const evt = $.Event('mm:stop-dragging', {\n        gesture: e.gesture,\n        finalPosition: currentDragObject.offset()\n      });\n      currentDragObject.trigger(evt);\n      if (evt.result === false) {\n        rollback(e);\n      }\n      currentDragObject = undefined;\n    }\n  }).on('mouseleave', function (e) {\n    if (currentDragObject) {\n      $(this).off('drag', drag);\n      rollback(e);\n      currentDragObject = undefined;\n    }\n  }).attr('data-drag-role', 'container');\n};\n\n$.fn.simpleDraggable = function (options) {\n  'use strict';\n  if (!options || !options.disable) {\n    return $(this).on('dragstart', onDrag);\n  } else {\n    return $(this).off('dragstart', onDrag);\n  }\n};\n$.fn.shadowDraggable = function (options) {\n  'use strict';\n  if (!options || !options.disable) {\n    return $(this).on('dragstart', onShadowDrag);\n  } else {\n    return $(this).off('dragstart', onShadowDrag);\n  }\n};\n","/*jslint browser: true */\n/*global require, mapInstance */\nconst jQuery = require('jquery');\njQuery.fn.imageDropWidget = function (imageInsertController) {\n  'use strict';\n  this.on('dragleave dragend', function () {\n    // TODO: Use getElementMJS()\n    Array.from(this.getElementsByClassName('droppable')).forEach((el) => el.classList.remove('droppable'));\n  }).on('dragenter dragover', function (e) {\n    const map = mapInstance[this.id],\n      stageDropCoordinates = map.domMapController.stagePositionForPointEvent(e),\n      // QUESTION: why return node id and not reference to node in getNodeIdAtPosition()?\n      // Would avoid issues with ambiguous node IDs\n      nodeAtDrop = stageDropCoordinates && map.mapModel.getNodeIdAtPosition(stageDropCoordinates.x, stageDropCoordinates.y);\n    if (typeof (nodeAtDrop) !== 'undefined') {\n      this.querySelector('#node_' + nodeAtDrop).classList.add('droppable');\n    }\n    if (e.originalEvent.dataTransfer) {\n      return false;\n    }\n  }).on('drop', function (e) {\n    const dataTransfer = e.originalEvent.dataTransfer;\n    let htmlContent;\n    e.stopPropagation();\n    e.preventDefault();\n    if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n      imageInsertController.insertFiles(dataTransfer.files, e.originalEvent);\n    } else if (dataTransfer) {\n      htmlContent = dataTransfer.getData('text/html');\n      imageInsertController.insertHtmlContent(htmlContent, e.originalEvent);\n    }\n    // TODO: Use getElementMJS()\n    Array.from(this.getElementsByClassName('droppable')).forEach((el) => el.classList.remove('droppable'));\n  });\n  return this;\n};\n","/*global module, require, FileReader, mapInstance */\nconst jQuery = require('jquery'),\n  _ = require('underscore'),\n  observable = require('../core/util/observable'),\n  getDataURIAndDimensions = require('./get-data-uri-and-dimensions'),\n  Utilities = require('../core/util/mapjs-utilities');\nmodule.exports = function ImageInsertController(corsProxyUrl, resourceConverter) {\n  'use strict';\n  const self = observable(this),\n    readFileIntoDataUrl = function (fileInfo) {\n      const loader = jQuery.Deferred(),\n        fReader = new FileReader();\n      fReader.onload = function (e) {\n        loader.resolve(e.target.result);\n      };\n      fReader.onerror = loader.reject;\n      fReader.onprogress = loader.notify;\n      fReader.readAsDataURL(fileInfo);\n      return loader.promise();\n    };\n  self.insertDataUrl = function (dataUrl, evt) {\n    self.dispatchEvent('imageLoadStarted');\n    getDataURIAndDimensions(dataUrl, corsProxyUrl).then(\n      function (result) {\n        let storeUrl = result.dataUri;\n        if (resourceConverter) {\n          storeUrl = resourceConverter(storeUrl);\n        }\n        self.dispatchEvent('imageInserted', storeUrl, result.width, result.height, evt);\n      },\n      function (reason) {\n        self.dispatchEvent('imageInsertError', reason);\n      }\n    );\n  };\n  self.insertFiles = function (files, evt) {\n    const mapModel = mapInstance[Utilities.getContainerID(evt.currentTarget)].mapModel;\n    if (mapModel.getInputEnabled()) {\n      jQuery.each(files, function (idx, fileInfo) {\n        if (/^image\\//.test(fileInfo.type)) {\n          jQuery.when(readFileIntoDataUrl(fileInfo)).done(function (dataUrl) {\n            self.insertDataUrl(dataUrl, evt);\n          });\n        }\n      });\n    };\n  };\n  self.insertHtmlContent = function (htmlContent, evt) {\n    const images = htmlContent.match(/img[^>]*src=\"([^\"]*)\"/);\n    if (images && images.length > 0) {\n      _.each(images.slice(1), function (dataUrl) {\n        self.insertDataUrl(dataUrl, evt);\n      });\n    }\n  };\n};\n\n","/*global require */\nconst jQuery = require('jquery');\njQuery.fn.innerText = function () {\n  'use strict';\n  const htmlContent = this.html(),\n    containsBr = /<br\\/?>/.test(htmlContent),\n    containsDiv = /<div>/.test(htmlContent);\n  if (containsDiv && this[0].innerText) { /* broken safari jquery text */\n    return this[0].innerText.trim();\n  } else if (containsBr) { /*broken firefox innerText */\n    return htmlContent.replace(/<br\\/?>/gi, '\\n').replace(/(<([^>]+)>)/gi, '');\n  }\n  return this.text();\n};\n\n","/*global require */\nconst jQuery = require('jquery');\n\n// TODO: Remove jQuery\nmodule.exports = function linkEditWidget(mapModel, linkEditWidgetElement) {\n  // jQuery.fn.linkEditWidget = function (mapModel) {\n  'use strict';\n  // return this.each(function () {\n  const element = jQuery(linkEditWidgetElement),\n    colorElement = element.find('.color'),\n    lineStyleElement = element.find('.lineStyle'),\n    arrowElement = element.find('.arrow');\n  let currentLink, width, height;\n  element.hide();\n  mapModel.addEventListener('linkSelected', function (link, selectionPoint, linkStyle) {\n    currentLink = link;\n    element.show();\n    width = width || element.width();\n    height = height || element.height();\n    element.css({\n      top: (selectionPoint.y - 0.5 * height - 15) + 'px',\n      left: (selectionPoint.x - 0.5 * width - 15) + 'px'\n    });\n    colorElement.val(linkStyle.color).change();\n    lineStyleElement.val(linkStyle.lineStyle);\n    // This tampers with whether button is active after being clicked, when it should be deciding impact on arrow.\n    // Seems counterproductive, disabling.\n    // arrowElement[linkStyle.arrow ? 'addClass' : 'removeClass']('active');\n  });\n  mapModel.addEventListener('mapMoveRequested', function () {\n    element.hide();\n  });\n  element.find('.delete').click(function () {\n    if (!currentLink) { // Added check to stop error message when delete link button clicked without any link selected.\n      return false;\n    }\n    mapModel.removeLink('mouse', currentLink.ideaIdFrom, currentLink.ideaIdTo);\n    element.hide();\n  });\n  colorElement.change(function () {\n    mapModel.updateLinkStyle('mouse', currentLink.ideaIdFrom, currentLink.ideaIdTo, 'color', jQuery(this).val());\n  });\n  // Fixes linestyle selector:\n  // lineStyleElement.find('a').click(function () {\n  lineStyleElement.change(function () {\n    mapModel.updateLinkStyle('mouse', currentLink.ideaIdFrom, currentLink.ideaIdTo, 'lineStyle', jQuery(this).val()); // Changed from text() to val() so that value is set correctly.\n  });\n  arrowElement.click(function () {\n    // Easier to toggle arrow value from within updateLinkStyle function than based on any kind of button state\n    mapModel.updateLinkStyle('mouse', currentLink.ideaIdFrom, currentLink.ideaIdTo, 'arrow', undefined);\n  });\n  // Removing so menu stays visible after mouse over or link change.\n  // element.mouseleave(element.hide.bind(element));\n  // });\n  return element;\n};\n","/*global require */\nconst jQuery = require('jquery');\n\nmodule.exports = function mapToolbarWidget(mapModel, toolbarElement) {\n// jQuery.fn.mapToolbarWidget = function (mapModel) {\n  'use strict';\n  const clickMethodNames =\n    // Removed: 'insertIntermediateGroup', 'openAttachment', 'setInputEnabled', // Because irrelevant or dysfunctional\n    ['downloadMap', 'resetView', 'scaleUp', 'scaleDown', 'addSubIdea', 'addGroupSubidea', 'editNode', 'removeSubIdea', 'insertIntermediate', 'toggleCollapse',\n      'undo', 'redo', 'cut', 'copy', 'paste', 'toggleAddLinkMode', 'insertRoot', 'makeSelectedNodeRoot'],\n    // No buttons for these:\n    // 'addSiblingIdea', 'activateChildren', 'activateNodeAndChildren', 'activateSiblingNodes', 'editIcon'],\n    // Removed 'updateStyle' // Not very useful and didn't always update background\n    changeMethodNames = [`readFile`],\n    jQToolbarWidgetElement = jQuery(toolbarElement);\n\n  let preventRoundtrip = false;\n\n  mapModel.addEventListener('nodeSelectionChanged', function () {\n    preventRoundtrip = true;\n    // TODO: Use getElementMJS() ?\n    jQToolbarWidgetElement.find('.updateStyle[data-mm-target-property]').val(function () {\n      return mapModel.getSelectedStyle(jQuery(this).data('mm-target-property'));\n    }).change();\n    preventRoundtrip = false;\n  });\n\n  mapModel.addEventListener('addLinkModeToggled', function () {\n    // TODO: Use getElementMJS()\n    jQToolbarWidgetElement.find('.toggleAddLinkMode').toggleClass('active');\n  });\n\n  clickMethodNames.forEach(function (methodName) {\n    const buttons = toolbarElement.getElementsByClassName(methodName);\n    for (const button of buttons) {\n      button.addEventListener('click', function () {\n        if (mapModel[methodName]) {\n          let button_data = button.dataset;\n          if (Object.keys(button_data).length === 0) {\n            button_data = undefined;\n          }\n          mapModel[methodName]('toolbar', button_data);\n        }\n      });\n    };\n  });\n\n  changeMethodNames.forEach(function (methodName) {\n    // TODO: Use getElementMJS()\n    jQToolbarWidgetElement.find('.' + methodName).change(function (event) {\n      if (preventRoundtrip) {\n        return;\n      }\n      const tool = jQuery(this);\n      if (tool.data('mm-target-property')) {\n        // QUESTION: could pass the tool rather than separate properties? Would give more flexibility for functions\n        //   Need to refactor called functions\n        // Calls methodName function within mapModel\n        // More flexible to pass whole dataset rather than specific properties\n        //   See clickMethodNames.forEach\n        mapModel[methodName]('toolbar', tool.data('mm-target-property'), tool.val(), event);\n      }\n    });\n  });\n  // });\n};\n","/*global require, module */\nconst _ = require('underscore');\nmodule.exports = function nodeCacheMark(idea, optional) {\n  'use strict';\n  const levelOverride = optional && optional.level,\n    theme = (optional && optional.theme),\n    isGroup = idea.attr && idea.attr.group;\n  return {\n    title: !isGroup && idea.title,\n    width: idea.attr && idea.attr.style && idea.attr.style.width,\n    theme: theme && theme.name,\n    icon: idea.attr && idea.attr.icon && _.pick(idea.attr.icon, 'width', 'height', 'position'),\n    collapsed: idea.attr && idea.attr.collapsed,\n    note: !!(idea.attr && idea.attr.note),\n    fontMultiplier: idea.attr && idea.attr.style && idea.attr.style.fontMultiplier,\n    styles: theme && theme.nodeStyles(idea.level || levelOverride, idea.attr),\n    level: idea.level || levelOverride\n  };\n};\n\n","/*global require*/\nconst jQuery = require('jquery');\nrequire('./hammer-draggable');\njQuery.fn.nodeResizeWidget = function (nodeId, mapModel, stagePositionForPointEvent) {\n  'use strict';\n  return this.each(function () {\n    let initialPosition,\n      initialWidth,\n      initialStyle;\n    const element = jQuery(this),\n      minAllowedWidth = 50,\n      nodeTextElement = element.find('span[data-mapjs-role=title]'),\n      nodeTextDOM = nodeTextElement[0],\n      stopEvent = function (evt) {\n        if (evt) {\n          evt.stopPropagation();\n        }\n        if (evt && evt.gesture) {\n          evt.gesture.stopPropagation();\n        }\n      },\n      calcDragWidth = function (evt) {\n        const pos = stagePositionForPointEvent(evt),\n          dx = pos && initialPosition && (pos.x - initialPosition.x),\n          dragWidth = dx && Math.max(minAllowedWidth, (initialWidth + dx));\n        return dragWidth;\n      },\n      dragHandle = jQuery('<div>').addClass('resize-node').shadowDraggable().on('mm:start-dragging mm:start-dragging-shadow', function (evt) {\n        if (!mapModel.isEditingEnabled()) {\n          return stopEvent(evt);\n        }\n        mapModel.selectNode(nodeId);\n        initialPosition = stagePositionForPointEvent(evt);\n        initialWidth = nodeTextElement.innerWidth();\n        initialStyle = {\n          'node.min-width': element.css('min-width'),\n          'span.min-width': nodeTextElement.css('min-width'),\n          'span.max-width': nodeTextElement.css('max-width')\n        };\n      }).on('mm:stop-dragging mm:cancel-dragging', function (evt) {\n        if (!mapModel.isEditingEnabled()) {\n          return stopEvent(evt);\n        }\n        const dragWidth = nodeTextElement.outerWidth();\n        nodeTextElement.css({ 'max-width': initialStyle['span.max-width'], 'min-width': initialStyle['span.min-width'] });\n        element.css('min-width', initialStyle['node.min-width']);\n        if (evt) {\n          evt.stopPropagation();\n        }\n        if (evt && evt.gesture) {\n          evt.gesture.stopPropagation();\n        }\n        element.trigger(jQuery.Event('mm:resize', { nodeWidth: dragWidth }));\n      }).on('mm:drag', function (evt) {\n        if (!mapModel.isEditingEnabled()) {\n          return stopEvent(evt);\n        }\n        let dragWidth = calcDragWidth(evt);\n        if (dragWidth) {\n          nodeTextElement.css({ 'max-width': dragWidth, 'min-width': dragWidth });\n          element.css('min-width', nodeTextElement.outerWidth());\n          if (nodeTextDOM.scrollWidth > nodeTextDOM.offsetWidth) {\n            dragWidth = nodeTextDOM.scrollWidth;\n            nodeTextElement.css({ 'max-width': dragWidth, 'min-width': dragWidth });\n            element.css('min-width', nodeTextElement.outerWidth());\n          }\n        }\n        stopEvent(evt);\n      });\n    dragHandle.appendTo(element);\n  });\n};\n","/*global require*/\nconst jQuery = require('jquery'),\n  nodeKey = require('../core/util/node-key');\n\njQuery.fn.nodeWithId = function (id) {\n  'use strict';\n  return this.find('#' + nodeKey(id));\n};\n\n","/*global require, window, document */\nconst jQuery = require('jquery');\njQuery.fn.placeCaretAtEnd = function () {\n  'use strict';\n\n  if (!window.getSelection || !document.createRange) {\n    return;\n  }\n  const el = this[0],\n    range = document.createRange(),\n    sel = window.getSelection();\n  range.selectNodeContents(el);\n  range.collapse(false);\n  sel.removeAllRanges();\n  sel.addRange(range);\n};\n\n","/*global require, setTimeout */\nconst jQuery = require('jquery');\njQuery.fn.queueFadeOut = function (theme) {\n  'use strict';\n  const element = this,\n    removeElement = () => {\n      if (element.is(':focus')) {\n        element.parents('[tabindex]').focus();\n      }\n      return element.remove();\n    };\n  if (!theme || theme.noAnimations()) {\n    return removeElement();\n  }\n  return element\n    .on('transitionend', removeElement)\n    .css('opacity', 0);\n  setTimeout(removeElement, 500);\n};\n\n","/*global require, window, document */\nconst jQuery = require('jquery');\njQuery.fn.selectAll = function () {\n  'use strict';\n  const el = this[0];\n  let range, sel, textRange;\n  if (window.getSelection && document.createRange) {\n    range = document.createRange();\n    range.selectNodeContents(el);\n    sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  } else if (document.body.createTextRange) {\n    textRange = document.body.createTextRange();\n    textRange.moveToElementText(el);\n    textRange.select();\n  }\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  _ = require('underscore');\njQuery.fn.setThemeClassList = function (classList) {\n  'use strict';\n  const domElement = this[0],\n    filterClasses = function (classes) {\n      return _.filter(classes, function (c) {\n        return /^level_.+/.test(c) || /^attr_.+/.test(c);\n      });\n    },\n    toRemove = filterClasses(domElement.classList),\n    toAdd = classList && classList.length && filterClasses(classList);\n  domElement.classList.remove.apply(domElement.classList, toRemove);\n  if (toAdd && toAdd.length) {\n    domElement.classList.add.apply(domElement.classList, toAdd);\n  }\n  return this;\n};\n\n","/*global module, require, PATH_FILE_CONFIG_MAPJS */\nconst createSVG = require('./create-svg'),\n  { default: CONFIG } = require(PATH_FILE_CONFIG_MAPJS),\n  getTextElement = function (parentElement, labelText, elementType, centrePoint) {\n    'use strict';\n    elementType = elementType || 'text';\n    let textElement = parentElement.find(elementType + '.mapjs-connector-text');\n    if (!labelText) {\n      textElement.remove();\n      return false;\n    } else {\n      if (textElement.length === 0) {\n        textElement = createSVG(elementType).attr('class', 'mapjs-connector-text');\n        if (centrePoint) {\n          textElement[0].style.transform = `translate(${centrePoint.x}px, ${centrePoint.y}px)`;\n        }\n        textElement.appendTo(parentElement);\n      }\n      return textElement;\n    }\n  },\n  updateConnectorText = function (parentElement, centrePoint, labelText, labelTheme) {\n    'use strict';\n    const g = getTextElement(parentElement, labelText, 'g', centrePoint),\n      rectElement = g && getTextElement(g, labelText, 'rect'),\n      textElement = g && getTextElement(g, labelText),\n      textDOM = textElement && textElement[0];\n\n    if (!textDOM) { // This has to be checked before trying to get linkDimensions.\n      return false;\n    };\n    let textDimensions = false;\n    // eslint-disable-next-line one-var\n    const rectDOM = rectElement && rectElement[0],\n      translate = {},\n      CONNECTOR_CLASS = CONFIG.connector.class,\n      linkDimensions = parentElement[0].getElementsByClassName(CONNECTOR_CLASS)[0].getClientRects()[0],\n      // Want connector label to be nearer parent node:\n      //   Again, this is more for argmap, so may not work well in other themes.\n      dleft = (linkDimensions.left - centrePoint.x),\n      dright = (linkDimensions.right - centrePoint.x);\n\n    textDOM.style.stroke = 'none';\n    textDOM.style.fill = labelTheme.text.color;\n    textDOM.style.fontSize = labelTheme.text.font.sizePx + 'px';\n    textDOM.style.fontWeight = labelTheme.text.font.weight;\n    textDOM.style.dominantBaseline = 'hanging';\n    textElement.text(labelText.trim());\n    textDimensions = textDOM.getClientRects()[0];\n\n    // translate.x number not very good, the mapjs-connector ClientRects.left and .right don't seem to relate to the actual boundary of the element.\n    // TODO: Not sure why not, might be that BoundingClientRect or BBox works better. Or might need to look up location of parent node instead.\n    // translate.x = Math.round(centrePoint.x - textDimensions.width / 2);\n    // translate.y = Math.round(centrePoint.y - textDimensions.height - 2);\n    translate.x = centrePoint.x + Math.round((Math.abs(dleft) < Math.abs(dright) ? dleft : dright)) / 100;\n    translate.y = Math.round(centrePoint.y - linkDimensions.height * 0.5);\n\n    g[0].style.transform = `translate(${translate.x}px, ${translate.y}px)`;\n    textDOM.setAttribute('x', 0); // Math.round(centrePoint.x - textDimensions.width / 2));\n    textDOM.setAttribute('y', 2); // Math.round(centrePoint.y - textDimensions.height));\n\n    // rectDOM.style.left = Math.round(centrePoint.x - textDimensions.width / 2);\n    // rectDOM.style.top = Math.round(centrePoint.y - textDimensions.height - 2);\n    rectDOM.setAttribute('x', 0); // Math.round(centrePoint.x - textDimensions.width / 2));\n    rectDOM.setAttribute('y', 0); // Math.round(centrePoint.y - textDimensions.height - 2));\n    rectDOM.setAttribute('height', Math.round(textDimensions.height));\n    rectDOM.setAttribute('width', Math.round(textDimensions.width));\n    rectDOM.style.fill = labelTheme.backgroundColor;\n    rectDOM.style.stroke = labelTheme.borderColor;\n    return textElement;\n  };\n\nmodule.exports = updateConnectorText;\n","/*global require */\n\nconst jQuery = require('jquery'),\n  createSVG = require('./create-svg'),\n  defaultTheme = require('../core/theme/default-theme'),\n  lineStrokes = require('../core/theme/line-strokes'),\n  convertPositionToTransform = require('../core/util/convert-position-to-transform'),\n  updateConnectorText = require('./update-connector-text'),\n  calcLabelCenterPont = require('./calc-label-center-point'),\n  buildConnection = require('../browser/build-connection'),\n  connectionIsUpdated = (element, connection, theme) => {\n    'use strict';\n    const connectionPropCheck = JSON.stringify(connection) + (theme && theme.name);\n    if (!connection || connectionPropCheck === element.data('changeCheck')) {\n      return false;\n    }\n    element.data('changeCheck', connectionPropCheck);\n    return connection;\n  };\nrequire('./get-data-box');\n\njQuery.fn.updateConnector = function (optional) {\n  'use strict';\n  const theme = optional && optional.theme;\n  return jQuery.each(this, function () {\n    let pathElement, hitElement;\n    const element = jQuery(this),\n      connectorAttr = element.data('attr'),\n      // TODO: Remove blockParentConnectorOverride once site has been live for a while\n      allowParentConnectorOverride = !theme || !(theme.connectorEditingContext || theme.blockParentConnectorOverride) || (theme.connectorEditingContext && theme.connectorEditingContext.allowed && theme.connectorEditingContext.allowed.length),\n      connection = buildConnection(element, optional),\n      applyLabel = function () {\n        const labelText = (connectorAttr && connectorAttr.label) || '',\n          shapeTo = labelText && element.data('nodeTo'),\n          shapeFrom = labelText && element.data('nodeFrom'),\n          labelTheme = (connection.theme && connection.theme.label) || defaultTheme.connector.default.label,\n          labelCenterPoint = labelText && calcLabelCenterPont(connection.position, shapeFrom.getDataBox(), shapeTo.getDataBox(), connection.d, labelTheme);\n        updateConnectorText(\n          element,\n          labelCenterPoint,\n          labelText,\n          labelTheme\n        );\n      };\n\n    if (!connection) {\n      element.remove();\n      return;\n    }\n\n    if (!connectionIsUpdated(element, connection, theme)) {\n      return;\n    }\n    element.data('theme', connection.theme);\n    element.data('position', Object.assign({}, connection.position));\n    pathElement = element.find('path.mapjs-connector');\n    hitElement = element.find('path.mapjs-link-hit');\n    element.css(Object.assign(convertPositionToTransform(connection.position), { stroke: connection.color }));\n    if (pathElement.length === 0) {\n      pathElement = createSVG('path').attr('class', 'mapjs-connector').appendTo(element);\n    }\n    // TODO: if the map was translated (so only the relative position changed), do not re-update the curve!\n    pathElement.attr({\n      'd': connection.d,\n      'stroke-width': connection.width,\n      'stroke-dasharray': lineStrokes[connection.lineStyle || 'solid'],\n      fill: 'transparent'\n    });\n    if (allowParentConnectorOverride) {\n      if (hitElement.length === 0) {\n        hitElement = createSVG('path').attr('class', 'mapjs-link-hit noTransition').appendTo(element);\n      }\n      hitElement.attr({\n        'd': connection.d,\n        'stroke-width': connection.width + 12\n      });\n    } else {\n      if (hitElement.length > 0) {\n        hitElement.remove();\n      }\n    }\n    applyLabel();\n  });\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  createSVG = require('./create-svg'),\n  convertPositionToTransform = require('../core/util/convert-position-to-transform'),\n  updateConnectorText = require('./update-connector-text'),\n  themeLink = require('../core/theme/link'),\n  calcLabelCenterPont = require('./calc-label-center-point'),\n  showArrows = function (connection, element) {\n    'use strict';\n    const arrowElements = element.find('path.mapjs-arrow');\n    if (connection.arrows && connection.arrows.length) {\n      //connection.arrow can be true, 'to', 'from', 'both'\n      connection.arrows.forEach((arrow, index) => {\n        let arrowElement = arrowElements.eq(index);\n        if (arrowElement.length === 0) {\n          arrowElement = createSVG('path').attr('class', 'mapjs-arrow').appendTo(element);\n        }\n        arrowElement\n          .attr({\n            d: arrow,\n            fill: connection.lineProps.color,\n            'stroke-width': connection.lineProps.width\n          })\n          .show();\n      });\n      arrowElements.slice(connection.arrows.length).hide();\n    } else {\n      arrowElements.hide();\n    }\n  };\n\nrequire('./get-data-box');\n\njQuery.fn.updateLink = function (optional) {\n  'use strict';\n  const linkBuilder = (optional && optional.linkBuilder) || themeLink,\n    theme = (optional && optional.theme);\n  return jQuery.each(this, function () {\n    const element = jQuery(this),\n      shapeFrom = element.data('nodeFrom'),\n      shapeTo = element.data('nodeTo'),\n      attrs = element.data('attr') || {},\n      applyLabel = function (connection, fromBox, toBox) {\n        const labelText = attrs.label || '',\n          labelTheme = connection.theme.label,\n          labelCenterPoint = labelText && calcLabelCenterPont(connection.position, fromBox, toBox, connection.d, labelTheme);\n        updateConnectorText(\n          element,\n          labelCenterPoint,\n          labelText,\n          labelTheme\n        );\n      };\n    let connection = false,\n      pathElement = element.find('path.mapjs-link'),\n      hitElement = element.find('path.mapjs-link-hit'),\n      fromBox = false, toBox = false, changeCheck = false;\n    if (!shapeFrom || !shapeTo || shapeFrom.length === 0 || shapeTo.length === 0) {\n      element.hide();\n      return;\n    }\n    fromBox = shapeFrom.getDataBox();\n    toBox = shapeTo.getDataBox();\n\n    connection = linkBuilder(fromBox, toBox, attrs, theme);\n    changeCheck = JSON.stringify(connection) + (theme && theme.name);\n    if (changeCheck === element.data('changeCheck')) {\n      return;\n    }\n    element.data('changeCheck', changeCheck);\n\n\n    element.data('theme', connection.theme);\n    element.data('position', Object.assign({}, connection.position));\n    element.css(Object.assign(convertPositionToTransform(connection.position), { stroke: connection.lineProps.color }));\n\n    if (pathElement.length === 0) {\n      pathElement = createSVG('path').attr('class', 'mapjs-link').appendTo(element);\n    }\n    pathElement.attr({\n      'd': connection.d,\n      'stroke-width': connection.lineProps.width,\n      'stroke-dasharray': connection.lineProps.strokes,\n      'stroke-linecap': connection.lineProps.linecap,\n      fill: 'transparent'\n    });\n\n    if (hitElement.length === 0) {\n      hitElement = createSVG('path').attr('class', 'mapjs-link-hit noTransition').appendTo(element);\n    }\n    hitElement.attr({\n      'd': connection.d,\n      'stroke-width': connection.lineProps.width + 12\n    });\n    showArrows(connection, element);\n    applyLabel(connection, fromBox, toBox);\n  });\n};\n\n","/*global require */\nconst jQuery = require('jquery'),\n  _ = require('underscore'),\n  URLHelper = require('../core/util/url-helper'),\n  formattedNodeTitle = require('../core/content/formatted-node-title'),\n  nodeCacheMark = require('./node-cache-mark'),\n  applyIdeaAttributesToNodeTheme = require('../core/content/apply-idea-attributes-to-node-theme'),\n  calcMaxWidth = require('../core/util/calc-max-width');\n\nrequire('./set-theme-class-list');\n\njQuery.fn.updateNodeContent = function (nodeContent, theme, optional) {\n  'use strict';\n  const resourceTranslator = optional && optional.resourceTranslator,\n    forcedLevel = optional && optional.level,\n    nodeTextPadding = (optional && optional.nodeTextPadding) || 11,\n    fixedLayout = (optional && optional.fixedLayout),\n    // theme = (optional && optional.theme),\n    self = jQuery(this),\n    textSpan = function () {\n      let span = self.find('[data-mapjs-role=title]');\n      if (span.length === 0) {\n        span = jQuery('<span>').attr('data-mapjs-role', 'title').appendTo(self);\n      }\n      return span;\n    },\n    decorations = function () {\n      let element = self.find('[data-mapjs-role=decorations]');\n      if (element.length === 0) {\n        element = jQuery('<div data-mapjs-role=\"decorations\" class=\"mapjs-decorations\">').on('mousedown click', function (e) {\n          e.stopPropagation();\n          e.stopImmediatePropagation();\n        }).appendTo(self);\n      }\n      return element;\n    },\n    applyLinkUrl = function (title) {\n      const url = URLHelper.getLink(title);\n      let element = self.find('a.mapjs-hyperlink');\n      if (!url) {\n        element.hide();\n        return;\n      }\n      if (element.length === 0) {\n        element = jQuery('<a target=\"_blank\" class=\"mapjs-hyperlink icon-hyperlink\"></a>').addClass().appendTo(decorations());\n      }\n      element.attr('href', url).show();\n    },\n    applyLabel = function (label) {\n      let element = self.find('.mapjs-label');\n      if (!label && label !== 0) {\n        element.hide();\n        return;\n      }\n      if (element.length === 0) {\n        element = jQuery('<span class=\"mapjs-label\"></span>').appendTo(decorations());\n      }\n      element.text(label).show();\n    },\n    // Removed since attachment code disabled.\n    // applyAttachment = function () {\n    //   const attachment = nodeContent.attr && nodeContent.attr.attachment;\n    //   let element = self.find('a.mapjs-attachment');\n    //   if (!attachment) {\n    //     element.hide();\n    //     return;\n    //   }\n    //   if (element.length === 0) {\n    //     element = jQuery('<a href=\"#\" class=\"mapjs-attachment icon-attachment\"></a>').\n    //       appendTo(decorations()).click(function () {\n    //         self.trigger('attachment-click');\n    //         self.trigger('decoration-click', 'attachment');\n    //       })\n    //       .trigger(jQuery.Event('attachment-link-created', { nodeId: nodeContent.id }));\n    //   }\n    //   element.show();\n    // },\n    applyNote = function () {\n      const note = nodeContent.attr && nodeContent.attr.note;\n      let element = self.find('a.mapjs-note');\n      if (!note) {\n        element.hide();\n        return;\n      }\n      if (element.length === 0) {\n        element = jQuery('<a href=\"#\" class=\"mapjs-note icon-note\"></a>').appendTo(decorations()).click(function () {\n          self.trigger('decoration-click', 'note');\n        });\n      }\n      element.show();\n    },\n    level = forcedLevel || 1,\n    styles = nodeContent.styles || (theme && theme.nodeStyles(level, nodeContent.attr)) || [],\n    nodeTheme = theme && theme.nodeTheme && applyIdeaAttributesToNodeTheme(nodeContent, theme.nodeTheme(styles)),\n    updateTextStyle = function () {\n      if (nodeTheme && nodeTheme.hasFontMultiplier) {\n        self.css({\n          'font-size': nodeTheme.font.size + 'pt'\n        });\n      } else {\n        self.css({ 'font-size': '' });\n      }\n      if (nodeTheme && nodeTheme.text && nodeTheme.text.alignment) {\n        self.css('text-align', nodeTheme.text.alignment);\n      } else {\n        self.css('text-align', '');\n      }\n    },\n    updateText = function (title) {\n      const text = formattedNodeTitle(title, 25),\n        element = textSpan(),\n        domElement = element[0],\n        preferredWidth = nodeContent.attr && nodeContent.attr.style && nodeContent.attr.style.width;\n      let height;\n\n      element.text(text.trim());\n      self.data('title', title);\n      element.css({ 'max-width': '', 'min-width': '' });\n      if (preferredWidth) {\n        element.css({ 'max-width': preferredWidth, 'min-width': preferredWidth });\n      }\n      if ((domElement.scrollWidth - nodeTextPadding) > domElement.offsetWidth) {\n        element.css('max-width', domElement.scrollWidth + 'px');\n      } else if (!preferredWidth) {\n        height = domElement.offsetHeight;\n        element.css('min-width', nodeContent.textWidth || element.css('max-width'));\n        if (domElement.offsetHeight === height) {\n          element.css('min-width', '');\n        }\n      }\n    },\n    setCollapseClass = function () {\n      if (nodeContent.attr && nodeContent.attr.collapsed) {\n        self.addClass('collapsed');\n      } else {\n        self.removeClass('collapsed');\n      }\n    },\n    setColors = function (colorText) {\n      self.removeClass('mapjs-node-colortext mapjs-node-transparent');\n      self.css({ 'color': nodeTheme.text.color, 'background-color': nodeTheme.backgroundColor });\n\n      if (colorText) {\n        self.addClass('mapjs-node-colortext');\n      }\n      if (!nodeTheme || !nodeTheme.backgroundColor || nodeTheme.backgroundColor === 'transparent') {\n        self.addClass('mapjs-node-transparent');\n      }\n    },\n    setIcon = function (icon) {\n      let textHeight,\n        textWidth,\n        maxTextWidth;\n      const textBox = textSpan(),\n        selfProps = {\n          'min-height': '',\n          'min-width': '',\n          'background-image': '',\n          'background-repeat': '',\n          'background-size': '',\n          'background-position': ''\n        },\n        textProps = {\n          'margin-top': '',\n          'margin-left': ''\n        },\n        padding = (nodeTheme && nodeTheme.margin) || 10;\n      self.css({ padding: '' });\n      if (icon) {\n        textHeight = textBox.outerHeight();\n        textWidth = textBox.outerWidth();\n        maxTextWidth = calcMaxWidth(nodeContent.attr, nodeTheme);\n        _.extend(selfProps, {\n          'background-image': 'url(\"' + (resourceTranslator ? resourceTranslator(icon.url) : icon.url) + '\")',\n          'background-repeat': 'no-repeat',\n          'background-size': icon.width + 'px ' + icon.height + 'px',\n          'background-position': 'center center'\n        });\n        if (icon.position === 'top' || icon.position === 'bottom') {\n          if (icon.position === 'top') {\n            selfProps['background-position'] = 'center ' + padding + 'px';\n          } else if (fixedLayout) {\n            selfProps['background-position'] = 'center ' + (padding + textHeight) + 'px';\n          } else {\n            selfProps['background-position'] = 'center ' + icon.position + ' ' + padding + 'px';\n          }\n\n          selfProps['padding-' + icon.position] = icon.height + (padding * 2);\n          selfProps['min-width'] = icon.width;\n          if (icon.width > maxTextWidth) {\n            textProps['max-width'] = `${icon.width}px`;\n          }\n        } else if (icon.position === 'left' || icon.position === 'right') {\n          if (icon.position === 'left') {\n            selfProps['background-position'] = padding + 'px center';\n          } else if (fixedLayout) {\n            selfProps['background-position'] = (textWidth + (2 * padding)) + 'px center ';\n          } else {\n            selfProps['background-position'] = icon.position + ' ' + padding + 'px center';\n          }\n\n          selfProps['padding-' + icon.position] = icon.width + (padding * 2);\n          if (icon.height > textHeight) {\n            textProps['margin-top'] = Math.round((icon.height - textHeight) / 2);\n            selfProps['min-height'] = icon.height;\n          }\n        } else {\n          if (icon.height > textHeight) {\n            textProps['margin-top'] = Math.round((icon.height - textHeight) / 2);\n            selfProps['min-height'] = icon.height;\n          }\n          selfProps['min-width'] = icon.width;\n          if (icon.width > maxTextWidth) {\n            textProps['max-width'] = `${icon.width}px`;\n          }\n        }\n      }\n      self.css(selfProps);\n      textBox.css(textProps);\n    },\n    nodeLevel = forcedLevel || nodeContent.level,\n    themeDefault = function (a, b, c, d) {\n      return d;\n    },\n    styleDefault = function () {\n      return ['default'];\n    },\n    attrValue = (theme && theme.attributeValue) || themeDefault,\n    nodeStyles = (theme && theme.nodeStyles) || styleDefault,\n    effectiveStyles = nodeStyles(nodeLevel, nodeContent.attr),\n    borderType = attrValue(['node'], effectiveStyles, ['border', 'type'], 'surround'),\n    decorationEdge = attrValue(['node'], effectiveStyles, ['decorations', 'edge'], ''),\n    decorationOverlap = attrValue(['node'], effectiveStyles, ['decorations', 'overlap'], ''),\n    colorText = (borderType !== 'surround'),\n    isGroup = nodeContent.attr && nodeContent.attr.group,\n    nodeCacheData = {\n      x: Math.round(nodeContent.x),\n      y: Math.round(nodeContent.y),\n      width: Math.round(nodeContent.width),\n      textWidth: Math.round(nodeContent.textWidth),\n      height: Math.round(nodeContent.height),\n      nodeId: nodeContent.id,\n      styles: effectiveStyles,\n      parentConnector: nodeContent && nodeContent.attr && nodeContent.attr.parentConnector\n    };\n\n\n  let offset;\n\n\n\n\n  nodeCacheData.innerRect = _.pick(nodeCacheData, ['width', 'height']);\n  nodeCacheData.innerRect.dx = 0;\n  nodeCacheData.innerRect.dy = 0;\n\n  updateTextStyle();\n  if (isGroup) {\n    this.css({ margin: '', width: nodeContent.width, height: nodeContent.height, opacity: 1 });\n    updateText('');\n  } else {\n    updateText(nodeContent.title);\n    if (optional && optional.decorations && !optional.decorations.includes(decorationEdge)) {\n      decorations().empty();\n    } else {\n      applyLinkUrl(nodeContent.title);\n      applyLabel(nodeContent.label);\n      applyNote();\n      // Removed since attachment code disabled.\n      // applyAttachment();\n    };\n    this.css({ margin: '', width: '', height: '', opacity: 1 });\n    if (decorationEdge === 'left') {\n      nodeCacheData.innerRect.dx = decorations().outerWidth();\n      nodeCacheData.innerRect.width = nodeCacheData.width - decorations().outerWidth();\n      self.css('margin-left', decorations().outerWidth());\n    } else if (decorationEdge === 'right') {\n      nodeCacheData.innerRect.width = nodeCacheData.width - decorations().outerWidth();\n      self.css('margin-right', decorations().outerWidth());\n    } else if (decorationEdge === 'bottom') {\n      offset = decorations().outerHeight() * (decorationOverlap ? 0.5 : 1);\n      nodeCacheData.innerRect.height = nodeCacheData.height - offset;\n      self.css('margin-bottom', decorations().outerHeight() * (decorationOverlap ? 0.5 : 1));\n    }\n  }\n\n  self.setThemeClassList(effectiveStyles).attr('mapjs-level', nodeLevel);\n\n  self.data(nodeCacheData);\n  self.data('nodeCacheMark', nodeCacheMark(nodeContent, Object.assign({ theme: theme }, optional)));\n  setColors(colorText);\n  setIcon(nodeContent.attr && nodeContent.attr.icon);\n  setCollapseClass();\n  self.trigger('mapjs:resize');\n  return self;\n};\n\n","/*global require */\nconst jQuery = require('jquery');\njQuery.fn.updateReorderBounds = function (border, box, dropCoords) {\n  'use strict';\n  const element = this;\n  if (!border) {\n    element.hide();\n    return;\n  }\n  element.show();\n  element.attr('mapjs-edge', border.edge);\n  if (border.edge === 'top') {\n    element.css({\n      top: border.minY,\n      left: Math.round(dropCoords.x - element.width() / 2)\n    });\n  } else {\n    element.css({\n      top: Math.round(dropCoords.y - element.height() / 2),\n      left: border.x - (border.edge === 'left' ? element.width() : 0)\n    });\n  }\n\n};\n","/*global require */\nconst jQuery = require('jquery');\njQuery.fn.updateStage = function () {\n  'use strict';\n  const data = this.data(),\n    size = {\n      'min-width': Math.round(data.width - data.offsetX),\n      'min-height': Math.round(data.height - data.offsetY),\n      'width': Math.round(data.width - data.offsetX),\n      'height': Math.round(data.height - data.offsetY),\n      'transform-origin': 'top left',\n      // This change is so the argmap theme's root node is near the top of the container, might not be so good for regular mind-map layout.\n      // 'transform': 'translate3d(' + Math.round(data.offsetX) + 'px, ' + Math.round(data.offsetY) + 'px, 0)'\n      'transform': 'translate3d(' + Math.round(data.offsetX) + 'px, 30%, 0)'\n    },\n    svgContainer = this.find('[data-mapjs-role=svg-container]')[0];\n  if (data.scale && data.scale !== 1) {\n    // size.transform = 'scale(' + data.scale + ') translate(' + Math.round(data.offsetX) + 'px, ' + Math.round(data.offsetY) + 'px)';\n    size.transform = 'scale(' + data.scale + ') translate(' + Math.round(data.offsetX) + 'px, 30%)';\n  }\n  this.css(size);\n  if (svgContainer) {\n    svgContainer.setAttribute('viewBox',\n      '' + Math.round(-1 * data.offsetX) + ' ' + Math.round(-1 * data.offsetY) + ' ' + Math.round(data.width) + ' ' + Math.round(data.height)\n    );\n    svgContainer.setAttribute('style',\n      'top:' + Math.round(-1 * data.offsetY) + 'px; ' +\n      'left:' + Math.round(-1 * data.offsetX) + 'px; ' +\n      'width:' + Math.round(data.width) + 'px; ' +\n      'height:' + Math.round(data.height) + 'px;'\n    );\n  }\n  return this;\n};\n\n","/*global module, require */\n\nrequire('./browser/dom-map-widget');\nrequire('./browser/map-toolbar-widget');\nrequire('./browser/link-edit-widget');\nrequire('./browser/image-drop-widget');\n\nmodule.exports = {\n  MemoryClipboard: require('./core/clipboard'),\n  MapModel: require('./core/map-model'),\n  ImageInsertController: require('./browser/image-insert-controller'),\n  content: require('./core/content/content'),\n  observable: require('./core/util/observable'),\n  DomMapController: require('./browser/dom-map-controller'),\n  MapToolbarWidget: require('./browser/map-toolbar-widget.js'),\n  LinkEditWidget: require('./browser/link-edit-widget.js'),\n  ThemeProcessor: require('./core/theme/theme-processor'),\n  Theme: require('./core/theme/theme'),\n  defaultTheme: require('./core/theme/default-theme'),\n  formatNoteToHtml: require('./core/content/format-note-to-html'),\n  version: 4\n};\n\n/* Copyright 2013 Damjan Vujnovic, David de Florinier, Gojko Adzic; 2022 Michael Hayes; and the mapjs contributors.\n   SPDX - License - Identifier: MIT */\n","/* Copyright 2013 Damjan Vujnovic, David de Florinier, Gojko Adzic; 2022 Michael Hayes; and the mapjs contributors\n   SPDX - License - Identifier: MIT */\n/* mapjs entry point: Initialises mapjs obections, loads JSON and embeds visualisation into a container. */\n\n/*global require, document, window, console, idea, PATH_FILE_CONFIG_MAPJS, process */\nconst Utilities = require('./core/util/mapjs-utilities'),\n  MAPJS = require('./npm-main'),\n  { default: CONFIG } = require(PATH_FILE_CONFIG_MAPJS),\n  // TODO: Enable and merge this once mapjs_map.id needed\n  // { default: CONFIG2 } = require(PATH_FILE_CONFIG_MAPJS_PROCESSED),\n  // Might help:\n  //   - https://stackoverflow.com/questions/63462577/how-to-load-multiple-yaml-files-at-once-in-javascript\n  //   - https://github.com/survivejs/webpack-merge\n  CONTAINER_CLASS = CONFIG.mapjs_map.class,\n  INSTANCE_CLASS = CONFIG.mapjs_instance.class,\n  MAPJS_SRC_CLASS = CONFIG.mapjs_src_data.class,\n  trycatch = Utilities.trycatch;\n\nUtilities.Logger.log(process.env.NODE_ENV + ' mode');\n\n// QUESTION: Can I loop through these somehow instead without having to know the name of each one?\n//   new MAPJS.Theme[x] ?\n// To change, call e.g. changeTheme(map, MAPJS.v1)\nMAPJS.arg = require('../src/themes/argmap-theme.json');\nMAPJS.argumentMapping = require('../src/themes/mapjs-argument-mapping.json');\nMAPJS.topdown = require('../src/themes/top-down-simple.json');\nMAPJS.compact = require('../src/themes/compact.json');\nMAPJS.v1 = require('../src/themes/v1.json');\n\nconst jQuery = require('jquery'),\n  themeProvider = require('../src/theme'),\n  content = MAPJS.content,\n  mapInstance = {}, // New object for keeping data for keeping various mapjs objects separate\n\n  // Injects Theme CSS into page\n  // So can't easily make themes independent for each container without making css directives container independent\n  layoutThemeStyle = function (themeJson) {\n    'use strict';\n    const themeCSS = themeJson && new MAPJS.ThemeProcessor().process(themeJson).css;\n    if (!themeCSS) {\n      return false;\n    }\n\n    // Used to only apply if there wasn't already a theme, but now we want to replace it\n    if (window.themeCSS) {\n      jQuery('#themeCSS')[0].remove();\n    }\n    jQuery('<style id=\"themeCSS\" type=\"text/css\"></style>').appendTo('head').text(themeCSS);\n\n    return true;\n  },\n\n  // Changes theme of all maps on page\n  //   To change, call e.g. changeTheme(map, MAPJS.v1)\n  //   TODO: Move to mapModel.changeTheme() in map-model.js\n  //   TODO: Make this apply to a specific map only\n  // eslint-disable-next-line strict\n  changeTheme = function (map, themeJson = themeProvider.default) {\n    // QUESTION: Should I build this into function in case themeJson invalid?\n    //   themeJson = themeProvider.default || MAPJS.defaultTheme;\n    // QUESTION: Should I add getTheme to map?\n    const theme = new MAPJS.Theme(themeJson),\n      getTheme = () => theme;\n    map.mapModel.setThemeSource(getTheme);\n    layoutThemeStyle(themeJson);\n\n    // Can't reset map with setIdea if domMapController hasn't been defined yet\n    //   This is run at start of init(), so why is it undefined on first run?\n    //     let domMapController = false;\n    // Could check for whether mapModel has a layoutCalculator function instead\n    if (map && typeof map.domMapController !== 'undefined') {\n      // ISSUE: This call breaks on second map, I guess since layout calculator wasn't set for new domMapController\n      // So really need to check for layout calculator\n      map.mapModel.setIdea(idea);\n    }\n\n    return getTheme;\n  },\n\n  // Add a (ideally) separate map to each container div on the page.\n  addMap = function (instanceElement, mapJson) {\n    'use strict';\n    const containerElement = Utilities.getElementMJS(CONTAINER_CLASS, instanceElement),\n      // QUESTION: Do we need a separate mapModel for each map?\n      //   Or are there generic methods I can separate out from object ones?\n      map = mapInstance[containerElement.id] = {};\n    map.mapModel = new MAPJS.MapModel([]);\n    // So it's easier to look up containerElement from mapModel:\n    //  Useful because unfortunately, element ids only unique per container\n    map.mapModel.containerElement = containerElement;\n\n    // Hacky solution so that I can call content from map-model.js: loadMap\n    map.mapModel.content = content;\n\n    // eslint-disable-next-line one-var\n    const jQcontainer = jQuery(containerElement),\n      JQinstance = jQuery(instanceElement),\n      // Do I need one of these for each container?\n      imageInsertController = new MAPJS.ImageInsertController('http://localhost:4999?u='),\n      idea = content(mapJson),\n      touchEnabled = false,\n\n      // Easier to maintain theme file so making that default:\n      themeJson = MAPJS.arg || idea.theme || themeProvider.default || MAPJS.defaultTheme,\n      getTheme = changeTheme(map, themeJson),\n\n      // Set up Widgets\n      containerInstance = containerElement.parentElement,\n      // TODO define both config variables at top\n      toolbarElement = trycatch(\n        () => Utilities.getElementMJS(CONFIG.toolbar_main.class, containerInstance),\n      ),\n      linkEditWidgetElement = trycatch(\n        () => Utilities.getElementMJS(CONFIG.toolbar_edit_links.class, containerInstance),\n      );\n    ;\n\n    // Obsolete now // Obsolete now attachmentEditorWidget UI disabled\n    // TODO: Might only need one of these for the whole page, rather than for each container:\n    // jQuery.fn.attachmentEditorWidget = function (mapModel) {\n    //   return this.each(function () {\n    //     mapModel.addEventListener('attachmentOpened', function (nodeId, attachment) {\n    //       mapModel.setAttachment(\n    //         'attachmentEditorWidget',\n    //         nodeId, {\n    //           contentType: 'text/html',\n    //           content: window.prompt('attachment', attachment && attachment.content)\n    //         });\n    //     });\n    //   });\n    // };\n\n    JQinstance.domMapWidget(console, map.mapModel, touchEnabled, imageInsertController);\n\n    // different stage for each container so need to have one for each container\n    // Using container.id as index for relevant controller\n    map.domMapController = new MAPJS.DomMapController(\n      map.mapModel,\n      jQcontainer.find('[data-mapjs-role=stage]'),\n      touchEnabled,\n      imageInsertController,\n      undefined, // resourceTranslator\n      getTheme\n    );\n\n    // QUESTION: Do I need to store mapToolbarWidget and linkEditWidget?\n    map.mapToolbarWidget = new MAPJS.MapToolbarWidget(map.mapModel, toolbarElement);\n\n    // Obsolete now attachmentEditorWidget UI disabled\n    // TODO: Do this without jQcontainer\n    // jQcontainer.attachmentEditorWidget(map.mapModel);\n\n    map.linkEditWidget = new MAPJS.LinkEditWidget(map.mapModel, linkEditWidgetElement);\n\n    // Draw map\n    map.mapModel.setIdea(idea);\n\n    jQuery('.arrow').click(function () {\n      jQuery(this).toggleClass('active');\n    });\n\n    imageInsertController.addEventListener('imageInsertError', function (reason) {\n      Utilities.Logger.error('image insert error', reason);\n    });\n\n    jQcontainer.on('drop', function (e) {\n      // QUESTION: Should maybe separate this into a callable function so that it can be used as general file import function?\n      const current_map = mapInstance[this.id],\n        current_mapModel = current_map.mapModel,\n        dataTransfer = e.originalEvent.dataTransfer;\n\n      // QUESTION: What happens if I comment these out?\n      e.stopPropagation();\n      e.preventDefault();\n\n      if (current_mapModel.getInputEnabled()) {\n        if (dataTransfer && dataTransfer.files && dataTransfer.files.length > 0) {\n          const fileInfo = dataTransfer.files[0];\n          if (/\\.(json|mup)$/.test(fileInfo.name)) {\n            const oFReader = new window.FileReader();\n            oFReader.onload = function (oFREvent) {\n              // const current_map = mapInstance[this.target_container_id],\n              // current_mapModel = current_map.mapModel,\n              const container_idea = current_mapModel.getIdea(),\n                // Borrowed from image-drop-widget.js\n                // TODO: Should combine into one function\n                stageDropCoordinates = current_map.domMapController.stagePositionForPointEvent(e),\n                // QUESTION: why return node id and not reference to node in getNodeIdAtPosition()?\n                // Would avoid issues with ambiguous node IDs\n                nodeAtDrop = stageDropCoordinates && current_mapModel.getNodeIdAtPosition(stageDropCoordinates.x, stageDropCoordinates.y),\n                pasteNode = (typeof (nodeAtDrop) !== 'undefined') ? nodeAtDrop : 'root';   // This is where new map will get pasted\n\n              // Less destructive to paste JSON file data into container as new map(s), instead of replacing existing map.\n              // TODO: However, paste doesn't include links, themes etc\n              //   Or is that just because we use parse().ideas only?\n              // QUESTION: worth returning a result value from pasteMultiple?\n              container_idea.pasteMultiple(pasteNode, JSON.parse(oFREvent.target.result).ideas);\n            };\n            // This passes the target container's id to the File Reader window:\n            //  QUESTION: Is there a better way of doing this?\n            oFReader.target_container_id = e.delegateTarget.id;\n            oFReader.readAsText(fileInfo, 'UTF-8');\n          }\n        };\n      }\n    });\n  },\n\n  init = function () {\n    'use strict';\n\n    const instanceElements = Utilities.getElementMJS(INSTANCE_CLASS, document, true);\n\n    if (instanceElements.length > 0) { // Checks there are mapjs requests\n      for (const instanceElement of instanceElements) {\n        // TODO: check for 0 > script > 1\n        //  See https://stackoverflow.com/questions/1474089/how-to-select-a-single-child-element-using-jquery#answer-1474103\n        const script_src = Utilities.getElementMJS(MAPJS_SRC_CLASS, instanceElement).getAttribute('src');\n\n        // TODO: switch to await/async for simpler code and debugging.\n        // QUESTION: How does drag and drop solution (window.FileReader()) compare to this one? Or do I have to use fetch here because source is not necessarily local?\n        fetch(script_src)\n          .then(response => response.json())\n          .then(data => addMap(instanceElement, data))\n          .catch(error => Utilities.Logger.error(error));\n      }\n      window.onerror = Utilities.Logger.error;\n      window.jQuery = jQuery;\n      window.mapInstance = mapInstance;\n    } else { // If no mapjs requests:\n      Utilities.Logger.warn(\"No mapjs containers found in web page's source html.\");\n    };\n  };\n\ndocument.addEventListener('DOMContentLoaded', init);\n\n// // Hacky way to test\n// window.setTimeout(function () {\n//   b = document.getElementById(\"submit\");\n//   if (b) {\n//     // Automatically click button to speed up testing\n//     b.click();\n//   }\n// }, 400 /* but after 400 ms */);\n\n","/*global module */\nmodule.exports = {};\nmodule.exports.default =  {\n  'name': 'MindMup V1',\n  'node': [{\n    'name': 'default',\n    'cornerRadius': 10.0,\n    'backgroundColor': '#E0E0E0',\n    'border': {\n      'type': 'surround',\n      'line': {\n        'color': '#707070',\n        'width': 1.0\n      }\n    },\n    'shadow': [{\n      'color': '#070707',\n      'opacity': 0.4,\n      'offset': {\n        'width': 2,\n        'height': 2\n      },\n      'radius': 2\n    }],\n    'text': {\n      'margin': 5.0,\n      'alignment': 'center',\n      'color': '#4F4F4F',\n      'lightColor': '#EEEEEE',\n      'darkColor': '#000000',\n      'font': {\n        'lineSpacing': 2.5,\n        'size': 9,\n        'weight': 'bold'\n      }\n    },\n    'connections': {\n      'default': {\n        'h': 'center',\n        'v': 'center'\n      },\n      'from': {\n        'horizontal': {\n          'h': 'nearest-inset',\n          'v': 'center'\n        }\n      },\n      'to': {\n        'h': 'nearest',\n        'v': 'center'\n      }\n    },\n    'decorations': {\n      'height': 20,\n      'edge': 'top',\n      'overlap': true,\n      'position': 'end'\n    }\n  },\n  {\n    'name': 'level_1',\n    'backgroundColor': '#22AAE0'\n  },\n  {\n    'name': 'activated',\n    'border': {\n      'type': 'surround',\n      'line': {\n        'color': '#22AAE0',\n        'width': 3.0,\n        'style': 'dotted'\n      }\n    }\n  },\n  {\n    'name': 'level_1.activated',\n    'border': {\n      'type': 'surround',\n      'line': {\n        'color': '#EEEEEE',\n        'width': 3.0,\n        'style': 'dotted'\n      }\n    }\n  },\n  {\n    'name': 'selected',\n    'shadow': [{\n      'color': '#000000',\n      'opacity': 0.9,\n      'offset': {\n        'width': 2,\n        'height': 2\n      },\n      'radius': 2\n    }]\n  },\n  {\n    'name': 'collapsed',\n    'shadow': [{\n      'color': '#888888',\n      'offset': {\n        'width': 0,\n        'height': 1\n      },\n      'radius': 0\n    },\n    {\n      'color': '#FFFFFF',\n      'offset': {\n        'width': 0,\n        'height': 3\n      },\n      'radius': 0\n    },\n    {\n      'color': '#888888',\n      'offset': {\n        'width': 0,\n        'height': 4\n      },\n      'radius': 0\n    },\n    {\n      'color': '#FFFFFF',\n      'offset': {\n        'width': 0,\n        'height': 6\n      },\n      'radius': 0\n    },\n    {\n      'color': '#888888',\n      'offset': {\n        'width': 0,\n        'height': 7\n      },\n      'radius': 0\n    }\n    ]\n  },\n  {\n    'name': 'collapsed.selected',\n    'shadow': [{\n      'color': '#FFFFFF',\n      'offset': {\n        'width': 0,\n        'height': 1\n      },\n      'radius': 0\n    },\n    {\n      'color': '#888888',\n      'offset': {\n        'width': 0,\n        'height': 3\n      },\n      'radius': 0\n    },\n    {\n      'color': '#FFFFFF',\n      'offset': {\n        'width': 0,\n        'height': 6\n      },\n      'radius': 0\n    },\n    {\n      'color': '#555555',\n      'offset': {\n        'width': 0,\n        'height': 7\n      },\n      'radius': 0\n    },\n    {\n      'color': '#FFFFFF',\n      'offset': {\n        'width': 0,\n        'height': 10\n      },\n      'radius': 0\n    },\n    {\n      'color': '#333333',\n      'offset': {\n        'width': 0,\n        'height': 11\n      },\n      'radius': 0\n    }\n    ]\n  },\n  {\n    'name': 'attr_group_supporting',\n    'backgroundColor': '#00FF00'\n  },\n  {\n    'name': 'attr_group_opposing',\n    'backgroundColor': '#FF0000'\n  }\n  ],\n  'connector': {\n    'default': {\n      'type': 'quadratic',\n      label: {\n        backgroundColor: 'transparent',\n        borderColor: 'transparent',\n        position: {\n          ratio: 0.5\n        },\n        text: {\n          color: '#4F4F4F',\n\n          font: {\n            size: 9,\n            sizePx: 12,\n            weight: 'normal'\n          }\n        }\n      },\n      'controlPoint': {\n        'above': { 'width': 0, 'height': 0.75 },\n        'below': { 'width': 0, 'height': 0.75 },\n        'horizontal': { 'width': 0, 'height': 0 }\n      },\n      'line': {\n        'color': '#707070',\n        'width': 1.0\n      }\n    }\n  }\n};\n\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunk_s6mike_mapjs\"] = self[\"webpackChunk_s6mike_mapjs\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [736], () => (__webpack_require__(714)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["deferred","argmap_collection","tag","argmap_grouping","parent","mapjs_instance","mapjs_map","id","mapjs_src_data","src","mapjs_control","role","toolbar_main","aria_label","toolbar_edit_links","toolbar_fileButton","node","connector","module","exports","clone","something","JSON","parse","stringify","contents","this","get","put","c","foregroundStyle","idea","nodeTheme","attr","style","fontMultiplier","textAlign","colorSetByUser","setByUser","background","isColorSetByUser","colorText","borderType","text","color","backgroundColor","Object","assign","alignment","hasFontMultiplier","font","Math","abs","size","lineSpacing","sizePx","lineSpacingPx","calcIdeaLevel","_","traverse","recalcAutoNodeAttrs","activeContent","themeObj","level","numberOfSiblings","updatedAttr","getPersistedAttributes","removed","forEach","key","updateAttr","keys","recalcIdeasAutoNodeAttrs","Logger","debug","ideas","siblingIndex","childIdeaKey","addSubIdea","parentId","ideaTitle","optionalNewId","optionalIdeaAttr","parentLevel","parentIdea","findSubIdeaById","length","attrs","attrsToSave","isEmpty","undefined","changeParent","ideaId","newParentId","newParent","batch","childSiblings","insertIntermediateMultiple","inFrontOfIdeaIds","ideaOptions","ideaOptionsSafe","extend","inFrontOfIdeaId","inFrontOfIdea","insertAttr","siblingIds","sameSideSiblingIds","result","siblings","movedIdeaId","movedIdea","pasteMultiple","existingSiblings","subIdea","cleanPersistedAttributes","pastedIds","pastedId","contentIdea","nodeId","currentLevel","find","reduce","content","doUpgrade","collapsed","each","formatVersion","upgradeV2","rootAttrKeys","oldRootAttr","newRootAttr","pick","newRootNodeAttr","omit","firstLevel","newRoot","title","observable","contentUpgrade","contentAggregate","initialSessionId","cachedId","sessionKey","configuration","isRedoInProgress","handleRangeError","e","calling_function_name","RangeError","dir","error","logMyErrors","invalidateIdCache","maxId","subidea","max","parseInt","nextId","originSession","init","initOfRoot","value","group","parseFloat","containsDirectChild","findChildRankById","childIdeaId","res","isEmptyGroup","isRootNode","deleteIfEmptyGroup","commandProcessors","removeSubIdea","predicate","current","union","getAttr","name","sortedSubIdeas","childKeys","groupBy","map","sortedChildKeys","sortBy","concat","push","iterator","postOrder","maxKey","kvMap","sign","currentKeys","x","appendSubIdea","rank","newRank","counts","childRankSign","countBy","v","k","nextChildRank","findIdeaById","sameSideSiblingRanks","ideaRank","reject","number","eventStacks","redoStacks","batches","notifyChange","method","args","dispatchEvent","logChange","undofunc","event","eventMethod","eventArgs","undoFunction","reorderChild","oldRank","uniqueResourcePostfix","replace","r","random","toString","object","attrName","attrValue","oldAttr","isObject","isEqual","findLinkDirectional","ideaIdFrom","ideaIdTo","links","link","setConfiguration","config","getSessionKey","setSessionKey","newSessionKey","isBatchActive","nextSiblingId","subIdeaId","findParent","currentRank","candidateSiblingRanks","siblingsAfter","min","without","i","getAttrById","previousSiblingId","siblingsBefore","toClone","cloneMultiple","subIdeaIdArray","calculatePath","currentPath","potentialParent","child","getSubTreeIds","rootIdeaId","collectIds","child_rank","isNaN","startBatch","activeSession","endBatch","discardBatch","inBatch","batchArgs","batchUndoFunctions","f","idx","eventUndo","performBatchOperations","execCommand","cmd","apply","toArray","batchOp","hasActiveBatch","results","arguments","slice","parentIdeaId","jsonArrayToPaste","json","paste","jsonToPaste","initialId","pasteParent","cleanUp","index","nonClonedAttributes","newIdea","dotIndex","String","indexOf","substr","sessionFromId","flip","performFlip","initialiseTitle","originalTitle","prev","pop","executeOutsideBatch","appendChange","updateTitle","optionalAttr","params","createIdeaParams","performAdd","removeMultiple","oldIdea","oldLinks","removedNodeIds","traversed","performRemove","idArray","newId","insertIntermediate","childRank","performInsert","oldParent","oldPosition","performChangeParent","mergeAttrProperty","attrPropertyName","attrPropertyValue","val","undoAction","getOrderedSiblingRanks","options","ignoreRankSide","moveRelative","relativeMovement","siblingRanks","currentIndex","newIndex","calcIndex","calcNewIndex","beforeRank","beforeSibling","positionBefore","positionBeforeIdeaId","parentIdeaArg","afterRank","candidateSiblings","maxRank","addLink","lineStyle","arrow","ideaFrom","ideaTo","isParentChild","isLinkValid","findLinkBetween","removeLink","ideaIdOne","ideaIdTwo","splice","getLinkAttr","updateLinkAttr","canUndo","canRedo","undo","topEvent","redo","storeResource","resourceBody","optionalKey","resources","getExistingResourceId","filteredKeys","filter","RegExp","prototype","test","bind","intKeys","string","maxIdForSession","storeNewResource","getResource","hasSiblings","getDefaultRootId","rootNodes","values","URLHelper","noteText","safeString","escape","formatLinks","urlHelper","nodeTitle","maxUrlLength","trim","sanitizedTitle","cleanNonPrintable","withoutLinks","strippedTitle","stripLink","substring","removeLinks","withConsolidatedSpaces","removeExtraSpaces","split","line","join","trimLines","positive","negative","absCompare","a","b","sort","safeSort","isSingleRootMap","isObjectObject","isNotRecursableObject","deepAssign","Array","call","assignee","assigners","Error","assigner","Theme","extractConnectors","extractLinks","MultiRootLayout","nodeAttributeUtils","defaultLayouts","dimensionProvider","optional","layouts","theme","multiRootLayout","margin","attributeValue","h","orientation","calculator","standard","rootIdea","rootResult","appendRootNodeLayout","setThemeAttributes","nodes","connectors","themeOverrides","formatResult","getCombinedLayout","aggregate","visibleNodes","allowParentConnectorOverride","connectorEditingContext","blockParentConnectorOverride","isChildNode","visibleNode","type","from","to","parentConnector","allowed","subNodeRank","PolyBool","convexHull","dotProduct","p1","p2","toPolyBoolPoly","poly","regions","inverted","polygonsAreEqual","poly1","poly2","shape1","shape2","arePointsEqual","areShapesEqual","shapeContainingIntersection","intersection","pbIntersection","containingShape","shape","pbShape","shapeIntersection","intersect","polygonIntersectionPoints","pbPoly1","pbPoly2","flatten","projectPointOnLineVector","point","vectorOrigin","vector","pointVector","valDp","len2","resultVector","orderPointsOnVector","points","pointsBeforeOriginOnly","pointScale","dx","dy","pow","filteredPoints","roundVector","round","addVectors","vector1","vector2","y","subtractVectors","translatePoly","translation","region","firstProjectedPolyPointOnVector","intersectionsOnLine","orderedIntersectionsOnLine","furthestIntersectionPoint","translatePolyToIntersecton","polyToTranslate","intersectionPoint","firstPolyPoint","translatedPoly","translatePolyToNotOverlap","polyToFit","existingRegions","polyRootCenter","previousTranslation","depth","polyTranslation","tolayoutPolygonRect","layout","minX","maxX","minY","maxY","width","tolayoutPolygonHull","x1","x2","y1","y2","height","buildPoints","hullIndices","hullIndex","unitVector","magnitude","sqrt","extension","nodeToBox","emptyLayout","self","getNodesForPredicate","filtered","getNodesDown","referenceNode","coneRatio","getNodesRight","getNodesUp","getNodesLeft","getNearest","xRatio","yRatio","referenceNodeCenter","calculateDistance","point1","point2","d","getPreferred","getOrientation","getNode","getNodeBox","setLayout","newLayout","getLayout","nodeIdLeft","nodeIdRight","nodeIdUp","nodeIdDown","layoutBounds","minx","miny","maxx","maxy","clipRectTransform","centerNodeId","scale","centerNode","bounds","padding","imgCenter","clipRect","page","floor","layoutGeometry","globalIdeaTopLeftPosition","positionArray","position","priority","getDesiredRootNodeOffset","storedLayout","rootPosition","rootNode","positionedLayouts","unpositionedLayouts","rootLayout","toStoredLayout","isPositioned","placedLayoutPoly","origin","contextNode","contextLayout","firstToPlace","placedLayouts","hasMultipleLayouts","positionLayout","offset","storedLayoutPoly","placedRootOffset","initialTranslation","contains","horizontalMovement","verticalMovement","horizontalTranslationResult","horizontalExtension","verticalTranslationResult","verticalExtension","placeNewLayout","rootId","mergeNodes","distance","rootCenter","nodeDistances","nodeDistance","rootDistance","layout1","layout2","placedLayout","objectUtils","INHERIT_MARKER","inheritAttributeKeysFromParentNode","parentNode","keysToInherit","remainingToInherit","keyToInherit","parentValue","getValue","setValue","inheritAttributeKeys","nodesMap","inheritAttributes","keyComponentsWithValue","nodeKey","styles","nodeStyles","getLayoutConnectorAttributes","left","top","treeUtils","positiveTree","calculateTree","negativeTree","toLayout","negativeLayout","n","borderLength","border","seed","el","l","borderSegmentIndexAt","extendBorder","originalBorder","lengthToCut","origLength","Outline","topBorder","bottomBorder","shiftBorder","deltaH","segment","initialHeight","bottom","borders","spacingAbove","outline","j","li","lj","indent","horizontalIndent","vertCenter","unshift","stackBelow","spacing","expand","initialTopHeight","initialBottomHeight","topAlignment","bottomAlignment","insertAtStart","dimensions","easeIn","outlineFromDimensions","outlineUtils","Tree","deltaX","deltaY","subtrees","t","subLayout","rankAndParentPredicate","nodeDimensions","allRanks","candidateRanks","includedRanks","includedSubIdeaKeys","includedSubIdeas","suboutline","deltaHeight","subtreePosition","horizontal","treeOutline","subtree","treeArray","referenceTree","oldPositions","tree","adjustSpacing","oldSpacing","newSpacing","buildReferenceTree","setVerticalSpacing","appendSubtrees","compactedGroupWidth","sortNodesByLeftPosition","childNodes","sortedChildNodes","getChildNodeBoundaries","rightMost","right","sameLevelNodes","levelBoundaries","compactChildNodes","setGroupWidth","verticalOffset","alignGroup","combineVerticalSubtrees","isGroup","childResults","shouldIncludeSubIdeas","newLevel","childLayouts","toNode","traversalLayout","levelHeights","maxHeights","heights","totalHeight","memo","item","getLevelHeights","VerticalSubtreeCollection","sameLevel","verticalSubtreeCollection","treeOffset","isArray","levels","xOffset","getMergedLevels","subtreeRank","getExpectedTranslation","nodeGroup","total","subtreeMap","marginArg","sortedRanks","translationsByRank","ranks","translations","currentWidthByLevel","childLayout","rankIndex","levelIndex","currentLevelWidth","calculateExpectedTranslations","getLevelWidth","existsOnLevel","referenceLeft","referenceRight","leftLayout","rightLayout","leftx","getLevelWidths","maxLevel","levelIdx","targetCombinedLeftOffset","levelWidth","MemoryClipboard","LayoutModel","Utilities","default","CONFIG","selectAllTitles","clipboardProvider","defaultReorderMargin","isAddLinkMode","currentLabelGenerator","revertSelectionForUndo","revertActivatedForUndo","layoutCalculator","currentlySelectedIdeaId","isInputEnabled","isEditingEnabled","themeSource","paused","activatedNodes","autoThemedIdeaUtils","clipboard","reorderMargin","layoutModel","setRootNodePositionsForPrecalculatedLayout","specificLayout","rootIdeas","existingPosition","rootNodeInLayout","setActiveNodes","activated","wasActivated","difference","selectNewIdea","newIdeaId","selectNode","editNewIdea","editNode","getCurrentlySelectedIdeaId","onIdeaChanged","action","sessionId","rebuildRequired","currentlySelectedIdea","ensureNodeIsExpanded","source","addSubIdeaToTargetNode","targetId","initialTitle","targetNode","positionNextTo","relativeNodeId","relativeNode","analytic","eventName","eventArg","pause","resume","getIdea","getCurrentLayout","currentLayout","themeHasChanged","ideaThemeOverrides","layoutThemeOverrides","themeOverridesHaveChanged","themeChanged","layoutCompleteOptions","nodePositionsChanged","oldNode","newNode","labelMap","label","applyLabels","oldConnector","connectorId","newConnector","oldLink","linkId","newActive","nodeList","closestNode","closestNodeId","oldFromNode","oldToNode","newFromNode","newToNode","connectorNodeMoved","newLink","idea_pp","isInCollapse","updateCurrentLayout","reactivate","setIdea","anIdea","tryKeepingContext","oldSelectedIdea","removeEventListener","addEventListener","setEditingEnabled","getEditingEnabled","setInputEnabled","dataset","holdFocus","getInputEnabled","force","appendToActive","isActivated","activateNode","clickNode","button","which","altKey","toggleLink","shiftKey","toggleActivationOnNode","toggleAddLinkMode","layerX","layerY","getSelectedStyle","prop","getStyleForId","toggleCollapse","selectedIdea","isCollapsed","everyActivatedIs","collapse","doCollapse","contextNodeId","oldContext","newContext","applyToActivated","updateStyle","updateLinkStyle","merged","target","addGroupSubidea","newGroupId","activeNodes","addSiblingIdeaBefore","contextRank","addSiblingIdea","optionalNodeId","optionalInitialText","currentId","isNew","shouldSelectAll","editingNew","currentIdea","contentLocked","include","scaleUp","scaleDown","scaleMultiplier","zoomPoint","move","resetView","selectedNode","localRoot","decorationAction","decorationType","handleKey_loadMap","container","FILEBUTTON_CLASS","class","getElementsByClassName","click","readFile","data_target","filename","fileList","files","file","reader","window","FileReader","onload","loadMap","readAsText","mapJson","target_container_id","mapM","old_idea","new_idea","downloadMap","mapOutput","downloadToFile","nodeIdTo","exists","selectLink","selectionPoint","link_id","replaceAll","link_element","containerElement","querySelector","classList","old_selected_link","remove","add","selectConnector","nodeIdFrom","cancelCurrentAction","undoSelectionClone","undoActivationClone","cut","activeNodeIds","parents","contextForNode","hasChildren","rootCount","hasPreferredWidth","hasPosition","canPaste","isRoot","hasPreferredPosition","notRoot","notLastRoot","canCollapse","canExpand","copy","pasteStyle","clipContents","pastingStyle","getIcon","icon","setIcon","url","imgWidth","imgHeight","metaData","iconObject","nodeIdea","insertUp","insertDown","insertLeft","insertRight","moveUp","moveDown","moveLeft","moveRight","getSelectedNodeId","centerOnNode","search","query","toLocaleLowerCase","applyFuncs","direction","analyticTag","relId","applyToNodeDirection","getActivatedNodeIds","activateSiblingNodes","activateNodeAndChildren","contextId","activateChildren","context","activateSelectedNode","activeId","toApply","every","activateLevel","toActivate","getNodeIdAtPosition","autoPosition","standardPositionNodeAt","manualPosition","thisNode","nodeBeingDragged","validReposition","getMaxSequence","nodeDragEndX","flipRightToLeft","flipLeftToRight","tryFlip","verticallyClosestNode","Infinity","getVerticallyClosestNode","manuallyPositionSubNode","topDownPositionNodeAt","closestNodeToRight","closestNodeToLeft","manuallyPositionRootNode","sibling","useLeftNode","shouldFlip","positionNodeAt","dropNode","dropTargetId","setLayoutCalculator","newCalculator","setThemeSource","newThemeSource","dropImage","dataUrl","dropOn","scaleX","scaleY","existing","addNew","setLabelGenerator","labelGenerator","labelGeneratorName","getStandardReorderBoundary","opposite","boundaries","isRightHalf","primaryEdge","secondaryEdge","siblingBoundary","side","tops","bottoms","edge","parentBoundary","sameSide","otherSide","otherSideSiblings","nonRootStandardReorderBoundary","getTopDownReorderBoundary","siblingNode","getReorderBoundary","focusAndSelect","requestContextMenu","eventPointX","eventPointY","makeSelectedNodeRoot","setNodePositionFromCurrentLayout","setNodeWidth","unsetSelectedNodeWidth","unsetSelectedNodePosition","insertRoot","lineLabelClicked","tolerance","childMid","convertToRGB","colorObj","opacity","regCSSRGB","colorString","matched","match","fromCSSRGB","integer","g","fromHexString","calcChildPosition","lineTypes","nodeConnectionPointX","nodeConnectionPointY","inset","themeArg","calculatedConnector","childPosition","fromStyles","toStyles","connectionPositionDefaultFrom","connectionPositionDefaultTo","connectionPositionFrom","connectionPositionTo","connectorTheme","fromInset","toInset","nodeUnderline","nodeOverline","calculateConnector","connectorCurve","initialRadius","halfWidth","appendOverLine","appendUnderLine","appendBorderLines","luminosity","rgb","color1","color2","lum","chan","calcLuminosity","dashed","solid","strokes","multipleWidth","linecap","straight","maxOffset","requestedOffset","controlPoint","dxIncrement","dyIncrement","verticalLine","yIncrement","flatLine","xIncrement","arrowPath","lineFrom","lineTo","tan","PI","iy","a1x","a2x","a1y","a2y","m","len","sin","cos","lineStyles","linkAttrArg","conn","parentPoints","childPoints","bestParent","bestChild","linkAttr","linkTheme","lineProps","arrows","arrowAttr","paths","arrowPaths","nearestInset","relatedNode","horizontalInset","verticalInsetRatio","insetY","insetX","nodeMidX","relatedNodeMidX","relatedNodeRight","cappedOffset","offsetX","colorParser","themeFallbackValues","attributeForPath","pathArray","fallback","remaining","themeAttributeValue","themeDictionary","prefixes","postfixes","rootElement","toAssign","reverse","nodeAttributeToNodeTheme","nodeAttribute","getBackgroundColor","cornerRadius","lineColor","lineWidth","connectorControlPoint","connectorStyle","defaultControlPoint","configuredControlPoint","defaultTheme","deepFreeze","firstNode","defaultConnector","maxWidth","lightColor","darkColor","above","addPx","cssProp","shadow","parsers","borderOb","shadowArray","boxshadows","radius","fontObj","weight","fontWeightParser","fontSize","toFixed","fontSizeParser","process","noAnimations","processThemeStyles","nodeStyleArray","parser","cssVal","pushProperties","styleObject","keyPrefix","propKey","identity","nodeStyle","styleSelector","decorations","overlap","appendDecorationStyles","appendSpanStyles","processNodeStyles","css","cssFont","themeJson","nodeArray","themeToDictionary","themeAttributeUtils","getFontForStyles","themeStyles","lineGap","getNodeMargin","nodeLevel","nodeAttr","styleNames","childStyles","parentStyles","childConnectorStyle","parentConnectorStyle","childConnector","combinedStyle","combinedConnector","connectorDefaults","returnedConnector","linkStyle","fromCurrentTheme","fromDefaultTheme","currentAttribs","themeAutoColor","autoColor","autoColors","getAutoColor","s","cleanDOMId","connectorObj","cssPosition","transform","toFreeze","freeze","getOwnPropertyNames","hasOwnProperty","isFrozen","requiresRecursion","linkObj","CONTAINER_CLASS","console_original","environment","new_logger","create","log","message","console","trycatch","exception","getContainerID","elementOrEvent","containers","document","currentTarget","closest","contentType","Blob","download_anchor","createElement","href","URL","createObjectURL","download","revokeObjectURL","getElementMJS","className","parentElement","asCollection","elements","result_count","tagName","ideas_pp","constructor","hashmap","attributeNameComponents","currentKey","searchingFor","subKey","newComps","base","listeners","types","listener","listenerDetails","details","firstListenerDetails","secondListenerDetails","some","trace","urlPattern","hrefUrl","containsLink","getLink","getPattern","themeConnector","element","applyInnerRect","box","innerRect","data","connectorBuilder","shapeFrom","shapeTo","connectorAttr","fromBox","getDataBox","toBox","pathElement","createSVG","connectionPosition","labelTheme","labelPosition","aboveEnd","middleToBox","middleFromBox","multiplier","ratio","getPointAtLength","getTotalLength","jQuery","connectorKey","buildConnection","convertPositionToTransform","fn","createConnector","stage","nodeWithId","connection","stroke","appendTo","linkKey","themeLink","createLink","linkBuilder","elementData","nodeFrom","nodeTo","createNode","display","addClass","createReorderBounds","hide","createElementNS","calculateLayout","nodeCacheMark","mapModel","stageElement","touchEnabled","imageInsertController","resourceTranslator","viewPortDimensions","stageMargin","stageVisibilityMargin","currentDroppable","stats","viewPort","viewPortAnimOptions","duration","reorderBounds","dummyTextBox","visibility","getViewPortDimensions","scrollLeft","scrollTop","innerWidth","innerHeight","stageToViewCoordinates","scrollPosition","offsetY","viewToStageCoordinates","updateScreenCoordinates","trigger","ensureSpaceForPoint","dirty","updateStage","ensureSpaceForNode","centerViewOn","animate","viewPortCenter","newLeftScroll","newTopScroll","finish","centerViewOnNode","nodeCenterX","nodeCenterY","ensureNodeVisible","domElement","nodeTopLeft","nodeBottomRight","animation","stagePositionForPointEvent","evt","viewportDropCoordinates","dropPosition","gesture","center","vpOffset","pageX","pageY","viewportCoordinatesForPointEvent","clearCurrentDroppable","removeClass","withinReorderBoundary","reorderBoundary","nodeX","translateToPixel","record","resetStats","getStats","setStageMargin","newMargins","setStageVisibilityMargin","textBox","expectedCacheMark","actual","expected","cacheMisses","old","new","recordCacheMiss","updateNodeContent","ceil","outerWidth","textWidth","outerHeight","detach","on","currentReorderBoundary","nodeResizeWidget","realEvent","srcEvent","stopPropagation","relatedTarget","dropCoords","currentPosition","hasShift","updateReorderBounds","showDroppable","dropResult","isShift","stageDropCoordinates","nodeAtDrop","finalPosition","nodeWidth","preventDefault","shadowDraggable","isSelected","queueFadeOut","findLine","updateConnector","connectorOptions","updateLink","currentScale","targetScale","currentCenter","focus","inlineEditingDisabled","editingElement","then","newText","catch","isOn","deactivatedNodes","$","mapjsUtilities","MAPJS_MAP_CLASS","scrollWhenDragging","scrollPredicate","dragOrigin","domMapWidget","activityLog","dragContainer","centerSelectedNodeOnOrientationChange","hotkeyEventHandlers","charEventHandlers","actOnKeys","canInput","svgContainer","append","previousPinchScale","simpleDraggableContainer","imageDropWidget","mappedFunction","keysPressed","keydown","stopImmediatePropagation","functions","ctrlKey","metaKey","isTrusted","keyCode","scroll","originalEvent","wheelDeltaX","scrollWidth","unicode","charCode","actualkey","fromCharCode","Number","unformattedText","originalText","selectAll","placeCaretAtEnd","disable","Promise","resolve","clear","detachListeners","removeAttr","finishEditing","innerText","cancelEditing","keyboardEvents","off","getBox","domShape","offsetTop","offsetLeft","offsetWidth","offsetHeight","domShapeData","corsProxyUrl","isDataUri","convertSrcToDataUri","img","ctx","canvas","getContext","drawImage","toDataURL","Deferred","domImg","Image","dataUri","onerror","crossOrigin","encodeURIComponent","promise","Hammer","onDrag","Event","onShadowDrag","mapInstance","currentDragObject","originalDragObjectPosition","drag","newpos","rollback","complete","progress","simpleDraggable","domMapController","dataTransfer","htmlContent","insertFiles","getData","insertHtmlContent","getDataURIAndDimensions","resourceConverter","insertDataUrl","storeUrl","reason","fileInfo","when","loader","fReader","onprogress","notify","readAsDataURL","readFileIntoDataUrl","done","images","html","containsBr","linkEditWidgetElement","colorElement","lineStyleElement","arrowElement","currentLink","show","change","toolbarElement","jQToolbarWidgetElement","preventRoundtrip","toggleClass","methodName","buttons","button_data","tool","levelOverride","note","initialPosition","initialWidth","initialStyle","nodeTextElement","nodeTextDOM","stopEvent","dragWidth","pos","calcDragWidth","getSelection","createRange","range","sel","selectNodeContents","removeAllRanges","addRange","removeElement","is","textRange","body","createTextRange","moveToElementText","select","setThemeClassList","filterClasses","classes","toRemove","toAdd","getTextElement","labelText","elementType","centrePoint","textElement","rectElement","textDOM","textDimensions","rectDOM","translate","CONNECTOR_CLASS","linkDimensions","getClientRects","dleft","dright","fill","fontWeight","dominantBaseline","setAttribute","borderColor","lineStrokes","updateConnectorText","calcLabelCenterPont","hitElement","connectionPropCheck","connectionIsUpdated","labelCenterPoint","applyLabel","changeCheck","arrowElements","eq","showArrows","formattedNodeTitle","applyIdeaAttributesToNodeTheme","calcMaxWidth","nodeContent","forcedLevel","nodeTextPadding","fixedLayout","textSpan","span","updateText","preferredWidth","effectiveStyles","decorationEdge","decorationOverlap","nodeCacheData","includes","empty","applyLinkUrl","applyNote","setColors","textHeight","maxTextWidth","selfProps","textProps","MapModel","ImageInsertController","DomMapController","MapToolbarWidget","LinkEditWidget","ThemeProcessor","formatNoteToHtml","version","MAPJS","INSTANCE_CLASS","MAPJS_SRC_CLASS","arg","argumentMapping","topdown","compact","v1","themeProvider","changeTheme","getTheme","themeCSS","layoutThemeStyle","addMap","instanceElement","jQcontainer","JQinstance","containerInstance","mapToolbarWidget","linkEditWidget","current_map","current_mapModel","oFReader","oFREvent","container_idea","pasteNode","delegateTarget","instanceElements","script_src","getAttribute","fetch","response","warn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","O","chunkIds","notFulfilled","fulfilled","definition","o","defineProperty","enumerable","obj","Symbol","toStringTag","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","chunkLoadingGlobal","__webpack_exports__"],"sourceRoot":""}